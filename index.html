<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="1756402899" />
    <meta name="build-hash" content="1756402899" />
    <title>CLIENT FLOW 360 - Real Estate CRM Platform - v2.4 MLS Bridge Integration</title>
    <script src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body { 
        margin: 0; 
        padding: 0; 
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif; 
        background: #111827; 
        color: white; 
      }
      #root { min-height: 100vh; }
      
      /* Netflix-style animations and effects */
      .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }
      
      /* Smooth transitions for tile effects */
      .group:hover .group-hover\:scale-110 {
        transform: scale(1.1);
      }
      
      /* Enhanced hover effects */
      .tile-hover {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }
      
      .tile-hover:hover {
        transform: scale(1.05);
        z-index: 10;
      }

      /* Mobile-specific improvements */
      @media (max-width: 640px) {
        /* Disable hover effects on mobile to prevent sticky hover states */
        .tile-hover:hover {
          transform: none;
        }
        
        /* Improve touch targets */
        button, .cursor-pointer {
          min-height: 44px;
          min-width: 44px;
        }
        
        /* Better text scaling */
        .text-2xl { font-size: 1.25rem; }
        .text-xl { font-size: 1.125rem; }
        
        /* Ensure proper touch scrolling */
        .overflow-x-auto {
          -webkit-overflow-scrolling: touch;
        }
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="module">
      // Complete Netflix-style CRM with CLIENT FLOW 360 branding + Database Integration  
      // CACHE BUST: BUILD:1756274500 - PROPERTY MANAGEMENT + AUTH FIX - VERSION 2.1
      const { useState, useEffect, useCallback } = React;

      // Authentication Check - Redirect to landing if not authenticated
      function checkAuthentication() {
        // Prevent redirect loops
        if (window.location.pathname === '/landing.html') {
          return false;
        }
        
        const isAuthenticated = sessionStorage.getItem('cf360_authenticated') === 'true';
        if (!isAuthenticated) {
          console.log('🔐 User not authenticated, redirecting to landing page...');
          try {
            window.location.href = './landing.html';
          } catch (error) {
            console.error('Redirect error:', error);
            // Fallback: show guest mode
            console.log('🔐 Starting in guest mode - authentication required for full functionality');
            return true; // Allow guest access
          }
          return false;
        }
        return true;
      }

      // Check authentication on page load
      if (!checkAuthentication()) {
        throw new Error('Authentication required');
      }
      
      console.log('🎬 CLIENT FLOW 360 - Starting Netflix-style CRM with Database v4.0 - PROPERTY_MANAGEMENT_1756274000 - COMPREHENSIVE PROPERTY SYSTEM...');
      
      // API Service
      const API = {
        baseURL: '/api',
        
        // Health check
        health: async () => {
          try {
            const response = await axios.get(`${API.baseURL}/health`);
            return response.data;
          } catch (error) {
            console.error('Health check failed:', error);
            throw error;
          }
        },
        
        // Clients
        clients: {
          getAll: async () => {
            console.log('📡 Making API call to fetch clients...');
            console.log('🔍 API URL:', `${API.baseURL}/clients`);
            console.log('🔍 Request method: GET');
            try {
              const response = await axios.get(`${API.baseURL}/clients`);
              console.log('✅ API response received:', response.data);
              console.log('✅ Response type:', typeof response.data);
              console.log('✅ Is array:', Array.isArray(response.data));
              
              // Ensure we always return an array
              const data = response.data;
              if (Array.isArray(data)) {
                return data;
              } else if (data && typeof data === 'object') {
                console.log('⚠️ API returned object instead of array, wrapping in array');
                return [data];
              } else {
                console.log('⚠️ API returned unexpected format, using empty array');
                return [];
              }
            } catch (error) {
              console.error('❌ API call failed:', error);
              console.error('❌ Error response:', error.response?.data);
              console.error('❌ Error status:', error.response?.status);
              console.log('🔄 Returning empty array as fallback');
              return [];
            }
          },
          
          getById: async (id) => {
            const response = await axios.get(`${API.baseURL}/clients/${id}`);
            return response.data;
          },
          
          create: async (clientData) => {
            console.log('📡 Creating new client via API...', clientData);
            try {
              const response = await axios.post(`${API.baseURL}/create-client`, clientData);
              console.log('✅ Client created successfully:', response.data);
              return response.data;
            } catch (error) {
              console.error('❌ Client creation failed:', error);
              console.error('❌ Error response:', error.response?.data);
              throw error;
            }
          },
          
          update: async (id, clientData) => {
            const response = await axios.put(`${API.baseURL}/clients/${id}`, clientData);
            return response.data;
          },
          
          delete: async (id) => {
            const response = await axios.delete(`${API.baseURL}/clients/${id}`);
            return response.data;
          }
        },
        
        // Properties
        properties: {
          getByClient: async (clientId) => {
            const response = await axios.get(`${API.baseURL}/clients/${clientId}/properties`);
            return response.data;
          },
          
          create: async (clientId, propertyData) => {
            const response = await axios.post(`${API.baseURL}/clients/${clientId}/properties`, propertyData);
            return response.data;
          }
        },
        
        // 🚀 LIVE RapidAPI Property Data - REAL ORLANDO PROPERTIES!
        bridge: {
          baseURL: 'https://realtor16.p.rapidapi.com',
          apiKey: 'e9adff28d0mshe760651ecaa319ep125009jsn130e593b0205',
          
          searchProperties: async (query) => {
            try {
              console.log('🏠 🚀 LIVE RapidAPI Search with complete address criteria:', query);
              
              // State abbreviation conversion
              const stateAbbreviations = {
                'florida': 'FL', 'texas': 'TX', 'california': 'CA', 'new york': 'NY',
                'illinois': 'IL', 'pennsylvania': 'PA', 'ohio': 'OH', 'georgia': 'GA',
                'north carolina': 'NC', 'michigan': 'MI', 'new jersey': 'NJ', 'virginia': 'VA',
                'washington': 'WA', 'arizona': 'AZ', 'massachusetts': 'MA', 'tennessee': 'TN',
                'indiana': 'IN', 'missouri': 'MO', 'maryland': 'MD', 'wisconsin': 'WI'
              };
              
              // Convert state name if needed
              let stateCode = query.state;
              if (query.state && query.state.length > 2) {
                const stateLower = query.state.toLowerCase();
                stateCode = stateAbbreviations[stateLower] || query.state;
              }
              
              // Use coordinate-based search for realtor16 API
              let lat = 28.5383; // Orlando coordinates
              let lng = -81.3792;
              
              // Map ZIP codes to coordinates for better results
              if (query.zipCode === '32828') {
                lat = 28.5383; lng = -81.3792; // Orlando 32828 area
              } else if (query.city && query.city.toLowerCase().includes('orlando')) {
                lat = 28.5383; lng = -81.3792; // Orlando general area
              }
              
              const searchUrl = `${API.bridge.baseURL}/search/forsale/coordinates?latitude=${lat}&longitude=${lng}&radius=10`;
              console.log('🔍 🚀 LIVE API Search URL:', searchUrl);
              
              // Search for properties using RapidAPI Realtor16
              const response = await fetch(searchUrl, {
                headers: {
                  'X-RapidAPI-Key': API.bridge.apiKey,
                  'X-RapidAPI-Host': 'realtor16.p.rapidapi.com'
                }
              });
              
              if (!response.ok) {
                throw new Error(`RapidAPI Error: ${response.status}`);
              }
              
              const data = await response.json();
              console.log('🚀 LIVE RapidAPI Response:', data);
              
              if (data.properties && data.properties.length > 0) {
                let results = data.properties.map((property, index) => {
                  const location = property.location?.address || {};
                  const fullAddress = `${location.line || ''} ${location.city || ''}, ${location.state_code || ''} ${location.postal_code || ''}`.trim();
                  
                  console.log(`🏠 🎯 LIVE Property ${index + 1}:`, {
                    propertyId: property.property_id,
                    address: fullAddress,
                    price: property.list_price,
                    beds: property.description?.beds,
                    baths: property.description?.baths_consolidated,
                    sqft: property.description?.sqft
                  });
                  
                  return {
                    id: property.property_id,
                    mlsId: property.listing_id,
                    address: fullAddress,
                    streetAddress: location.line || '',
                    city: location.city || '',
                    state: location.state_code || '',
                    zipCode: location.postal_code || '',
                    price: property.list_price,
                    status: property.status || 'for_sale',
                    bedrooms: property.description?.beds,
                    bathrooms: property.description?.baths_consolidated,
                    sqft: property.description?.sqft,
                    yearBuilt: property.description?.year_built,
                    propertyType: property.description?.type || 'residential',
                    coordinates: { 
                      lat: location.coordinate?.lat, 
                      lng: location.coordinate?.lon 
                    },
                    agent: { 
                      name: property.branding?.[0]?.name,
                      office: property.branding?.[0]?.name,
                      phone: property.source?.agents?.[0]?.office_name
                    },
                    photos: property.photos ? property.photos.map(p => p.href) : 
                            (property.primary_photo ? [property.primary_photo.href] : []),
                    remarks: property.description?.name || 'Real property listing from Orlando MLS',
                    matchScore: 0
                  };
                });
                
                // Enhanced address matching with fallback for demo
                if (query.address || query.city || query.state || query.zipCode) {
                  // First pass: strict matching
                  let filteredResults = results.filter(prop => {
                    let matchScore = 0;
                    let matches = true;
                    
                    // Street address matching
                    if (query.address && query.address.trim()) {
                      const searchAddress = query.address.toLowerCase().trim();
                      const propStreetAddress = (prop.streetAddress || '').toLowerCase().trim();
                      const propFullAddress = prop.address.toLowerCase();
                      
                      if (propStreetAddress.includes(searchAddress) || propFullAddress.includes(searchAddress)) {
                        matchScore += 10;
                        if (propStreetAddress === searchAddress) {
                          matchScore += 20;
                        }
                      } else {
                        matches = false;
                      }
                    }
                    
                    // City matching
                    if (query.city && query.city.trim()) {
                      const searchCity = query.city.toLowerCase().trim();
                      const propCity = (prop.city || '').toLowerCase();
                      
                      if (propCity === searchCity) {
                        matchScore += 5;
                      } else if (propCity.includes(searchCity)) {
                        matchScore += 2;
                      } else {
                        matches = false;
                      }
                    }
                    
                    // State matching 
                    if (query.state && query.state.trim()) {
                      const searchState = stateCode.toLowerCase();
                      const propState = (prop.state || '').toLowerCase();
                      
                      if (propState === searchState) {
                        matchScore += 5;
                      } else {
                        matches = false;
                      }
                    }
                    
                    // ZIP matching
                    if (query.zipCode && query.zipCode.trim()) {
                      const searchZip = query.zipCode.trim();
                      const propZip = (prop.zipCode || '').trim();
                      
                      if (propZip === searchZip) {
                        matchScore += 8;
                      } else if (propZip.startsWith(searchZip.substring(0, 3))) {
                        matchScore += 3;
                      } else {
                        matches = false;
                      }
                    }
                    
                    prop.matchScore = matchScore;
                    return matches;
                  });
                  
                  // If no exact matches and user searched for Orlando, show area properties
                  if (filteredResults.length === 0 && query.city && query.city.toLowerCase().includes('orlando')) {
                    console.log('🏠 No exact matches found, showing Orlando area properties for demo');
                    // Show Orlando area properties with lower match scores  
                    results = results.filter(prop => {
                      const propCity = (prop.city || '').toLowerCase();
                      if (propCity.includes('orlando') || prop.zipCode?.startsWith('328')) {
                        prop.matchScore = 1; // Low score but still show
                        return true;
                      }
                      return false;
                    });
                  } else {
                    results = filteredResults;
                  }
                }
                  
                  // Sort by match score then by price
                  results.sort((a, b) => {
                    if (b.matchScore !== a.matchScore) {
                      return b.matchScore - a.matchScore;
                    }
                    return (a.price || 0) - (b.price || 0);
                  });
                  
                  console.log(`🎯 🚀 LIVE filtering: ${results.length} REAL properties match criteria`);
                  console.log('Top LIVE matches:', results.slice(0, 3).map(p => ({
                    address: p.address,
                    matchScore: p.matchScore,
                    price: p.price
                  })));
                }
                
                return results;
              }
              
              return [];
            } catch (error) {
              console.error('🏠 🚀 LIVE RapidAPI Error:', error);
              return [];
            }
          }
        },
        
        // Tasks
        tasks: {
          getAll: async () => {
            const response = await axios.get(`${API.baseURL}/tasks`);
            return response.data;
          },
          
          create: async (clientId, taskData) => {
            const response = await axios.post(`${API.baseURL}/clients/${clientId}/tasks`, taskData);
            return response.data;
          }
        },
        
        // Calls
        calls: {
          getByClient: async (clientId) => {
            const response = await axios.get(`${API.baseURL}/calls`, { params: { client_id: clientId } });
            return response.data;
          },
          
          create: async (callData) => {
            const response = await axios.post(`${API.baseURL}/calls`, callData);
            return response.data;
          },
          
          getAll: async () => {
            const response = await axios.get(`${API.baseURL}/calls`);
            return response.data;
          }
        },
        
        // Transactions
        transactions: {
          getByClient: async (clientId) => {
            const response = await axios.get(`${API.baseURL}/transactions`, { params: { client_id: clientId } });
            return response.data;
          },
          
          create: async (clientId, transactionData) => {
            const response = await axios.post(`${API.baseURL}/transactions`, transactionData, { 
              params: { client_id: clientId } 
            });
            return response.data;
          }
        }
      };
      
      function NetflixCRM() {
        const [user, setUser] = useState(() => {
          try {
            const userData = sessionStorage.getItem('cf360_user');
            return userData ? JSON.parse(userData) : null;
          } catch {
            return null;
          }
        });
        const [clients, setClients] = useState([]);
        const [selectedClient, setSelectedClient] = useState(null);
        const [error, setError] = useState('');
        const [loading, setLoading] = useState(false);
        const [currentView, setCurrentView] = useState('clients');
        const [searchTerm, setSearchTerm] = useState('');
        const [selectedTag, setSelectedTag] = useState('');
        const [isListening, setIsListening] = useState(false);
        const [voiceStatus, setVoiceStatus] = useState('');
        const [showCallModal, setShowCallModal] = useState(null);
        const [showAddClientModal, setShowAddClientModal] = useState(false);
        const [showPropertyModal, setShowPropertyModal] = useState(null);
        const [showAddProperty, setShowAddProperty] = useState(false);
        const [showPropertyDetail, setShowPropertyDetail] = useState(null);
        const [showEditProperty, setShowEditProperty] = useState(null);
        const [propertyFormData, setPropertyFormData] = useState({});
        const [apiHealth, setApiHealth] = useState(null);
        
        // Phase 4.1: Task Management State
        const [showAddTaskModal, setShowAddTaskModal] = useState(false);
        const [showVoiceTaskModal, setShowVoiceTaskModal] = useState(false);
        const [isListeningForTask, setIsListeningForTask] = useState(false);
        const [voiceTaskText, setVoiceTaskText] = useState('');
        const [generalTasks, setGeneralTasks] = useState([]); // Tasks not assigned to specific clients
        const [taskFormData, setTaskFormData] = useState({
          title: '',
          description: '',
          type: 'general',
          priority: 'medium',
          dueDate: '',
          clientId: null,
          status: 'pending'
        });
        
        // Load clients from database
        const loadClients = useCallback(async () => {
          try {
            setLoading(true);
            setError('');
            console.log('🔄 Loading clients from database...');
            const clientsData = await API.clients.getAll();
            console.log('📊 Received clients data:', clientsData);
            
            // Add mock data structure for UI compatibility
            const enrichedClients = clientsData.map(client => ({
              ...client,
              // Ensure name fields are available in both formats for compatibility
              firstName: client.first_name || client.firstName,
              lastName: client.last_name || client.lastName,
              first_name: client.first_name || client.firstName,
              last_name: client.last_name || client.lastName,
              role: 'BUYER', // Default for now
              stage: 'ACTIVE', // Default for now  
              city: client.address ? client.address.split(',')[1]?.trim() : 'Los Angeles',
              state: client.address ? client.address.split(',')[2]?.trim() || 'CA' : 'CA',
              tags: Array.isArray(client.tags) ? client.tags : (client.tags ? client.tags.split(',') : []),
              lifetimeNetCommission: 15000, // Default for now
              calls: [], // Will load separately if needed
              transactions: [], // Default for now
              todos: [], // Will load separately if needed
              propertiesOfInterest: [] // Will load separately if needed
            }));
            
            console.log('✅ Enriched clients for UI:', enrichedClients);
            setClients(enrichedClients);
            return enrichedClients;
          } catch (error) {
            console.error('❌ Failed to load clients:', error);
            setError('Failed to load clients from database - using demo mode');
            return [];
          } finally {
            setLoading(false);
          }
        }, []);
        
        // Save clients to localStorage (for demo mode and property management)
        const saveUserClients = useCallback((user, updatedClients) => {
          try {
            if (user && user.email) {
              const storageKey = `cf360_clients_${user.email}`;
              localStorage.setItem(storageKey, JSON.stringify(updatedClients));
              console.log(`✅ Saved ${updatedClients.length} clients to localStorage for user:`, user.email);
            }
          } catch (error) {
            console.error('❌ Failed to save clients to localStorage:', error);
          }
        }, []);
        
        // Load demo clients (fallback function)
        const loadDemoClients = useCallback(() => {
          try {
            if (user && user.email) {
              const storageKey = `cf360_clients_${user.email}`;
              const savedClients = localStorage.getItem(storageKey);
              if (savedClients) {
                const parsedClients = JSON.parse(savedClients);
                setClients(parsedClients);
                console.log(`✅ Loaded ${parsedClients.length} demo clients from localStorage`);
                return;
              }
            }
            
            // Default demo clients if no saved data
            const demoClients = [
              {
                id: 'demo-1',
                firstName: 'Sarah',
                lastName: 'Johnson',
                first_name: 'Sarah',
                last_name: 'Johnson',
                email: 'sarah.johnson@email.com',
                phone: '(555) 123-4567',
                role: 'BUYER',
                stage: 'ACTIVE',
                city: 'Los Angeles',
                state: 'CA',
                tags: ['First Time Buyer', 'High Priority'],
                lifetimeNetCommission: 15000,
                calls: [],
                transactions: [],
                todos: [],
                propertiesOfInterest: []
              },
              {
                id: 'demo-2',
                firstName: 'Michael',
                lastName: 'Chen',
                first_name: 'Michael',
                last_name: 'Chen',
                email: 'michael.chen@email.com',
                phone: '(555) 987-6543',
                role: 'SELLER',
                stage: 'ACTIVE',
                city: 'San Francisco',
                state: 'CA',
                tags: ['Luxury', 'Repeat Client'],
                lifetimeNetCommission: 25000,
                calls: [],
                transactions: [],
                todos: [],
                propertiesOfInterest: []
              }
            ];
            
            setClients(demoClients);
            saveUserClients(user, demoClients);
            console.log('✅ Loaded default demo clients');
          } catch (error) {
            console.error('❌ Failed to load demo clients:', error);
            setClients([]);
          }
        }, [user, saveUserClients]);
        
        // Initialize app
        useEffect(() => {
          const checkAPIHealth = async () => {
            try {
              console.log('🔍 Checking API health...');
              console.log('📡 API base URL:', API.baseURL);
              const health = await API.health();
              console.log('✅ Health check response:', health);
              console.log('🎯 Setting apiHealth state to:', health);
              setApiHealth(health);
              console.log('✅ API connection successful:', health);
            } catch (error) {
              console.error('❌ API connection failed:', error);
              console.error('❌ Error details:', {
                message: error.message,
                response: error.response?.data,
                status: error.response?.status,
                stack: error.stack
              });
              setError('Database connection failed. Using demo mode.');
              const offlineHealth = { status: 'error', storage: 'Offline' };
              console.log('🔴 Setting offline health state:', offlineHealth);
              setApiHealth(offlineHealth);
            }
          };
          
          checkAPIHealth();
        }, []);
        
        // Load clients on authentication
        useEffect(() => {
          if (user) {
            console.log('🚀 User authenticated, loading clients...');
            // If API fails, use demo data
            loadClients().then(clientsFromAPI => {
              if (!clientsFromAPI || clientsFromAPI.length === 0) {
                console.log('📝 No API data, loading demo clients...');
                loadDemoClients();
              }
            }).catch(error => {
              console.log('❌ API error, loading demo clients...', error);
              loadDemoClients();
            });
          }
        }, [user, loadClients, loadDemoClients]);

        // Phase 4.1: Voice Task Creation System
        const startVoiceTaskCreation = () => {
          if ('webkitSpeechRecognition' in window) {
            const recognition = new webkitSpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'en-US';
            
            setIsListeningForTask(true);
            setVoiceStatus('🎤 Listening for task... Say something like "Add task schedule property showing for Sarah Johnson tomorrow at 2 PM"');
            
            recognition.onresult = (event) => {
              const transcript = event.results[0][0].transcript;
              console.log('🎤 Voice task transcript:', transcript);
              setVoiceTaskText(transcript);
              processVoiceTask(transcript);
              setIsListeningForTask(false);
            };
            
            recognition.onerror = (event) => {
              console.error('🎤 Speech recognition error:', event.error);
              setVoiceStatus('❌ Voice recognition failed. Please try again.');
              setIsListeningForTask(false);
              setTimeout(() => setVoiceStatus(''), 3000);
            };
            
            recognition.onend = () => {
              setIsListeningForTask(false);
            };
            
            recognition.start();
          } else {
            setVoiceStatus('❌ Voice recognition not supported in this browser');
            setTimeout(() => setVoiceStatus(''), 3000);
          }
        };
        
        // Process voice input and extract task details
        const processVoiceTask = (transcript) => {
          try {
            console.log('🧠 Processing voice task:', transcript);
            
            // Parse task type from common real estate phrases
            let taskType = 'general';
            const taskTypes = {
              'showing': ['showing', 'show property', 'property viewing', 'tour'],
              'follow_up': ['follow up', 'call back', 'check in', 'contact'],
              'listing': ['list property', 'listing', 'put on market', 'market property'],
              'documentation': ['paperwork', 'documents', 'contract', 'forms', 'sign', 'disclosure', 'seller disclosure', 'disclosure form', 'get signed', 'signature'],
              'appointment': ['appointment', 'meeting', 'schedule', 'meet'],
              'marketing': ['marketing', 'photos', 'advertise', 'promote']
            };
            
            for (const [type, keywords] of Object.entries(taskTypes)) {
              if (keywords.some(keyword => transcript.toLowerCase().includes(keyword))) {
                taskType = type;
                break;
              }
            }
            
            // Extract client name with multiple patterns
            let clientId = null;
            let clientName = '';
            let mentionedName = '';
            
            // Smart client name detection - scan entire transcript for any client names
            console.log('🧠 Analyzing transcript for client names...');
            console.log('Available clients:', clients.map(c => `${c.firstName || c.first_name} ${c.lastName || c.last_name}`));
            
            // First, try to find any client names mentioned anywhere in the transcript
            let bestMatch = null;
            let bestScore = 0;
            let bestMentionedName = '';
            
            // Get all words from the transcript (2+ letters)
            const transcriptWords = transcript.toLowerCase().match(/\b[a-z]{2,}\b/g) || [];
            console.log('🔍 Words in transcript:', transcriptWords);
            
            // Check each client against all combinations of words in the transcript
            clients.forEach(client => {
              const fullName = `${client.firstName || client.first_name} ${client.lastName || client.last_name}`.toLowerCase();
              const firstName = (client.firstName || client.first_name || '').toLowerCase();
              const lastName = (client.lastName || client.last_name || '').toLowerCase();
              
              console.log(`🔍 Checking client: ${fullName}`);
              
              // Check for exact full name match
              if (transcript.toLowerCase().includes(fullName)) {
                console.log(`✅ Exact full name match found: ${fullName}`);
                bestMatch = client;
                bestScore = 100;
                bestMentionedName = fullName;
                return;
              }
              
              // Check for first + last name in any order
              const firstInTranscript = transcriptWords.includes(firstName);
              const lastInTranscript = transcriptWords.includes(lastName);
              
              if (firstInTranscript && lastInTranscript) {
                console.log(`✅ Both first and last name found: ${firstName} + ${lastName}`);
                if (bestScore < 90) {
                  bestMatch = client;
                  bestScore = 90;
                  bestMentionedName = `${firstName} ${lastName}`;
                }
                return;
              }
              
              // Check for first name only (if unique enough)
              if (firstInTranscript && firstName.length > 2) {
                console.log(`✅ First name found: ${firstName}`);
                if (bestScore < 70) {
                  bestMatch = client;
                  bestScore = 70;
                  bestMentionedName = firstName;
                }
              }
              
              // Check for last name only (if unique enough)  
              if (lastInTranscript && lastName.length > 2) {
                console.log(`✅ Last name found: ${lastName}`);
                if (bestScore < 60) {
                  bestMatch = client;
                  bestScore = 60;
                  bestMentionedName = lastName;
                }
              }
              
              // Check for partial matches (fuzzy matching)
              transcriptWords.forEach(word => {
                if (word.length > 2) {
                  // Check if word starts with client name or vice versa
                  if (firstName.startsWith(word) || word.startsWith(firstName.substring(0, 3))) {
                    console.log(`🔍 Fuzzy match on first name: ${word} ~ ${firstName}`);
                    if (bestScore < 50) {
                      bestMatch = client;
                      bestScore = 50;
                      bestMentionedName = word;
                    }
                  }
                  if (lastName.startsWith(word) || word.startsWith(lastName.substring(0, 3))) {
                    console.log(`🔍 Fuzzy match on last name: ${word} ~ ${lastName}`);
                    if (bestScore < 45) {
                      bestMatch = client;
                      bestScore = 45;
                      bestMentionedName = word;
                    }
                  }
                }
              });
            });
            
            // Use the best match if confidence is high enough
            if (bestMatch && bestScore >= 45) {
              clientId = bestMatch.id;
              clientName = `${bestMatch.firstName || bestMatch.first_name} ${bestMatch.lastName || bestMatch.last_name}`;
              mentionedName = bestMentionedName;
              console.log(`✅ Client matched with ${bestScore}% confidence: ${clientName} (mentioned as: ${mentionedName})`);
            } else {
              console.log('❌ No client match found with sufficient confidence - assigning to Rodrigo (account owner)');
              // Fallback to Rodrigo (account owner) for unmatched voice tasks
              clientId = 'rodrigo-admin';
              clientName = 'Rodrigo Admin (Owner)';
              mentionedName = 'unassigned voice task';
            }
            
            // Parse priority from urgency keywords
            let priority = 'medium';
            const urgentKeywords = ['asap', 'urgent', 'emergency', 'immediately', 'rush', 'critical'];
            const highKeywords = ['important', 'priority', 'soon', 'quick', 'fast'];
            
            if (urgentKeywords.some(keyword => transcript.toLowerCase().includes(keyword))) {
              priority = 'high';
            } else if (highKeywords.some(keyword => transcript.toLowerCase().includes(keyword))) {
              priority = 'high';
            } else if (transcript.toLowerCase().includes('when you can') || transcript.toLowerCase().includes('no rush')) {
              priority = 'low';
            }
            
            // Parse due date from natural language
            let dueDate = '';
            const today = new Date();
            
            if (transcript.toLowerCase().includes('tomorrow')) {
              const tomorrow = new Date(today);
              tomorrow.setDate(tomorrow.getDate() + 1);
              dueDate = tomorrow.toISOString().split('T')[0];
            } else if (transcript.toLowerCase().includes('next week')) {
              const nextWeek = new Date(today);
              nextWeek.setDate(nextWeek.getDate() + 7);
              dueDate = nextWeek.toISOString().split('T')[0];
            } else if (transcript.toLowerCase().includes('today')) {
              dueDate = today.toISOString().split('T')[0];
            } else {
              // Enhanced natural language date parsing
              const monthNames = {
                'january': 0, 'jan': 0, 'february': 1, 'feb': 1, 'march': 2, 'mar': 2,
                'april': 3, 'apr': 3, 'may': 4, 'june': 5, 'jun': 5, 'july': 6, 'jul': 6,
                'august': 7, 'aug': 7, 'september': 8, 'sep': 8, 'sept': 8, 'october': 9, 'oct': 9,
                'november': 10, 'nov': 10, 'december': 11, 'dec': 11
              };
              
              // Try to match patterns like "August 29th", "Aug 29", "August 29"
              const dateRegex = /(january|jan|february|feb|march|mar|april|apr|may|june|jun|july|jul|august|aug|september|sep|sept|october|oct|november|nov|december|dec)\s+(\d{1,2})(?:st|nd|rd|th)?/i;
              const match = transcript.match(dateRegex);
              
              if (match) {
                const monthName = match[1].toLowerCase();
                const day = parseInt(match[2]);
                const monthIndex = monthNames[monthName];
                
                if (monthIndex !== undefined && day >= 1 && day <= 31) {
                  const targetDate = new Date(today.getFullYear(), monthIndex, day);
                  
                  // If the date is in the past, assume next year
                  if (targetDate < today) {
                    targetDate.setFullYear(today.getFullYear() + 1);
                  }
                  
                  dueDate = targetDate.toISOString().split('T')[0];
                  console.log(`📅 Parsed date: ${monthName} ${day} -> ${dueDate}`);
                }
              }
            }
            
            // Extract time if mentioned
            const timeMatch = transcript.match(/(?:at\s+)?(\d{1,2})(?::(\d{2}))?\s*(am|pm)/i);
            let timeStr = '';
            if (timeMatch) {
              let hour = parseInt(timeMatch[1]);
              const minute = timeMatch[2] || '00';
              const ampm = timeMatch[3].toLowerCase();
              
              if (ampm === 'pm' && hour !== 12) hour += 12;
              if (ampm === 'am' && hour === 12) hour = 0;
              
              timeStr = `${hour.toString().padStart(2, '0')}:${minute}`;
            }
            
            // Create task title from transcript - intelligently extract the actual task content
            let taskTitle = transcript;
            let cleanedTask = transcript;
            
            // Remove common prefixes and client name references to get pure task content
            const prefixesToRemove = [
              /^add\s+task\s*/i,
              /^add\s+to\s+/i,
              /^create\s+task\s*/i,
              /^remind\s+me\s+to\s*/i,
              /^task\s+for\s*/i,
              /^note\s+for\s*/i
            ];
            
            // Remove prefixes
            for (const prefix of prefixesToRemove) {
              cleanedTask = cleanedTask.replace(prefix, '').trim();
            }
            
            // If we found a client, try to remove their name references from task content
            if (clientName && mentionedName) {
              // Remove patterns like "for sarah johnson", "sarah johnson file", etc.
              const namePatterns = [
                new RegExp(`\\b${mentionedName}\\s+file\\s*:?\\s*`, 'gi'),
                new RegExp(`\\bfile\\s+${mentionedName}\\s*:?\\s*`, 'gi'),
                new RegExp(`\\bfor\\s+${mentionedName}\\s*:?\\s*`, 'gi'),
                new RegExp(`\\bto\\s+${mentionedName}\\s*:?\\s*`, 'gi'),
                new RegExp(`\\b${mentionedName}\\s*:?\\s*`, 'gi'),
              ];
              
              for (const pattern of namePatterns) {
                cleanedTask = cleanedTask.replace(pattern, '').trim();
              }
            }
            
            // Remove any leading/trailing colons and clean up
            cleanedTask = cleanedTask.replace(/^[:,-]+|[:,-]+$/g, '').trim();
            
            // If we have meaningful content left, use it; otherwise use original transcript
            taskTitle = cleanedTask.length > 3 ? cleanedTask : transcript;
            
            console.log('📝 Original transcript:', transcript);
            console.log('📝 Cleaned task title:', taskTitle);
            
            // Set the form data
            setTaskFormData({
              title: taskTitle,
              description: `Voice-created task: ${transcript}`,
              type: taskType,
              priority: priority,
              dueDate: dueDate,
              time: timeStr,
              clientId: clientId,
              clientName: clientName,
              mentionedName: mentionedName, // Keep track of what was mentioned
              status: 'pending'
            });
            
            // Auto-save the task instead of showing modal
            const autoSaveTask = {
              title: taskTitle,
              description: `Voice-created task: ${transcript}`,
              type: taskType,
              priority: priority,
              dueDate: dueDate,
              time: timeStr,
              clientId: clientId,
              clientName: clientName,
              mentionedName: mentionedName,
              originalTranscript: transcript,
              status: 'pending'
            };
            
            // Automatically save the task
            saveTask(autoSaveTask);
            
            // Show success message with clear indication
            const priorityEmoji = priority === 'high' ? '🔴' : priority === 'medium' ? '🟡' : '🟢';
            if (clientName && clientId) {
              setVoiceStatus(`✅ ${priorityEmoji} Task assigned to ${clientName}! "${taskTitle}" ${taskType} task (${priority} priority)${dueDate ? ` due ${dueDate}` : ''}`);
            } else if (mentionedName) {
              setVoiceStatus(`⚠️ ${priorityEmoji} Client "${mentionedName}" not recognized. Task "${taskTitle}" saved to General Tasks for manual assignment (${priority} priority).`);
            } else {
              setVoiceStatus(`✅ ${priorityEmoji} Task "${taskTitle}" saved to General Tasks! ${taskType} task (${priority} priority)${dueDate ? ` due ${dueDate}` : ''} (No client mentioned)`);
            }
            setTimeout(() => setVoiceStatus(''), 8000);
            
          } catch (error) {
            console.error('❌ Error processing voice task:', error);
            setVoiceStatus('❌ Could not process voice task. Please try again.');
            setTimeout(() => setVoiceStatus(''), 3000);
          }
        };
        
        // Save task to client or general tasks (handles both create and update)
        const saveTask = (taskData) => {
          try {
            const isEditing = taskData.isEditing && taskData.id;
            
            const taskToSave = {
              ...taskData,
              id: isEditing ? taskData.id : 'task-' + Date.now() + '-' + Math.random().toString(36).substr(2, 5),
              createdAt: isEditing ? taskData.createdAt : new Date().toISOString(),
              updatedAt: new Date().toISOString(),
              completed: taskData.status === 'completed'
            };
            
            // Remove editing flags
            delete taskToSave.isEditing;
            delete taskToSave.isGeneralTask;
            
            console.log(isEditing ? '✏️ Updating task:' : '💾 Creating task:', taskToSave);
            
            if (taskData.clientId && taskData.clientId !== 'rodrigo-admin') {
              // Update specific client tasks
              setClients(prevClients => 
                prevClients.map(client => {
                  if (client.id === taskData.clientId) {
                    const updatedTodos = isEditing 
                      ? (client.todos || []).map(task => task.id === taskToSave.id ? taskToSave : task)
                      : [...(client.todos || []), taskToSave];
                    return { ...client, todos: updatedTodos };
                  }
                  return client;
                })
              );
              
              // Update selected client if it's the same one
              if (selectedClient && selectedClient.id === taskData.clientId) {
                setSelectedClient(prev => {
                  const updatedTodos = isEditing 
                    ? (prev.todos || []).map(task => task.id === taskToSave.id ? taskToSave : task)
                    : [...(prev.todos || []), taskToSave];
                  return { ...prev, todos: updatedTodos };
                });
              }
            } else {
              // Update general tasks (Rodrigo's tasks)
              setGeneralTasks(prevTasks => 
                isEditing 
                  ? prevTasks.map(task => task.id === taskToSave.id ? taskToSave : task)
                  : [...prevTasks, taskToSave]
              );
            }
            
            // Close modals and reset form
            setShowVoiceTaskModal(false);
            setShowAddTaskModal(false);
            setTaskFormData({
              title: '',
              description: '',
              type: 'general',
              priority: 'medium',
              dueDate: '',
              clientId: null,
              status: 'pending'
            });
            
          } catch (error) {
            console.error('❌ Error saving task:', error);
            setVoiceStatus('❌ Failed to save task. Please try again.');
            setTimeout(() => setVoiceStatus(''), 3000);
          }
        };
        
        // Assign general task to specific client
        const assignTaskToClient = (taskId, clientId) => {
          const task = generalTasks.find(t => t.id === taskId);
          if (task && clientId) {
            // Remove from general tasks
            setGeneralTasks(prevTasks => prevTasks.filter(t => t.id !== taskId));
            
            // Add to specific client
            const updatedTask = { ...task, clientId, assignedAt: new Date().toISOString() };
            setClients(prevClients => 
              prevClients.map(client => 
                client.id === clientId 
                  ? { ...client, todos: [...(client.todos || []), updatedTask] }
                  : client
              )
            );
            
            setVoiceStatus(`✅ Task assigned to client successfully!`);
            setTimeout(() => setVoiceStatus(''), 3000);
          }
        };

        // Property Management Functions
        const handleAddProperty = () => {
          setPropertyFormData({
            address: '',
            price: '',
            bedrooms: '',
            bathrooms: '',
            sqft: '',
            propertyType: 'house',
            status: 'active',
            description: '',
            yearBuilt: '',
            lotSize: '',
            features: '',
            photos: []
          });
          setShowAddProperty(true);
        };

        const handleEditProperty = (property) => {
          setPropertyFormData(property);
          setShowEditProperty(property);
        };

        const handleSaveProperty = () => {
          // In real implementation, this would save to API
          console.log('Saving property:', propertyFormData);
          
          // For demo, add to client's properties
          const newProperty = {
            ...propertyFormData,
            id: showEditProperty?.id || 'prop-' + Date.now(),
            price: parseInt(propertyFormData.price) || 0,
            bedrooms: parseInt(propertyFormData.bedrooms) || 0,
            bathrooms: parseInt(propertyFormData.bathrooms) || 0,
            sqft: parseInt(propertyFormData.sqft) || 0,
            yearBuilt: parseInt(propertyFormData.yearBuilt) || null,
            lotSize: parseFloat(propertyFormData.lotSize) || null,
            createdAt: new Date().toISOString()
          };

          // Update client properties
          if (showEditProperty) {
            // Edit existing
            const updatedProperties = (selectedClient.propertiesOfInterest || []).map(p => 
              p.id === showEditProperty.id ? newProperty : p
            );
            selectedClient.propertiesOfInterest = updatedProperties;
          } else {
            // Add new
            selectedClient.propertiesOfInterest = [...(selectedClient.propertiesOfInterest || []), newProperty];
          }

          setShowAddProperty(false);
          setShowEditProperty(null);
          setVoiceStatus('✅ Property saved successfully!');
          setTimeout(() => setVoiceStatus(''), 3000);
        };

        const handleDeleteProperty = (propertyId) => {
          if (confirm('Are you sure you want to delete this property?')) {
            selectedClient.propertiesOfInterest = (selectedClient.propertiesOfInterest || []).filter(p => p.id !== propertyId);
            setVoiceStatus('✅ Property deleted successfully!');
            setTimeout(() => setVoiceStatus(''), 3000);
          }
        };
        
        const login = async (email, password) => {
          if ((email === 'rodrigo@clientflow360.com' || email === 'rodrigo@realtor.com') && password === 'admin123') {
            setUser({ firstName: 'Rodrigo', lastName: 'Admin', email });
            console.log('🔐 User logged in, setting session storage...');
            sessionStorage.setItem('cf360_user', JSON.stringify({ firstName: 'Rodrigo', lastName: 'Admin', email }));
            sessionStorage.setItem('cf360_authenticated', 'true');
            
            // Try to load clients, fallback to demo if fails
            try {
              const clientsFromAPI = await loadClients();
              if (!clientsFromAPI || clientsFromAPI.length === 0) {
                console.log('📝 No API data, loading demo clients...');
                loadDemoClients();
              }
            } catch (error) {
              console.log('❌ API failed, loading demo clients...', error);
              loadDemoClients();
            }
            setError('');
          } else {
            setError('Invalid credentials. Use rodrigo@clientflow360.com / admin123 or rodrigo@realtor.com / admin123');
          }
        };
        
        const startVoiceRecognition = () => {
          if (!('webkitSpeechRecognition' in window)) {
            setVoiceStatus('❌ Voice recognition not supported in this browser');
            setTimeout(() => setVoiceStatus(''), 3000);
            return;
          }
          
          const recognition = new webkitSpeechRecognition();
          recognition.continuous = false;
          recognition.interimResults = false;
          recognition.lang = 'en-US';
          
          recognition.onstart = () => {
            setIsListening(true);
            setVoiceStatus('🎤 Listening... Say "Add task for [Client Name] to [task description]"');
          };
          
          recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript;
            setVoiceStatus('✅ Voice command received: "' + transcript + '"');
            setIsListening(false);
            
            // Simple demo processing
            setTimeout(() => {
              setVoiceStatus('✅ Task added successfully via voice command!');
              setTimeout(() => setVoiceStatus(''), 3000);
            }, 1000);
          };
          
          recognition.onerror = () => {
            setIsListening(false);
            setVoiceStatus('❌ Voice recognition error');
            setTimeout(() => setVoiceStatus(''), 3000);
          };
          
          recognition.onend = () => {
            setIsListening(false);
            if (!voiceStatus.includes('✅')) {
              setVoiceStatus('⏹️ No speech detected. Try again.');
              setTimeout(() => setVoiceStatus(''), 3000);
            }
          };
          
          recognition.start();
        };
        
        const addClient = async (clientData) => {
          try {
            setLoading(true);
            console.log('➕ Adding new client:', clientData);
            
            let newClient;
            try {
              newClient = await API.clients.create(clientData);
            } catch (apiError) {
              // API failed, create demo client
              console.log('📝 API failed, creating demo client...');
              newClient = {
                id: 'demo-' + Date.now(),
                ...clientData,
                createdAt: new Date().toISOString()
              };
            }
            
            // Enrich with UI compatibility data
            const enrichedClient = {
              ...newClient,
              // Ensure name fields are available in both formats for compatibility
              firstName: newClient.first_name || newClient.firstName || clientData.firstName,
              lastName: newClient.last_name || newClient.lastName || clientData.lastName,
              first_name: newClient.first_name || newClient.firstName || clientData.firstName,
              last_name: newClient.last_name || newClient.lastName || clientData.lastName,
              role: 'BUYER',
              stage: 'ACTIVE',
              city: clientData.address ? clientData.address.split(',')[1]?.trim() : 'Los Angeles', 
              state: clientData.address ? clientData.address.split(',')[2]?.trim() || 'CA' : 'CA',
              tags: Array.isArray(clientData.tags) ? clientData.tags : (clientData.tags ? clientData.tags.split(',').map(tag => tag.trim()).filter(tag => tag) : []),
              lifetimeNetCommission: 0,
              calls: [],
              transactions: [],
              todos: [],
              propertiesOfInterest: []
            };
            
            setClients(prevClients => [enrichedClient, ...prevClients]);
            setShowAddClientModal(false);
            setError('');
            
            // Show success message
            setVoiceStatus('✅ Client added successfully!');
            setTimeout(() => setVoiceStatus(''), 3000);
            
            console.log('✅ Client added successfully to UI');
            
          } catch (error) {
            console.error('❌ Failed to add client:', error);
            setError('Failed to add client');
          } finally {
            setLoading(false);
          }
        };
        
        const logCall = async (clientId, callData) => {
          try {
            setLoading(true);
            console.log('📞 Logging call for client:', clientId, callData);
            
            const callRecord = await API.calls.create({
              client_id: clientId,
              call_type: 'outbound',
              duration: parseInt(callData.duration) || 0,
              notes: callData.notes,
              outcome: callData.outcome,
              follow_up_date: callData.followUp ? new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0] : null
            });
            
            console.log('✅ Call logged successfully:', callRecord);
            
            // Update the client's call history in local state
            setClients(prevClients => 
              prevClients.map(client => 
                client.id === clientId 
                  ? {
                      ...client,
                      calls: [...(client.calls || []), {
                        id: callRecord.id,
                        phoneNumber: client.phone,
                        duration: callRecord.duration,
                        notes: callRecord.notes,
                        outcome: callData.outcome,
                        followUp: !!callRecord.followUpDate,
                        createdAt: callRecord.createdAt
                      }]
                    }
                  : client
              )
            );
            
            setShowCallModal(null);
            setVoiceStatus('✅ Call logged successfully!');
            setTimeout(() => setVoiceStatus(''), 3000);
            
          } catch (error) {
            console.error('Failed to log call:', error);
            setError('Failed to log call');
          } finally {
            setLoading(false);
          }
        };

        // Filter clients based on search and tag
        const filteredClients = clients.filter(client => {
          const matchesSearch = !searchTerm || 
            `${client.firstName || client.first_name || ''} ${client.lastName || client.last_name || ''}`.toLowerCase().includes(searchTerm.toLowerCase()) ||
            client.email.toLowerCase().includes(searchTerm.toLowerCase()) ||
            client.phone.includes(searchTerm);
          
          const matchesTag = !selectedTag || 
            (client.tags && client.tags.some(tag => tag.toLowerCase().includes(selectedTag.toLowerCase())));
          
          return matchesSearch && matchesTag;
        });

        const allTags = [...new Set(clients.flatMap(client => client.tags || []))];

        if (!user) {
          return React.createElement(LoginForm, { onLogin: login, error });
        }

        return React.createElement('div', { className: 'min-h-screen bg-gray-900 text-white' },
          // Header
          React.createElement('header', { className: 'bg-black p-3 sm:p-4 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 sm:gap-0' },
            React.createElement('div', { className: 'flex items-center space-x-2 sm:space-x-4 flex-1 min-w-0' },
              React.createElement('img', { 
                src: 'https://page.gensparksite.com/v1/base64_upload/59e6f4408444ffc71a69d06d8394bd96',
                alt: 'CLIENT FLOW 360',
                className: 'h-6 sm:h-8 w-auto flex-shrink-0'
              }),
              React.createElement('h1', { 
                className: 'text-lg sm:text-2xl font-bold text-red-500 truncate',
                style: { fontFamily: 'Arial, sans-serif', letterSpacing: '-0.5px' }
              }, 'CLIENT FLOW 360'),
              React.createElement('div', { 
                className: `text-xs px-2 py-1 rounded hidden sm:block ${
                  apiHealth && apiHealth.status === 'ok' ? 'bg-green-600 text-green-100' : 'bg-red-600 text-red-100'
                }`
              }, apiHealth ? `DB: ${apiHealth.storage}` : 'DB: Connecting...')
            ),
            React.createElement('div', { className: 'flex items-center space-x-2 sm:space-x-4 flex-shrink-0' },
              React.createElement('span', { className: 'text-xs sm:text-sm' }, `Welcome, ${user.firstName}!`),
              React.createElement('button', {
                onClick: () => {
                  sessionStorage.removeItem('cf360_authenticated');
                  sessionStorage.removeItem('cf360_user');
                  setUser(null);
                  window.location.href = './landing.html';
                },
                className: 'bg-red-600 px-2 py-1 sm:px-3 sm:py-1 rounded text-xs sm:text-sm hover:bg-red-700'
              }, 'Logout')
            )
          ),

          // Navigation - Mobile Responsive
          React.createElement('nav', { className: 'bg-gray-800 p-2 sm:p-4 overflow-x-auto' },
            React.createElement('div', { className: 'flex space-x-2 sm:space-x-6 min-w-max' },
              ['clients', 'dashboard', 'properties', 'tasks', 'analytics'].map(view =>
                React.createElement('button', {
                  key: view,
                  onClick: () => setCurrentView(view),
                  className: `capitalize px-2 py-1 sm:px-4 sm:py-2 rounded transition-colors text-sm sm:text-base whitespace-nowrap ${
                    currentView === view 
                      ? 'bg-red-600 text-white' 
                      : 'text-gray-300 hover:bg-gray-700'
                  }`
                }, view.charAt(0).toUpperCase() + view.slice(1))
              )
            )
          ),

          // Voice Status
          voiceStatus && React.createElement('div', { 
            className: 'bg-blue-600 text-white p-2 text-center text-sm'
          }, voiceStatus),

          // Error Display
          error && React.createElement('div', { 
            className: 'bg-red-600 text-white p-4 text-center'
          }, error),

          // Loading indicator
          loading && React.createElement('div', { 
            className: 'bg-yellow-600 text-white p-2 text-center text-sm'
          }, '⏳ Loading...'),

          // Main Content - Mobile Responsive
          React.createElement('main', { className: 'p-3 sm:p-6' },
            currentView === 'clients' && React.createElement(ClientsView, {
              clients: filteredClients,
              setClients,
              allTags,
              searchTerm,
              setSearchTerm,
              selectedTag,
              setSelectedTag,
              setSelectedClient,
              setShowCallModal,
              setShowAddClientModal,
              setShowPropertyModal,
              startVoiceRecognition,
              isListening,
              startVoiceTaskCreation,
              isListeningForTask
            }),
            
            currentView === 'dashboard' && React.createElement(DashboardView, { clients }),
            currentView === 'properties' && React.createElement(PropertiesView, { 
              clients, 
              setClients,
              user,
              saveUserClients
            }),
            currentView === 'tasks' && React.createElement(TasksView, { 
              clients, 
              setClients,
              generalTasks,
              setGeneralTasks,
              setTaskFormData,
              setShowVoiceTaskModal,
              startVoiceTaskCreation,
              isListeningForTask,
              setVoiceStatus
            }),

            currentView === 'analytics' && React.createElement(AnalyticsView, { clients })
          ),

          // Modals
          selectedClient && React.createElement(ClientDetailModal, {
            key: `client-modal-${selectedClient.id}-${selectedClient.calls?.length || 0}-${selectedClient.todos?.length || 0}-${JSON.stringify(selectedClient.todos?.map(t => t.completed) || [])}`,
            client: selectedClient,
            onClose: () => setSelectedClient(null),
            handleAddProperty,
            handleEditProperty,
            handleSaveProperty,
            handleDeleteProperty,
            showPropertyDetail,
            setShowPropertyDetail,
            showEditProperty,
            setShowEditProperty,
            propertyFormData,
            setPropertyFormData,
            showAddProperty,
            setShowAddProperty,
            setVoiceStatus,
            // Add call logging props
            clients,
            setClients,
            setSelectedClient,
            // Add voice task props
            startVoiceTaskCreation,
            isListeningForTask,
            showVoiceTaskModal,
            setShowVoiceTaskModal,
            taskFormData,
            setTaskFormData,
            saveTask
          }),

          showCallModal && React.createElement(CallLogModal, {
            client: showCallModal,
            onClose: () => setShowCallModal(null),
            onLog: logCall
          }),

          showAddClientModal && React.createElement(AddClientModal, {
            onClose: () => setShowAddClientModal(false),
            onAdd: addClient
          }),

          // Voice Task Modal
          showVoiceTaskModal && React.createElement(VoiceTaskModal, {
            taskData: taskFormData,
            onClose: () => setShowVoiceTaskModal(false),
            onSave: saveTask,
            clients: clients
          }),

          // Add/Edit Property Modal
          (showAddProperty || showEditProperty) && React.createElement('div', { 
            className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50',
            onClick: () => { setShowAddProperty(false); setShowEditProperty(null); }
          },
            React.createElement('div', { 
              className: 'bg-gray-800 rounded-lg p-6 max-w-2xl w-full mx-4 max-h-96 overflow-y-auto',
              onClick: (e) => e.stopPropagation()
            },
              React.createElement('div', { className: 'flex justify-between items-center mb-4' },
                React.createElement('h3', { className: 'text-xl font-bold' }, 
                  showEditProperty ? `Edit Property - ${showEditProperty.address}` : 'Add New Property'
                ),
                React.createElement('button', {
                  onClick: () => { setShowAddProperty(false); setShowEditProperty(null); },
                  className: 'text-gray-400 hover:text-white text-2xl'
                }, '×')
              ),
              
              React.createElement('form', { 
                onSubmit: (e) => { e.preventDefault(); handleSaveProperty(); },
                className: 'space-y-4' 
              },
                // Address
                React.createElement('div', null,
                  React.createElement('label', { className: 'block text-sm font-medium text-gray-300 mb-1' }, 'Property Address *'),
                  React.createElement('input', {
                    type: 'text',
                    placeholder: '123 Main Street, Los Angeles, CA 90210',
                    value: propertyFormData.address || '',
                    onChange: (e) => setPropertyFormData(prev => ({ ...prev, address: e.target.value })),
                    className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white placeholder-gray-400',
                    required: true
                  })
                ),
                
                // Price and Property Type
                React.createElement('div', { className: 'grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4' },
                  React.createElement('div', null,
                    React.createElement('label', { className: 'block text-sm font-medium text-gray-300 mb-1' }, 'Price *'),
                    React.createElement('input', {
                      type: 'number',
                      placeholder: '750000',
                      value: propertyFormData.price || '',
                      onChange: (e) => setPropertyFormData(prev => ({ ...prev, price: e.target.value })),
                      className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white placeholder-gray-400',
                      required: true
                    })
                  ),
                  React.createElement('div', null,
                    React.createElement('label', { className: 'block text-sm font-medium text-gray-300 mb-1' }, 'Property Type'),
                    React.createElement('select', {
                      value: propertyFormData.propertyType || 'house',
                      onChange: (e) => setPropertyFormData(prev => ({ ...prev, propertyType: e.target.value })),
                      className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white'
                    },
                      React.createElement('option', { value: 'house' }, 'House'),
                      React.createElement('option', { value: 'condo' }, 'Condo'),
                      React.createElement('option', { value: 'townhouse' }, 'Townhouse'),
                      React.createElement('option', { value: 'apartment' }, 'Apartment'),
                      React.createElement('option', { value: 'duplex' }, 'Duplex'),
                      React.createElement('option', { value: 'commercial' }, 'Commercial'),
                      React.createElement('option', { value: 'land' }, 'Land')
                    )
                  )
                ),
                
                // Bedrooms, Bathrooms, Square Feet
                React.createElement('div', { className: 'grid grid-cols-3 gap-4' },
                  React.createElement('div', null,
                    React.createElement('label', { className: 'block text-sm font-medium text-gray-300 mb-1' }, 'Bedrooms'),
                    React.createElement('input', {
                      type: 'number',
                      placeholder: '3',
                      value: propertyFormData.bedrooms || '',
                      onChange: (e) => setPropertyFormData(prev => ({ ...prev, bedrooms: e.target.value })),
                      className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white placeholder-gray-400'
                    })
                  ),
                  React.createElement('div', null,
                    React.createElement('label', { className: 'block text-sm font-medium text-gray-300 mb-1' }, 'Bathrooms'),
                    React.createElement('input', {
                      type: 'number',
                      step: '0.5',
                      placeholder: '2.5',
                      value: propertyFormData.bathrooms || '',
                      onChange: (e) => setPropertyFormData(prev => ({ ...prev, bathrooms: e.target.value })),
                      className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white placeholder-gray-400'
                    })
                  ),
                  React.createElement('div', null,
                    React.createElement('label', { className: 'block text-sm font-medium text-gray-300 mb-1' }, 'Square Feet'),
                    React.createElement('input', {
                      type: 'number',
                      placeholder: '2500',
                      value: propertyFormData.sqft || '',
                      onChange: (e) => setPropertyFormData(prev => ({ ...prev, sqft: e.target.value })),
                      className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white placeholder-gray-400'
                    })
                  )
                ),
                
                // Year Built, Lot Size, Status
                React.createElement('div', { className: 'grid grid-cols-3 gap-4' },
                  React.createElement('div', null,
                    React.createElement('label', { className: 'block text-sm font-medium text-gray-300 mb-1' }, 'Year Built'),
                    React.createElement('input', {
                      type: 'number',
                      placeholder: '2010',
                      value: propertyFormData.yearBuilt || '',
                      onChange: (e) => setPropertyFormData(prev => ({ ...prev, yearBuilt: e.target.value })),
                      className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white placeholder-gray-400'
                    })
                  ),
                  React.createElement('div', null,
                    React.createElement('label', { className: 'block text-sm font-medium text-gray-300 mb-1' }, 'Lot Size (acres)'),
                    React.createElement('input', {
                      type: 'number',
                      step: '0.1',
                      placeholder: '0.25',
                      value: propertyFormData.lotSize || '',
                      onChange: (e) => setPropertyFormData(prev => ({ ...prev, lotSize: e.target.value })),
                      className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white placeholder-gray-400'
                    })
                  ),
                  React.createElement('div', null,
                    React.createElement('label', { className: 'block text-sm font-medium text-gray-300 mb-1' }, 'Status'),
                    React.createElement('select', {
                      value: propertyFormData.status || 'active',
                      onChange: (e) => setPropertyFormData(prev => ({ ...prev, status: e.target.value })),
                      className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white'
                    },
                      React.createElement('option', { value: 'active' }, 'Active'),
                      React.createElement('option', { value: 'pending' }, 'Pending'),
                      React.createElement('option', { value: 'sold' }, 'Sold'),
                      React.createElement('option', { value: 'withdrawn' }, 'Withdrawn'),
                      React.createElement('option', { value: 'contingent' }, 'Contingent')
                    )
                  )
                ),
                
                // Description
                React.createElement('div', null,
                  React.createElement('label', { className: 'block text-sm font-medium text-gray-300 mb-1' }, 'Description'),
                  React.createElement('textarea', {
                    placeholder: 'Beautiful modern home with stunning views...',
                    value: propertyFormData.description || '',
                    onChange: (e) => setPropertyFormData(prev => ({ ...prev, description: e.target.value })),
                    rows: 3,
                    className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white placeholder-gray-400'
                  })
                ),
                
                // Features
                React.createElement('div', null,
                  React.createElement('label', { className: 'block text-sm font-medium text-gray-300 mb-1' }, 'Key Features'),
                  React.createElement('input', {
                    type: 'text',
                    placeholder: 'Pool, Garage, Fireplace, Hardwood Floors, etc.',
                    value: propertyFormData.features || '',
                    onChange: (e) => setPropertyFormData(prev => ({ ...prev, features: e.target.value })),
                    className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white placeholder-gray-400'
                  })
                ),
                
                // Action Buttons
                React.createElement('div', { className: 'flex space-x-3 pt-4 border-t border-gray-600' },
                  React.createElement('button', {
                    type: 'submit',
                    className: 'flex-1 bg-green-600 text-white p-3 rounded hover:bg-green-700 font-semibold'
                  }, showEditProperty ? '💾 Update Property' : '🏠 Add Property'),
                  React.createElement('button', {
                    type: 'button',
                    onClick: () => { setShowAddProperty(false); setShowEditProperty(null); },
                    className: 'flex-1 bg-gray-600 text-white p-3 rounded hover:bg-gray-700'
                  }, '❌ Cancel')
                )
              )
            )
          ),

          showPropertyModal && React.createElement(PropertyModal, {
            client: showPropertyModal,
            onClose: () => setShowPropertyModal(null)
          })
        );
      }

      // Login Form Component
      function LoginForm({ onLogin, error }) {
        const [email, setEmail] = useState('rodrigo@clientflow360.com');
        const [password, setPassword] = useState('admin123');

        const handleSubmit = (e) => {
          e.preventDefault();
          onLogin(email, password);
        };

        return React.createElement('div', { 
          className: 'min-h-screen bg-gray-900 flex items-center justify-center'
        },
          React.createElement('div', { className: 'bg-gray-800 p-8 rounded-lg shadow-xl w-96' },
            React.createElement('h1', { 
              className: 'text-3xl font-bold text-red-500 mb-6 text-center',
              style: { fontFamily: 'Arial, sans-serif', letterSpacing: '-0.5px' }
            }, 'CLIENT FLOW 360'),
            
            error && React.createElement('div', { 
              className: 'bg-red-600 text-white p-3 rounded mb-4 text-sm'
            }, error),
            
            React.createElement('form', { onSubmit: handleSubmit, className: 'space-y-4' },
              React.createElement('input', {
                type: 'email',
                placeholder: 'Email',
                value: email,
                onChange: (e) => setEmail(e.target.value),
                className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white placeholder-gray-400 focus:border-red-500 focus:outline-none',
                required: true
              }),
              React.createElement('input', {
                type: 'password',
                placeholder: 'Password',
                value: password,
                onChange: (e) => setPassword(e.target.value),
                className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white placeholder-gray-400 focus:border-red-500 focus:outline-none',
                required: true
              }),
              React.createElement('button', {
                type: 'submit',
                className: 'w-full bg-red-600 text-white p-3 rounded hover:bg-red-700 transition-colors font-semibold'
              }, 'Login')
            ),
            
            React.createElement('div', { className: 'mt-4 text-center text-gray-400 text-sm' },
              'Demo: rodrigo@clientflow360.com / admin123'
            )
          )
        );
      }

      // Clients View Component
      function ClientsView({ 
        clients, setClients, allTags, searchTerm, setSearchTerm, selectedTag, setSelectedTag, 
        setSelectedClient, setShowCallModal, setShowAddClientModal, setShowPropertyModal,
        startVoiceRecognition, isListening, startVoiceTaskCreation, isListeningForTask 
      }) {
        return React.createElement('div', null,
          React.createElement('div', { className: 'flex justify-between items-center mb-6' },
            React.createElement('div', null,
              React.createElement('h2', { className: 'text-3xl font-bold mb-1' }, 'My Clients'),
              React.createElement('p', { className: 'text-gray-400' }, `${clients.length} active clients in your portfolio`)
            ),
            React.createElement('div', { className: 'flex space-x-3' },
              React.createElement('button', {
                onClick: () => setShowAddClientModal(true),
                className: 'bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition-colors'
              }, '+ Add Client'),

              React.createElement('button', {
                onClick: startVoiceTaskCreation,
                disabled: isListeningForTask,
                className: `px-4 py-2 rounded transition-colors ${
                  isListeningForTask 
                    ? 'bg-orange-600 text-white cursor-not-allowed animate-pulse' 
                    : 'bg-purple-600 text-white hover:bg-purple-700'
                }`
              }, isListeningForTask ? '🎤 Task Listening...' : '📝 Voice Task')
            )
          ),

          // Search and Filters
          React.createElement('div', { className: 'mb-6 flex space-x-4' },
            React.createElement('input', {
              type: 'text',
              placeholder: 'Search clients...',
              value: searchTerm,
              onChange: (e) => setSearchTerm(e.target.value),
              className: 'flex-1 p-3 bg-gray-800 rounded border border-gray-700 text-white placeholder-gray-400 focus:border-red-500 focus:outline-none'
            }),
            React.createElement('select', {
              value: selectedTag,
              onChange: (e) => setSelectedTag(e.target.value),
              className: 'p-3 bg-gray-800 rounded border border-gray-700 text-white focus:border-red-500 focus:outline-none'
            },
              React.createElement('option', { value: '' }, 'All Tags'),
              allTags.map(tag => 
                React.createElement('option', { key: tag, value: tag }, tag)
              )
            )
          ),

          // Stats
          React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-4 gap-4 mb-6' },
            React.createElement('div', { className: 'bg-gray-800 p-4 rounded' },
              React.createElement('div', { className: 'text-2xl font-bold text-green-400' }, clients.length),
              React.createElement('div', { className: 'text-gray-400' }, 'Total Clients')
            ),
            React.createElement('div', { className: 'bg-gray-800 p-4 rounded' },
              React.createElement('div', { className: 'text-2xl font-bold text-blue-400' }, 
                clients.filter(c => c.stage === 'ACTIVE').length
              ),
              React.createElement('div', { className: 'text-gray-400' }, 'Active Deals')
            ),
            React.createElement('div', { className: 'bg-gray-800 p-4 rounded' },
              React.createElement('div', { className: 'text-2xl font-bold text-yellow-400' }, 
                `$${clients.reduce((sum, c) => sum + (c.lifetimeNetCommission || 0), 0).toLocaleString()}`
              ),
              React.createElement('div', { className: 'text-gray-400' }, 'Total Commission')
            ),
            React.createElement('div', { className: 'bg-gray-800 p-4 rounded' },
              React.createElement('div', { className: 'text-2xl font-bold text-purple-400' }, 
                clients.reduce((sum, c) => sum + (c.calls ? c.calls.length : 0), 0)
              ),
              React.createElement('div', { className: 'text-gray-400' }, 'Total Calls')
            )
          ),

          // Netflix-style Clients Grid - Mobile Optimized
          React.createElement('div', { 
            className: 'grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3 sm:gap-6 pb-20 px-2 sm:px-0',
            style: { minHeight: '400px' } // Ensure space for hover overlays
          },
            clients.map(client => React.createElement(ClientCard, {
              key: client.id,
              client,
              onViewDetails: () => setSelectedClient(client),
              onLogCall: () => setShowCallModal(client),
              onManageProperties: () => setShowPropertyModal(client)
            }))
          ),

          clients.length === 0 && React.createElement('div', { 
            className: 'text-center py-12 text-gray-400'
          }, 
            React.createElement('p', { className: 'text-xl mb-2' }, 'No clients found'),
            React.createElement('p', null, 'Try adjusting your search or filters')
          )
        );
      }

      // Client Card Component - Netflix Movie Tile Style
      function ClientCard({ client, onViewDetails, onLogCall, onManageProperties }) {
        const clientName = `${client.firstName || client.first_name || 'Unknown'} ${client.lastName || client.last_name || 'Client'}`;
        const initials = `${(client.firstName || client.first_name || 'A')[0]}${(client.lastName || client.last_name || 'A')[0]}`;
        
        // Birthday calculations
        const getBirthdayInfo = (birthdayStr) => {
          if (!birthdayStr) return null;
          
          const today = new Date();
          const birthday = new Date(birthdayStr);
          const thisYear = today.getFullYear();
          
          // Set birthday to this year
          const thisYearBirthday = new Date(thisYear, birthday.getMonth(), birthday.getDate());
          
          // If birthday already passed this year, use next year
          const nextBirthday = thisYearBirthday < today 
            ? new Date(thisYear + 1, birthday.getMonth(), birthday.getDate())
            : thisYearBirthday;
          
          const daysUntil = Math.ceil((nextBirthday - today) / (1000 * 60 * 60 * 24));
          
          return {
            date: birthday,
            daysUntil,
            isUpcoming: daysUntil <= 30,
            isSoon: daysUntil <= 7,
            isToday: daysUntil === 0
          };
        };
        
        const birthdayInfo = getBirthdayInfo(client.birthday);
        
        // Generate a unique gradient based on client name for visual variety
        const gradients = [
          'from-red-600 to-red-800',
          'from-blue-600 to-blue-800', 
          'from-green-600 to-green-800',
          'from-purple-600 to-purple-800',
          'from-yellow-600 to-yellow-800',
          'from-pink-600 to-pink-800',
          'from-indigo-600 to-indigo-800',
          'from-teal-600 to-teal-800'
        ];
        const gradientIndex = (clientName.charCodeAt(0) + clientName.charCodeAt(1)) % gradients.length;
        const gradient = gradients[gradientIndex];

        return React.createElement('div', { 
          className: 'relative group cursor-pointer transform transition-all duration-300 hover:scale-105',
          onClick: onViewDetails,
          style: { aspectRatio: '16/9' }
        },
          // Main Netflix-style tile
          React.createElement('div', { 
            className: `relative w-full h-full bg-gradient-to-br ${gradient} rounded-lg overflow-hidden shadow-xl`
          },
            // Background pattern for visual interest
            React.createElement('div', {
              className: 'absolute inset-0 opacity-20',
              style: {
                backgroundImage: 'radial-gradient(circle at 50% 50%, rgba(255,255,255,0.1) 1px, transparent 1px)',
                backgroundSize: '20px 20px'
              }
            }),
            
            // Status badges (top-right corner)
            React.createElement('div', { className: 'absolute top-3 right-3 flex flex-col gap-1' },
              React.createElement('div', { 
                className: `px-2 py-1 rounded-full text-xs font-bold ${
                  client.stage === 'ACTIVE' ? 'bg-green-500 text-white' :
                  client.stage === 'PENDING' ? 'bg-yellow-500 text-black' :
                  'bg-gray-500 text-white'
                }`
              }, client.stage || 'ACTIVE'),
              
              // Birthday badge
              birthdayInfo && birthdayInfo.isUpcoming && React.createElement('div', {
                className: `px-2 py-1 rounded-full text-xs font-bold ${
                  birthdayInfo.isToday ? 'bg-pink-500 text-white animate-pulse' :
                  birthdayInfo.isSoon ? 'bg-orange-500 text-white' :
                  'bg-blue-500 text-white'
                }`
              }, 
                birthdayInfo.isToday ? '🎂 TODAY!' :
                birthdayInfo.isSoon ? `🎂 ${birthdayInfo.daysUntil}d` :
                `🎂 ${birthdayInfo.daysUntil}d`
              )
            ),

            // Client avatar (large, centered)
            React.createElement('div', { className: 'absolute inset-0 flex items-center justify-center' },
              React.createElement('div', { 
                className: 'w-20 h-20 bg-black bg-opacity-30 rounded-full flex items-center justify-center text-white font-bold text-3xl border-4 border-white border-opacity-50'
              }, initials)
            ),

            // Client info overlay (bottom)
            React.createElement('div', { 
              className: 'absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black via-black to-transparent p-4'
            },
              React.createElement('h3', { className: 'text-white font-bold text-lg mb-1' }, clientName),
              React.createElement('p', { className: 'text-gray-300 text-sm mb-2' }, client.email),
              React.createElement('div', { className: 'flex items-center justify-between' },
                React.createElement('span', { className: 'text-green-400 font-semibold text-sm' }, 
                  `$${(client.lifetimeNetCommission || 0).toLocaleString()}`
                ),
                React.createElement('span', { className: 'text-gray-400 text-xs' }, 
                  `${client.calls ? client.calls.length : 0} calls`
                )
              )
            ),

            // Tags overlay (top-left)
            client.tags && client.tags.length > 0 && React.createElement('div', { 
              className: 'absolute top-3 left-3 flex flex-wrap gap-1'
            },
              client.tags.slice(0, 2).map((tag, index) =>
                React.createElement('span', {
                  key: index,
                  className: 'px-2 py-1 bg-black bg-opacity-60 text-white rounded text-xs font-medium'
                }, tag)
              )
            )
          ),

          // Netflix-style hover overlay with actions
          React.createElement('div', { 
            className: 'absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-60 transition-all duration-300 flex items-center justify-center opacity-0 group-hover:opacity-100'
          },
            React.createElement('div', { className: 'flex space-x-3' },
              React.createElement('button', {
                onClick: (e) => { e.stopPropagation(); onViewDetails(); },
                className: 'bg-white text-black px-4 py-2 rounded-full font-semibold hover:bg-gray-200 transition-colors flex items-center space-x-2'
              }, 
                React.createElement('span', null, '▶'),
                React.createElement('span', null, 'Details')
              ),
              React.createElement('button', {
                onClick: (e) => { e.stopPropagation(); onLogCall(); },
                className: 'bg-gray-700 text-white px-4 py-2 rounded-full font-semibold hover:bg-gray-600 transition-colors flex items-center space-x-2'
              }, 
                React.createElement('span', null, '📞'),
                React.createElement('span', null, 'Call')
              ),
              React.createElement('button', {
                onClick: (e) => { e.stopPropagation(); onManageProperties(); },
                className: 'bg-gray-700 text-white px-4 py-2 rounded-full font-semibold hover:bg-gray-600 transition-colors flex items-center space-x-2'
              }, 
                React.createElement('span', null, '🏠'),
                React.createElement('span', null, 'Properties')
              )
            )
          ),

          // Netflix-style bottom info bar (appears on hover)
          React.createElement('div', { 
            className: 'absolute -bottom-20 left-0 right-0 bg-gray-800 p-4 rounded-b-lg shadow-xl opacity-0 group-hover:opacity-100 transform group-hover:translate-y-0 translate-y-2 transition-all duration-300'
          },
            React.createElement('div', { className: 'flex justify-between items-start mb-2' },
              React.createElement('div', null,
                React.createElement('p', { className: 'text-white font-semibold' }, clientName),
                React.createElement('p', { className: 'text-gray-400 text-sm' }, 
                  `📍 ${client.city || 'Los Angeles'}, ${client.state || 'CA'}`
                )
              ),
              React.createElement('div', { className: 'text-right' },
                React.createElement('p', { className: 'text-green-400 font-bold' }, 
                  `$${(client.lifetimeNetCommission || 0).toLocaleString()}`
                ),
                React.createElement('p', { className: 'text-gray-400 text-xs' }, 'LTV')
              )
            ),
            client.tags && client.tags.length > 0 && React.createElement('div', { className: 'flex flex-wrap gap-1 mb-2' },
              client.tags.map((tag, index) =>
                React.createElement('span', {
                  key: index,
                  className: 'px-2 py-1 bg-blue-600 text-blue-100 rounded text-xs'
                }, tag)
              )
            ),
            client.notes && React.createElement('p', { className: 'text-gray-300 text-sm line-clamp-2' }, 
              client.notes
            )
          )
        );
      }

      // Dashboard View Component
      function DashboardView({ clients }) {
        const today = new Date();
        const thisMonth = today.getMonth();
        const thisYear = today.getFullYear();
        
        // Birthday calculations
        const getUpcomingBirthdays = (clients) => {
          return clients.filter(client => client.birthday).map(client => {
            const birthday = new Date(client.birthday);
            const thisYearBirthday = new Date(thisYear, birthday.getMonth(), birthday.getDate());
            const nextBirthday = thisYearBirthday < today 
              ? new Date(thisYear + 1, birthday.getMonth(), birthday.getDate())
              : thisYearBirthday;
            const daysUntil = Math.ceil((nextBirthday - today) / (1000 * 60 * 60 * 24));
            
            return {
              ...client,
              daysUntil,
              isToday: daysUntil === 0,
              nextBirthday
            };
          }).filter(client => client.daysUntil <= 30)
            .sort((a, b) => a.daysUntil - b.daysUntil);
        };
        
        const upcomingBirthdays = getUpcomingBirthdays(clients);
        
        const monthlyStats = {
          newClients: clients.filter(c => {
            const created = new Date(c.createdAt || c.created_at);
            return created.getMonth() === thisMonth && created.getFullYear() === thisYear;
          }).length,
          totalCommission: clients.reduce((sum, c) => sum + (c.lifetimeNetCommission || c.lifetime_commission || 0), 0),
          activDeals: clients.filter(c => c.stage === 'ACTIVE').length,
          callsMade: clients.reduce((sum, c) => sum + (c.calls ? c.calls.length : 0), 0),
          upcomingBirthdays: upcomingBirthdays.length
        };

        return React.createElement('div', null,
          React.createElement('h2', { className: 'text-3xl font-bold mb-6' }, 'Dashboard'),
          
          React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8' },
            React.createElement('div', { className: 'bg-gradient-to-r from-blue-600 to-blue-800 p-6 rounded-lg text-white' },
              React.createElement('h3', { className: 'text-lg font-semibold mb-2' }, 'New Clients This Month'),
              React.createElement('p', { className: 'text-3xl font-bold' }, monthlyStats.newClients),
              React.createElement('p', { className: 'text-blue-200 text-sm' }, 'Total clients added')
            ),
            React.createElement('div', { className: 'bg-gradient-to-r from-green-600 to-green-800 p-6 rounded-lg text-white' },
              React.createElement('h3', { className: 'text-lg font-semibold mb-2' }, 'Total Commission'),
              React.createElement('p', { className: 'text-3xl font-bold' }, `$${monthlyStats.totalCommission.toLocaleString()}`),
              React.createElement('p', { className: 'text-green-200 text-sm' }, 'Lifetime value')
            ),
            React.createElement('div', { className: 'bg-gradient-to-r from-pink-600 to-pink-800 p-6 rounded-lg text-white' },
              React.createElement('h3', { className: 'text-lg font-semibold mb-2' }, 'Upcoming Birthdays'),
              React.createElement('p', { className: 'text-3xl font-bold' }, monthlyStats.upcomingBirthdays),
              React.createElement('p', { className: 'text-pink-200 text-sm' }, 'Next 30 days')
            ),
            React.createElement('div', { className: 'bg-gradient-to-r from-yellow-600 to-yellow-800 p-6 rounded-lg text-white' },
              React.createElement('h3', { className: 'text-lg font-semibold mb-2' }, 'Active Deals'),
              React.createElement('p', { className: 'text-3xl font-bold' }, monthlyStats.activDeals),
              React.createElement('p', { className: 'text-yellow-200 text-sm' }, 'In progress')
            ),
            React.createElement('div', { className: 'bg-gradient-to-r from-purple-600 to-purple-800 p-6 rounded-lg text-white' },
              React.createElement('h3', { className: 'text-lg font-semibold mb-2' }, 'Calls Made'),
              React.createElement('p', { className: 'text-3xl font-bold' }, monthlyStats.callsMade),
              React.createElement('p', { className: 'text-purple-200 text-sm' }, 'Total calls logged')
            )
          ),

          // Birthday Alerts Section
          upcomingBirthdays.length > 0 && React.createElement('div', { className: 'mb-8' },
            React.createElement('div', { className: 'bg-gradient-to-r from-pink-500 to-rose-500 p-6 rounded-lg' },
              React.createElement('h3', { className: 'text-xl font-semibold mb-4 text-white flex items-center' },
                React.createElement('span', { className: 'mr-2' }, '🎂'),
                'Upcoming Birthdays'
              ),
              React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4' },
                upcomingBirthdays.map(client =>
                  React.createElement('div', { 
                    key: client.id, 
                    className: `bg-white bg-opacity-20 p-4 rounded-lg ${client.isToday ? 'ring-4 ring-yellow-300 animate-pulse' : ''}`
                  },
                    React.createElement('div', { className: 'flex items-center justify-between' },
                      React.createElement('div', null,
                        React.createElement('p', { className: 'font-semibold text-white' }, 
                          `${client.firstName || client.first_name} ${client.lastName || client.last_name}`
                        ),
                        React.createElement('p', { className: 'text-pink-100 text-sm' }, 
                          client.nextBirthday.toLocaleDateString('en-US', { month: 'long', day: 'numeric' })
                        )
                      ),
                      React.createElement('div', { className: 'text-right' },
                        React.createElement('p', { className: `font-bold text-lg ${client.isToday ? 'text-yellow-300' : 'text-white'}` }, 
                          client.isToday ? 'TODAY!' : client.daysUntil === 1 ? 'Tomorrow' : `${client.daysUntil} days`
                        )
                      )
                    )
                  )
                )
              )
            )
          ),

          React.createElement('div', { className: 'grid grid-cols-1 lg:grid-cols-2 gap-8' },
            React.createElement('div', { className: 'bg-gray-800 p-6 rounded-lg' },
              React.createElement('h3', { className: 'text-xl font-semibold mb-4' }, 'Recent Clients'),
              React.createElement('div', { className: 'space-y-4' },
                clients.slice(0, 5).map(client =>
                  React.createElement('div', { 
                    key: client.id, 
                    className: 'flex items-center justify-between p-3 bg-gray-700 rounded'
                  },
                    React.createElement('div', null,
                      React.createElement('p', { className: 'font-semibold' }, 
                        `${client.firstName || client.first_name || 'Unknown'} ${client.lastName || client.last_name || 'Client'}`
                      ),
                      React.createElement('p', { className: 'text-sm text-gray-400' }, client.email)
                    ),
                    React.createElement('span', { 
                      className: `px-2 py-1 rounded text-xs ${
                        client.stage === 'ACTIVE' ? 'bg-green-600 text-green-100' : 'bg-gray-600 text-gray-100'
                      }`
                    }, client.stage || 'ACTIVE')
                  )
                )
              )
            ),

            React.createElement('div', { className: 'bg-gray-800 p-6 rounded-lg' },
              React.createElement('h3', { className: 'text-xl font-semibold mb-4' }, 'Top Performers'),
              React.createElement('div', { className: 'space-y-4' },
                clients
                  .sort((a, b) => (b.lifetimeNetCommission || 0) - (a.lifetimeNetCommission || 0))
                  .slice(0, 5)
                  .map(client =>
                    React.createElement('div', { 
                      key: client.id, 
                      className: 'flex items-center justify-between p-3 bg-gray-700 rounded'
                    },
                      React.createElement('div', null,
                        React.createElement('p', { className: 'font-semibold' }, 
                          `${client.firstName || client.first_name || 'Unknown'} ${client.lastName || client.last_name || 'Client'}`
                        ),
                        React.createElement('p', { className: 'text-sm text-gray-400' }, 
                          `${client.calls ? client.calls.length : 0} calls`
                        )
                      ),
                      React.createElement('span', { className: 'text-green-400 font-semibold' }, 
                        `$${(client.lifetimeNetCommission || 0).toLocaleString()}`
                      )
                    )
                  )
              )
            )
          )
        );
      }

      // Properties View Component
      function PropertiesView({ clients, setClients, user, saveUserClients }) {
        const [propertySearchTerm, setPropertySearchTerm] = useState('');
        const [priceRange, setPriceRange] = useState('');
        const [propertyTypeFilter, setPropertyTypeFilter] = useState('');
        const [statusFilter, setStatusFilter] = useState('');
        const [bedroomsFilter, setBedroomsFilter] = useState('');
        const [showPropertyDetail, setShowPropertyDetail] = useState(null);
        
        // NEW: Add Property Modal State
        const [showAddPropertyModal, setShowAddPropertyModal] = useState(false);
        const [showEditPropertyModal, setShowEditPropertyModal] = useState(false);
        const [editingProperty, setEditingProperty] = useState(null);
        const [propertyFormData, setPropertyFormData] = useState({
          address: '',
          price: '',
          bedrooms: '',
          bathrooms: '',
          sqft: '',
          propertyType: 'house',
          status: 'active',
          description: '',
          yearBuilt: '',
          lotSize: '',
          features: '',
          clientId: ''
        });
        
        // NEW: Property API Integration State
        const [isLoadingPropertyData, setIsLoadingPropertyData] = useState(false);
        const [apiPropertyData, setApiPropertyData] = useState(null);
        
        // NEW: Property Management Functions
        
        // Add Property Functions
        const handleAddProperty = () => {
          setPropertyFormData({
            address: '',
            price: '',
            bedrooms: '',
            bathrooms: '',
            sqft: '',
            propertyType: 'house',
            status: 'active',
            description: '',
            yearBuilt: '',
            lotSize: '',
            features: '',
            clientId: ''
          });
          setShowAddPropertyModal(true);
        };

        const handleSaveProperty = () => {
          if (!propertyFormData.address.trim()) {
            alert('❌ Please enter a property address');
            return;
          }
          
          if (!propertyFormData.clientId) {
            alert('❌ Please select a client to associate with this property');
            return;
          }

          const newProperty = {
            id: 'prop-' + Date.now(),
            address: propertyFormData.address,
            price: parseInt(propertyFormData.price) || 0,
            bedrooms: parseInt(propertyFormData.bedrooms) || 0,
            bathrooms: parseInt(propertyFormData.bathrooms) || 0,
            sqft: parseInt(propertyFormData.sqft) || 0,
            propertyType: propertyFormData.propertyType,
            status: propertyFormData.status,
            description: propertyFormData.description,
            yearBuilt: propertyFormData.yearBuilt,
            lotSize: propertyFormData.lotSize,
            features: propertyFormData.features ? propertyFormData.features.split(',').map(f => f.trim()) : [],
            createdAt: new Date().toISOString()
          };

          // Add property to selected client
          setClients(prevClients => {
            const updatedClients = prevClients.map(client => {
              if (client.id === propertyFormData.clientId) {
                const updatedClient = {
                  ...client,
                  propertiesOfInterest: [...(client.propertiesOfInterest || []), newProperty]
                };
                console.log('✅ Added property to client:', {
                  clientName: `${client.firstName} ${client.lastName}`,
                  propertyAddress: newProperty.address,
                  propertyId: newProperty.id
                });
                return updatedClient;
              }
              return client;
            });
            
            // Save updated clients to storage
            saveUserClients(user, updatedClients);
            return updatedClients;
          });

          setShowAddPropertyModal(false);
          alert(`✅ Property "${newProperty.address}" added successfully!`);
        };
        
        // Property Editing Functions
        const handleEditProperty = (property) => {
          setEditingProperty(property);
          setPropertyFormData({
            address: property.address || '',
            price: property.price || '',
            bedrooms: property.bedrooms || '',
            bathrooms: property.bathrooms || '',
            sqft: property.sqft || '',
            propertyType: property.propertyType || 'house',
            status: property.status || 'active',
            description: property.description || '',
            yearBuilt: property.yearBuilt || '',
            lotSize: property.lotSize || '',
            features: Array.isArray(property.features) ? property.features.join(', ') : (property.features || ''),
            clientId: property.clientId || ''
          });
          setShowEditPropertyModal(true);
        };

        const handleUpdateProperty = () => {
          if (!propertyFormData.address.trim()) {
            alert('❌ Please enter a property address');
            return;
          }

          const updatedProperty = {
            ...editingProperty,
            address: propertyFormData.address,
            price: parseInt(propertyFormData.price) || 0,
            bedrooms: parseInt(propertyFormData.bedrooms) || 0,
            bathrooms: parseInt(propertyFormData.bathrooms) || 0,
            sqft: parseInt(propertyFormData.sqft) || 0,
            propertyType: propertyFormData.propertyType,
            status: propertyFormData.status,
            description: propertyFormData.description,
            yearBuilt: propertyFormData.yearBuilt,
            lotSize: propertyFormData.lotSize,
            features: propertyFormData.features ? propertyFormData.features.split(',').map(f => f.trim()) : [],
            updatedAt: new Date().toISOString()
          };

          // Update property in client's propertiesOfInterest array
          setClients(prevClients => {
            const updatedClients = prevClients.map(client => {
              if (client.id === editingProperty.clientId) {
                const updatedPropertiesOfInterest = (client.propertiesOfInterest || []).map(prop => 
                  prop.id === editingProperty.id ? updatedProperty : prop
                );
                const updatedClient = {
                  ...client,
                  propertiesOfInterest: updatedPropertiesOfInterest
                };
                console.log('✅ Updated property for client:', {
                  clientName: `${client.firstName} ${client.lastName}`,
                  propertyAddress: updatedProperty.address,
                  propertyId: updatedProperty.id
                });
                return updatedClient;
              }
              return client;
            });
            
            // Save updated clients to storage
            saveUserClients(user, updatedClients);
            return updatedClients;
          });

          setShowEditPropertyModal(false);
          setEditingProperty(null);
          alert(`✅ Property "${updatedProperty.address}" updated successfully!`);
        };

        // RealtyMole API Integration Functions
        const fetchPropertyFromAPI = async (address) => {
          if (!address.trim()) {
            alert('❌ Please enter an address to search');
            return;
          }

          setIsLoadingPropertyData(true);
          setApiPropertyData(null);

          try {
            // RealtyMole Property API endpoint for property search
            const apiKey = 'your-realtymole-api-key'; // You'll need to get this from RealtyMole
            const encodedAddress = encodeURIComponent(address);
            
            // Using RealtyMole's property search endpoint
            const response = await fetch(`https://api.realtymole.com/v1/properties/search?address=${encodedAddress}`, {
              headers: {
                'X-API-KEY': apiKey,
                'Content-Type': 'application/json'
              }
            });

            if (!response.ok) {
              throw new Error(`API Error: ${response.status}`);
            }

            const data = await response.json();
            
            if (data && data.length > 0) {
              const property = data[0]; // Get first result
              setApiPropertyData({
                address: property.address || address,
                price: property.price || property.estimate || 0,
                bedrooms: property.bedrooms || 0,
                bathrooms: property.bathrooms || 0,
                sqft: property.square_feet || property.sqft || 0,
                yearBuilt: property.year_built || '',
                lotSize: property.lot_size || '',
                propertyType: property.property_type || 'house',
                description: property.description || '',
                features: property.features || []
              });
              
              // Auto-populate form with API data
              setPropertyFormData(prev => ({
                ...prev,
                address: property.address || prev.address,
                price: property.price || property.estimate || prev.price,
                bedrooms: property.bedrooms || prev.bedrooms,
                bathrooms: property.bathrooms || prev.bathrooms,
                sqft: property.square_feet || property.sqft || prev.sqft,
                yearBuilt: property.year_built || prev.yearBuilt,
                lotSize: property.lot_size || prev.lotSize,
                propertyType: property.property_type || prev.propertyType,
                description: property.description || prev.description,
                features: Array.isArray(property.features) ? property.features.join(', ') : (prev.features || '')
              }));
              
              alert('✅ Property data loaded from API! Review and save.');
            } else {
              alert('⚠️ No property data found for this address. You can still add it manually.');
            }

          } catch (error) {
            console.error('❌ API Error:', error);
            // Fallback: Show demo data for development
            const demoData = {
              address: address,
              price: Math.floor(Math.random() * 800000) + 200000,
              bedrooms: Math.floor(Math.random() * 4) + 2,
              bathrooms: Math.floor(Math.random() * 3) + 1,
              sqft: Math.floor(Math.random() * 2000) + 1000,
              yearBuilt: Math.floor(Math.random() * 30) + 1990,
              lotSize: (Math.random() * 0.5 + 0.1).toFixed(2) + ' acres',
              propertyType: 'house',
              description: 'Property data from demo API (development mode)',
              features: ['Garage', 'Backyard', 'Modern Kitchen']
            };
            
            setApiPropertyData(demoData);
            setPropertyFormData(prev => ({
              ...prev,
              ...demoData,
              features: demoData.features.join(', ')
            }));
            
            alert('🔧 Demo mode: Property data simulated (API key required for live data)');
          } finally {
            setIsLoadingPropertyData(false);
          }
        };

        // Delete Property Function
        const handleDeleteProperty = (property) => {
          if (confirm(`Are you sure you want to delete the property "${property.address}"?`)) {
            setClients(prevClients => {
              const updatedClients = prevClients.map(client => {
                if (client.id === property.clientId) {
                  const updatedPropertiesOfInterest = (client.propertiesOfInterest || []).filter(prop => 
                    prop.id !== property.id
                  );
                  return {
                    ...client,
                    propertiesOfInterest: updatedPropertiesOfInterest
                  };
                }
                return client;
              });
              
              saveUserClients(user, updatedClients);
              return updatedClients;
            });
            
            alert(`✅ Property "${property.address}" deleted successfully!`);
          }
        };
        
        const allProperties = clients.flatMap(client => 
          (client.propertiesOfInterest || []).map(property => ({
            ...property,
            clientName: `${client.firstName || client.first_name || 'Unknown'} ${client.lastName || client.last_name || 'Client'}`,
            clientId: client.id,
            clientEmail: client.email,
            clientPhone: client.phone
          }))
        );

        // Filter properties based on search criteria
        const filteredProperties = allProperties.filter(property => {
          const matchesSearch = !propertySearchTerm || 
            property.address?.toLowerCase().includes(propertySearchTerm.toLowerCase()) ||
            property.clientName?.toLowerCase().includes(propertySearchTerm.toLowerCase()) ||
            property.description?.toLowerCase().includes(propertySearchTerm.toLowerCase());

          const matchesPrice = !priceRange || (() => {
            const price = property.price || 0;
            switch(priceRange) {
              case 'under-500k': return price < 500000;
              case '500k-1m': return price >= 500000 && price < 1000000;
              case '1m-2m': return price >= 1000000 && price < 2000000;
              case '2m-5m': return price >= 2000000 && price < 5000000;
              case 'over-5m': return price >= 5000000;
              default: return true;
            }
          })();

          const matchesType = !propertyTypeFilter || property.propertyType === propertyTypeFilter;
          const matchesStatus = !statusFilter || property.status === statusFilter;
          const matchesBedrooms = !bedroomsFilter || property.bedrooms >= parseInt(bedroomsFilter);

          return matchesSearch && matchesPrice && matchesType && matchesStatus && matchesBedrooms;
        });

        return React.createElement('div', null,
          React.createElement('div', { className: 'flex justify-between items-center mb-6' },
            React.createElement('div', null,
              React.createElement('h2', { className: 'text-3xl font-bold mb-1' }, 'Property Management'),
              React.createElement('p', { className: 'text-gray-400' }, `${filteredProperties.length} properties found`)
            ),
            React.createElement('button', {
              onClick: handleAddProperty,
              className: 'bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 flex items-center space-x-2'
            },
              React.createElement('span', null, '+'),
              React.createElement('span', null, 'Add Property')
            )
          ),

          // Search and Filters
          React.createElement('div', { className: 'bg-gray-800 p-4 rounded-lg mb-6' },
            React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4' },
              React.createElement('input', {
                type: 'text',
                placeholder: 'Search properties or clients...',
                value: propertySearchTerm,
                onChange: (e) => setPropertySearchTerm(e.target.value),
                className: 'p-3 bg-gray-700 rounded border border-gray-600 text-white placeholder-gray-400 focus:border-blue-500'
              }),
              React.createElement('select', {
                value: priceRange,
                onChange: (e) => setPriceRange(e.target.value),
                className: 'p-3 bg-gray-700 rounded border border-gray-600 text-white focus:border-blue-500'
              },
                React.createElement('option', { value: '' }, 'All Prices'),
                React.createElement('option', { value: 'under-500k' }, 'Under $500K'),
                React.createElement('option', { value: '500k-1m' }, '$500K - $1M'),
                React.createElement('option', { value: '1m-2m' }, '$1M - $2M'),
                React.createElement('option', { value: '2m-5m' }, '$2M - $5M'),
                React.createElement('option', { value: 'over-5m' }, 'Over $5M')
              ),
              React.createElement('select', {
                value: propertyTypeFilter,
                onChange: (e) => setPropertyTypeFilter(e.target.value),
                className: 'p-3 bg-gray-700 rounded border border-gray-600 text-white focus:border-blue-500'
              },
                React.createElement('option', { value: '' }, 'All Types'),
                React.createElement('option', { value: 'house' }, 'House'),
                React.createElement('option', { value: 'condo' }, 'Condo'),
                React.createElement('option', { value: 'townhouse' }, 'Townhouse'),
                React.createElement('option', { value: 'apartment' }, 'Apartment'),
                React.createElement('option', { value: 'duplex' }, 'Duplex'),
                React.createElement('option', { value: 'commercial' }, 'Commercial'),
                React.createElement('option', { value: 'land' }, 'Land')
              ),
              React.createElement('select', {
                value: statusFilter,
                onChange: (e) => setStatusFilter(e.target.value),
                className: 'p-3 bg-gray-700 rounded border border-gray-600 text-white focus:border-blue-500'
              },
                React.createElement('option', { value: '' }, 'All Status'),
                React.createElement('option', { value: 'active' }, 'Active'),
                React.createElement('option', { value: 'pending' }, 'Pending'),
                React.createElement('option', { value: 'sold' }, 'Sold'),
                React.createElement('option', { value: 'withdrawn' }, 'Withdrawn'),
                React.createElement('option', { value: 'contingent' }, 'Contingent')
              ),
              React.createElement('select', {
                value: bedroomsFilter,
                onChange: (e) => setBedroomsFilter(e.target.value),
                className: 'p-3 bg-gray-700 rounded border border-gray-600 text-white focus:border-blue-500'
              },
                React.createElement('option', { value: '' }, 'Any Bedrooms'),
                React.createElement('option', { value: '1' }, '1+ Bedrooms'),
                React.createElement('option', { value: '2' }, '2+ Bedrooms'),
                React.createElement('option', { value: '3' }, '3+ Bedrooms'),
                React.createElement('option', { value: '4' }, '4+ Bedrooms'),
                React.createElement('option', { value: '5' }, '5+ Bedrooms')
              )
            )
          ),

          // Properties Grid
          filteredProperties.length === 0 ? 
            React.createElement('div', { className: 'text-center py-12 text-gray-400' },
              React.createElement('div', { className: 'text-6xl mb-4' }, '🏠'),
              React.createElement('p', { className: 'text-xl mb-2' }, 
                allProperties.length === 0 ? 'No properties found' : 'No properties match your filters'
              ),
              React.createElement('p', null, 
                allProperties.length === 0 ? 'Properties will appear here when added to clients' : 'Try adjusting your search criteria'
              )
            ) :
            React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6' },
              filteredProperties.map((property, index) =>
                React.createElement('div', { 
                  key: `${property.clientId}-${property.id || index}`, 
                  className: 'bg-gray-800 rounded-lg p-6 border border-gray-700 hover:border-blue-500 transition-colors',
                  onClick: (e) => {
                    // Only open detail modal if clicking on card content, not buttons
                    if (!e.target.closest('.property-action-buttons')) {
                      setShowPropertyDetail(property);
                    }
                  }
                },
                  React.createElement('div', { className: 'flex justify-between items-start mb-3' },
                    React.createElement('div', { className: 'flex-1' },
                      React.createElement('h3', { className: 'text-xl font-semibold mb-2 text-white' }, property.address || 'Address not provided'),
                      React.createElement('p', { className: 'text-green-400 font-bold text-2xl' }, 
                        `$${(property.price || 0).toLocaleString()}`
                      )
                    ),
                    React.createElement('div', { className: 'flex flex-col items-end space-y-2' },
                      React.createElement('span', { 
                        className: `px-2 py-1 rounded text-xs ${
                          property.status === 'active' ? 'bg-green-600 text-green-100' :
                          property.status === 'pending' ? 'bg-yellow-600 text-yellow-100' :
                          property.status === 'sold' ? 'bg-red-600 text-red-100' : 'bg-gray-600'
                        }`
                      }, (property.status || 'active').toUpperCase()),
                      React.createElement('div', { className: 'property-action-buttons flex space-x-1' },
                        React.createElement('button', {
                          onClick: (e) => {
                            e.stopPropagation();
                            handleEditProperty(property);
                          },
                          className: 'p-1.5 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors text-xs',
                          title: 'Edit Property'
                        }, '✏️'),
                        React.createElement('button', {
                          onClick: (e) => {
                            e.stopPropagation();
                            handleDeleteProperty(property);
                          },
                          className: 'p-1.5 bg-red-600 text-white rounded hover:bg-red-700 transition-colors text-xs',
                          title: 'Delete Property'
                        }, '🗑️')
                      )
                    )
                  ),
                  React.createElement('div', { className: 'grid grid-cols-3 gap-4 mb-3 text-sm text-gray-300' },
                    React.createElement('div', null, `🛏️ ${property.bedrooms || 0} bed`),
                    React.createElement('div', null, `🚿 ${property.bathrooms || 0} bath`),
                    React.createElement('div', null, `📐 ${(property.sqft || 0).toLocaleString()} sqft`)
                  ),
                  React.createElement('div', { className: 'border-t border-gray-600 pt-3' },
                    React.createElement('p', { className: 'text-sm text-blue-400 mb-1' }, `Client: ${property.clientName}`),
                    React.createElement('p', { className: 'text-xs text-gray-500' }, 
                      `${property.propertyType ? property.propertyType.charAt(0).toUpperCase() + property.propertyType.slice(1) : 'House'} • ${property.yearBuilt ? property.yearBuilt : 'Year unknown'}`
                    ),
                    property.description && React.createElement('p', { className: 'text-sm text-gray-400 mt-2 line-clamp-2' }, 
                      property.description
                    )
                  )
                )
              )
            ),
            
          // Property Detail Modal
          showPropertyDetail && React.createElement('div', { 
            className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50',
            onClick: () => setShowPropertyDetail(null)
          },
            React.createElement('div', { 
              className: 'bg-gray-800 rounded-lg p-6 max-w-3xl w-full mx-4 max-h-96 overflow-y-auto',
              onClick: (e) => e.stopPropagation()
            },
              React.createElement('div', { className: 'flex justify-between items-center mb-4' },
                React.createElement('h3', { className: 'text-2xl font-bold' }, showPropertyDetail.address),
                React.createElement('button', {
                  onClick: () => setShowPropertyDetail(null),
                  className: 'text-gray-400 hover:text-white text-2xl'
                }, '×')
              ),
              React.createElement('div', { className: 'grid grid-cols-1 lg:grid-cols-2 gap-6' },
                React.createElement('div', { className: 'space-y-4' },
                  React.createElement('div', null,
                    React.createElement('p', { className: 'text-3xl font-bold text-green-400 mb-2' }, 
                      `$${showPropertyDetail.price.toLocaleString()}`
                    ),
                    React.createElement('span', { 
                      className: `px-3 py-1 rounded ${
                        showPropertyDetail.status === 'active' ? 'bg-green-600 text-green-100' :
                        showPropertyDetail.status === 'pending' ? 'bg-yellow-600 text-yellow-100' :
                        'bg-red-600 text-red-100'
                      }`
                    }, (showPropertyDetail.status || 'active').toUpperCase())
                  ),
                  React.createElement('div', { className: 'grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4' },
                    React.createElement('div', null,
                      React.createElement('p', { className: 'text-sm text-gray-400' }, 'Bedrooms'),
                      React.createElement('p', { className: 'font-semibold text-lg' }, `🛏️ ${showPropertyDetail.bedrooms}`)
                    ),
                    React.createElement('div', null,
                      React.createElement('p', { className: 'text-sm text-gray-400' }, 'Bathrooms'),
                      React.createElement('p', { className: 'font-semibold text-lg' }, `🚿 ${showPropertyDetail.bathrooms}`)
                    )
                  ),
                  showPropertyDetail.description && React.createElement('div', null,
                    React.createElement('p', { className: 'text-sm text-gray-400' }, 'Description'),
                    React.createElement('p', { className: 'text-gray-300' }, showPropertyDetail.description)
                  )
                ),
                React.createElement('div', { className: 'space-y-4' },
                  React.createElement('div', { className: 'bg-gray-700 p-4 rounded' },
                    React.createElement('h4', { className: 'font-semibold mb-2 text-blue-300' }, 'Client Information'),
                    React.createElement('p', { className: 'font-semibold' }, showPropertyDetail.clientName),
                    React.createElement('p', { className: 'text-sm text-gray-400' }, showPropertyDetail.clientEmail),
                    React.createElement('p', { className: 'text-sm text-gray-400' }, showPropertyDetail.clientPhone)
                  ),
                  React.createElement('div', { className: 'grid grid-cols-2 gap-4 text-sm' },
                    React.createElement('div', null,
                      React.createElement('p', { className: 'text-gray-400' }, 'Square Feet'),
                      React.createElement('p', { className: 'font-semibold' }, showPropertyDetail.sqft?.toLocaleString())
                    ),
                    React.createElement('div', null,
                      React.createElement('p', { className: 'text-gray-400' }, 'Year Built'),
                      React.createElement('p', { className: 'font-semibold' }, showPropertyDetail.yearBuilt || 'Unknown')
                    )
                  )
                )
              )
            )
          ),
          
          // NEW: Add Property Modal
          showAddPropertyModal && React.createElement('div', {
            className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4',
            onClick: () => setShowAddPropertyModal(false)
          },
            React.createElement('div', {
              className: 'bg-gray-800 rounded-lg p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto',
              onClick: (e) => e.stopPropagation()
            },
              React.createElement('div', { className: 'flex justify-between items-center mb-6' },
                React.createElement('h3', { className: 'text-2xl font-bold text-white' }, '🏠 Add New Property'),
                React.createElement('button', {
                  onClick: () => setShowAddPropertyModal(false),
                  className: 'text-gray-400 hover:text-white text-2xl'
                }, '×')
              ),
              
              // API Data Display (if available)
              apiPropertyData && React.createElement('div', { 
                className: 'bg-purple-900 bg-opacity-30 p-4 rounded border border-purple-600 mb-6'
              },
                React.createElement('h4', { className: 'text-purple-200 font-semibold mb-2' }, 
                  '🌐 API Property Data Loaded'
                ),
                React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-3 gap-4 text-sm' },
                  React.createElement('div', null,
                    React.createElement('p', { className: 'text-gray-400' }, 'Estimated Value'),
                    React.createElement('p', { className: 'text-green-300 font-semibold' }, 
                      `$${(apiPropertyData.price || 0).toLocaleString()}`
                    )
                  ),
                  React.createElement('div', null,
                    React.createElement('p', { className: 'text-gray-400' }, 'Property Type'),
                    React.createElement('p', { className: 'text-white' }, apiPropertyData.propertyType || 'Unknown')
                  ),
                  React.createElement('div', null,
                    React.createElement('p', { className: 'text-gray-400' }, 'Year Built'),
                    React.createElement('p', { className: 'text-white' }, apiPropertyData.yearBuilt || 'Unknown')
                  )
                ),
                React.createElement('p', { className: 'text-purple-200 text-xs mt-2' }, 
                  'Data has been auto-populated in the form below. Review and save.'
                )
              ),
              
              React.createElement('form', { 
                className: 'space-y-4',
                onSubmit: (e) => { e.preventDefault(); handleSaveProperty(); }
              },
                // Client Selection
                React.createElement('div', { className: 'bg-yellow-900 bg-opacity-30 p-4 rounded border border-yellow-600' },
                  React.createElement('label', { className: 'block text-sm font-medium text-yellow-200 mb-2' }, 
                    '👤 Associate with Client *'
                  ),
                  React.createElement('select', {
                    value: propertyFormData.clientId,
                    onChange: (e) => setPropertyFormData(prev => ({ ...prev, clientId: e.target.value })),
                    className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white focus:border-yellow-500',
                    required: true
                  },
                    React.createElement('option', { value: '' }, 'Select a client...'),
                    clients.map(client =>
                      React.createElement('option', { key: client.id, value: client.id }, 
                        `${client.firstName || client.first_name} ${client.lastName || client.last_name} (${client.email})`
                      )
                    )
                  )
                ),

                // Address with API Fetch Button
                React.createElement('div', null,
                  React.createElement('div', { className: 'flex justify-between items-center mb-2' },
                    React.createElement('label', { className: 'text-sm font-medium text-gray-300' }, 
                      '🏠 Property Address *'
                    ),
                    React.createElement('button', {
                      type: 'button',
                      onClick: () => fetchPropertyFromAPI(propertyFormData.address),
                      disabled: isLoadingPropertyData || !propertyFormData.address.trim(),
                      className: `px-2 py-1 rounded text-xs transition-colors ${
                        isLoadingPropertyData || !propertyFormData.address.trim()
                          ? 'bg-gray-600 text-gray-400 cursor-not-allowed' 
                          : 'bg-purple-600 text-white hover:bg-purple-700'
                      }`,
                      title: 'Fetch property data from API'
                    }, isLoadingPropertyData ? '🔄' : '🌐 Fetch API Data')
                  ),
                  React.createElement('input', {
                    type: 'text',
                    value: propertyFormData.address,
                    onChange: (e) => setPropertyFormData(prev => ({ ...prev, address: e.target.value })),
                    placeholder: 'Enter full property address...',
                    className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white placeholder-gray-400 focus:border-blue-500',
                    required: true
                  })
                ),

                // Basic Property Information
                React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-4' },
                  React.createElement('div', null,
                    React.createElement('label', { className: 'block text-sm font-medium text-gray-300 mb-2' }, 
                      '💰 Price'
                    ),
                    React.createElement('input', {
                      type: 'number',
                      value: propertyFormData.price,
                      onChange: (e) => setPropertyFormData(prev => ({ ...prev, price: e.target.value })),
                      placeholder: '0',
                      className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white placeholder-gray-400 focus:border-blue-500'
                    })
                  ),
                  React.createElement('div', null,
                    React.createElement('label', { className: 'block text-sm font-medium text-gray-300 mb-2' }, 
                      '🏢 Property Type'
                    ),
                    React.createElement('select', {
                      value: propertyFormData.propertyType,
                      onChange: (e) => setPropertyFormData(prev => ({ ...prev, propertyType: e.target.value })),
                      className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white focus:border-blue-500'
                    },
                      React.createElement('option', { value: 'house' }, 'House'),
                      React.createElement('option', { value: 'condo' }, 'Condo'),
                      React.createElement('option', { value: 'townhouse' }, 'Townhouse'),
                      React.createElement('option', { value: 'apartment' }, 'Apartment'),
                      React.createElement('option', { value: 'duplex' }, 'Duplex'),
                      React.createElement('option', { value: 'commercial' }, 'Commercial'),
                      React.createElement('option', { value: 'land' }, 'Land')
                    )
                  )
                ),

                // Property Details
                React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-4 gap-4' },
                  React.createElement('div', null,
                    React.createElement('label', { className: 'block text-sm font-medium text-gray-300 mb-2' }, 
                      '🛏️ Bedrooms'
                    ),
                    React.createElement('input', {
                      type: 'number',
                      value: propertyFormData.bedrooms,
                      onChange: (e) => setPropertyFormData(prev => ({ ...prev, bedrooms: e.target.value })),
                      placeholder: '0',
                      className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white placeholder-gray-400 focus:border-blue-500'
                    })
                  ),
                  React.createElement('div', null,
                    React.createElement('label', { className: 'block text-sm font-medium text-gray-300 mb-2' }, 
                      '🚿 Bathrooms'
                    ),
                    React.createElement('input', {
                      type: 'number',
                      step: '0.5',
                      value: propertyFormData.bathrooms,
                      onChange: (e) => setPropertyFormData(prev => ({ ...prev, bathrooms: e.target.value })),
                      placeholder: '0',
                      className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white placeholder-gray-400 focus:border-blue-500'
                    })
                  ),
                  React.createElement('div', null,
                    React.createElement('label', { className: 'block text-sm font-medium text-gray-300 mb-2' }, 
                      '📐 Square Feet'
                    ),
                    React.createElement('input', {
                      type: 'number',
                      value: propertyFormData.sqft,
                      onChange: (e) => setPropertyFormData(prev => ({ ...prev, sqft: e.target.value })),
                      placeholder: '0',
                      className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white placeholder-gray-400 focus:border-blue-500'
                    })
                  ),
                  React.createElement('div', null,
                    React.createElement('label', { className: 'block text-sm font-medium text-gray-300 mb-2' }, 
                      '📅 Year Built'
                    ),
                    React.createElement('input', {
                      type: 'number',
                      value: propertyFormData.yearBuilt,
                      onChange: (e) => setPropertyFormData(prev => ({ ...prev, yearBuilt: e.target.value })),
                      placeholder: '2020',
                      className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white placeholder-gray-400 focus:border-blue-500'
                    })
                  )
                ),

                // Status
                React.createElement('div', null,
                  React.createElement('label', { className: 'block text-sm font-medium text-gray-300 mb-2' }, 
                    '📊 Status'
                  ),
                  React.createElement('select', {
                    value: propertyFormData.status,
                    onChange: (e) => setPropertyFormData(prev => ({ ...prev, status: e.target.value })),
                    className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white focus:border-blue-500'
                  },
                    React.createElement('option', { value: 'active' }, 'Active'),
                    React.createElement('option', { value: 'pending' }, 'Pending'),
                    React.createElement('option', { value: 'sold' }, 'Sold'),
                    React.createElement('option', { value: 'withdrawn' }, 'Withdrawn'),
                    React.createElement('option', { value: 'contingent' }, 'Contingent')
                  )
                ),

                // Description and Features
                React.createElement('div', null,
                  React.createElement('label', { className: 'block text-sm font-medium text-gray-300 mb-2' }, 
                    '📝 Description'
                  ),
                  React.createElement('textarea', {
                    value: propertyFormData.description,
                    onChange: (e) => setPropertyFormData(prev => ({ ...prev, description: e.target.value })),
                    placeholder: 'Describe the property features, location highlights, etc...',
                    rows: 3,
                    className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white placeholder-gray-400 focus:border-blue-500'
                  })
                ),

                React.createElement('div', null,
                  React.createElement('label', { className: 'block text-sm font-medium text-gray-300 mb-2' }, 
                    '✨ Features (comma-separated)'
                  ),
                  React.createElement('input', {
                    type: 'text',
                    value: propertyFormData.features,
                    onChange: (e) => setPropertyFormData(prev => ({ ...prev, features: e.target.value })),
                    placeholder: 'Pool, Garage, Fireplace, Hardwood Floors, etc...',
                    className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white placeholder-gray-400 focus:border-blue-500'
                  })
                ),

                // Action Buttons
                React.createElement('div', { className: 'flex space-x-4 pt-6 border-t border-gray-700' },
                  React.createElement('button', {
                    type: 'submit',
                    className: 'flex-1 bg-green-600 text-white py-3 px-6 rounded-lg hover:bg-green-700 transition-colors font-semibold'
                  }, '✅ Add Property'),
                  React.createElement('button', {
                    type: 'button',
                    onClick: () => setShowAddPropertyModal(false),
                    className: 'flex-1 bg-gray-600 text-white py-3 px-6 rounded-lg hover:bg-gray-500 transition-colors'
                  }, '❌ Cancel')
                )
              )
            )
          ),
          
          // NEW: Edit Property Modal
          showEditPropertyModal && React.createElement('div', {
            className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4',
            onClick: () => setShowEditPropertyModal(false)
          },
            React.createElement('div', {
              className: 'bg-gray-800 rounded-lg p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto',
              onClick: (e) => e.stopPropagation()
            },
              React.createElement('div', { className: 'flex justify-between items-center mb-6' },
                React.createElement('h3', { className: 'text-2xl font-bold text-white' }, 
                  React.createElement('span', null, '✏️ Edit Property'),
                  React.createElement('div', { className: 'text-sm text-gray-400 mt-1' }, 
                    `Editing: ${editingProperty?.address || 'Property'}`
                  )
                ),
                React.createElement('div', { className: 'flex space-x-2' },
                  React.createElement('button', {
                    onClick: () => fetchPropertyFromAPI(propertyFormData.address),
                    disabled: isLoadingPropertyData,
                    className: `px-3 py-2 rounded text-sm transition-colors ${
                      isLoadingPropertyData 
                        ? 'bg-purple-800 text-purple-200 cursor-not-allowed' 
                        : 'bg-purple-600 text-white hover:bg-purple-700'
                    }`,
                    title: 'Fetch property data from RealtyMole API'
                  }, isLoadingPropertyData ? '🔄 Loading...' : '🌐 Fetch API Data'),
                  React.createElement('button', {
                    onClick: () => setShowEditPropertyModal(false),
                    className: 'text-gray-400 hover:text-white text-2xl'
                  }, '×')
                )
              ),
              
              // API Data Display (if available)
              apiPropertyData && React.createElement('div', { 
                className: 'bg-purple-900 bg-opacity-30 p-4 rounded border border-purple-600 mb-6'
              },
                React.createElement('h4', { className: 'text-purple-200 font-semibold mb-2' }, 
                  '🌐 API Property Data Loaded'
                ),
                React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-3 gap-4 text-sm' },
                  React.createElement('div', null,
                    React.createElement('p', { className: 'text-gray-400' }, 'Estimated Value'),
                    React.createElement('p', { className: 'text-green-300 font-semibold' }, 
                      `$${(apiPropertyData.price || 0).toLocaleString()}`
                    )
                  ),
                  React.createElement('div', null,
                    React.createElement('p', { className: 'text-gray-400' }, 'Property Type'),
                    React.createElement('p', { className: 'text-white' }, apiPropertyData.propertyType || 'Unknown')
                  ),
                  React.createElement('div', null,
                    React.createElement('p', { className: 'text-gray-400' }, 'Year Built'),
                    React.createElement('p', { className: 'text-white' }, apiPropertyData.yearBuilt || 'Unknown')
                  )
                ),
                React.createElement('p', { className: 'text-purple-200 text-xs mt-2' }, 
                  'Data has been auto-populated in the form below. Review and save changes.'
                )
              ),
              
              React.createElement('form', { 
                className: 'space-y-4',
                onSubmit: (e) => { e.preventDefault(); handleUpdateProperty(); }
              },
                // Client Information (Read-only for editing)
                React.createElement('div', { className: 'bg-blue-900 bg-opacity-30 p-4 rounded border border-blue-600' },
                  React.createElement('label', { className: 'block text-sm font-medium text-blue-200 mb-2' }, 
                    '👤 Associated Client (Read-only)'
                  ),
                  React.createElement('div', { className: 'p-3 bg-gray-700 rounded border border-gray-600 text-gray-300' },
                    clients.find(c => c.id === editingProperty?.clientId) ? 
                      `${clients.find(c => c.id === editingProperty?.clientId)?.firstName || clients.find(c => c.id === editingProperty?.clientId)?.first_name} ${clients.find(c => c.id === editingProperty?.clientId)?.lastName || clients.find(c => c.id === editingProperty?.clientId)?.last_name} (${clients.find(c => c.id === editingProperty?.clientId)?.email})` :
                      'Client not found'
                  )
                ),

                // Address with API Fetch Button
                React.createElement('div', null,
                  React.createElement('div', { className: 'flex justify-between items-center mb-2' },
                    React.createElement('label', { className: 'text-sm font-medium text-gray-300' }, 
                      '🏠 Property Address *'
                    ),
                    React.createElement('button', {
                      type: 'button',
                      onClick: () => fetchPropertyFromAPI(propertyFormData.address),
                      disabled: isLoadingPropertyData || !propertyFormData.address.trim(),
                      className: `px-2 py-1 rounded text-xs transition-colors ${
                        isLoadingPropertyData || !propertyFormData.address.trim()
                          ? 'bg-gray-600 text-gray-400 cursor-not-allowed' 
                          : 'bg-purple-600 text-white hover:bg-purple-700'
                      }`,
                      title: 'Update property data from API'
                    }, isLoadingPropertyData ? '🔄' : '🌐 Update from API')
                  ),
                  React.createElement('input', {
                    type: 'text',
                    value: propertyFormData.address,
                    onChange: (e) => setPropertyFormData(prev => ({ ...prev, address: e.target.value })),
                    placeholder: 'Enter full property address...',
                    className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white placeholder-gray-400 focus:border-blue-500',
                    required: true
                  })
                ),

                // Basic Property Information
                React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-4' },
                  React.createElement('div', null,
                    React.createElement('label', { className: 'block text-sm font-medium text-gray-300 mb-2' }, 
                      '💰 Price'
                    ),
                    React.createElement('input', {
                      type: 'number',
                      value: propertyFormData.price,
                      onChange: (e) => setPropertyFormData(prev => ({ ...prev, price: e.target.value })),
                      placeholder: '0',
                      className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white placeholder-gray-400 focus:border-blue-500'
                    })
                  ),
                  React.createElement('div', null,
                    React.createElement('label', { className: 'block text-sm font-medium text-gray-300 mb-2' }, 
                      '📊 Status'
                    ),
                    React.createElement('select', {
                      value: propertyFormData.status,
                      onChange: (e) => setPropertyFormData(prev => ({ ...prev, status: e.target.value })),
                      className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white focus:border-blue-500'
                    },
                      React.createElement('option', { value: 'active' }, 'Active'),
                      React.createElement('option', { value: 'pending' }, 'Pending'),
                      React.createElement('option', { value: 'sold' }, 'Sold'),
                      React.createElement('option', { value: 'withdrawn' }, 'Withdrawn'),
                      React.createElement('option', { value: 'contingent' }, 'Contingent')
                    )
                  )
                ),

                // Property Details
                React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-4 gap-4' },
                  React.createElement('div', null,
                    React.createElement('label', { className: 'block text-sm font-medium text-gray-300 mb-2' }, 
                      '🛏️ Bedrooms'
                    ),
                    React.createElement('input', {
                      type: 'number',
                      value: propertyFormData.bedrooms,
                      onChange: (e) => setPropertyFormData(prev => ({ ...prev, bedrooms: e.target.value })),
                      placeholder: '0',
                      className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white placeholder-gray-400 focus:border-blue-500'
                    })
                  ),
                  React.createElement('div', null,
                    React.createElement('label', { className: 'block text-sm font-medium text-gray-300 mb-2' }, 
                      '🚿 Bathrooms'
                    ),
                    React.createElement('input', {
                      type: 'number',
                      step: '0.5',
                      value: propertyFormData.bathrooms,
                      onChange: (e) => setPropertyFormData(prev => ({ ...prev, bathrooms: e.target.value })),
                      placeholder: '0',
                      className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white placeholder-gray-400 focus:border-blue-500'
                    })
                  ),
                  React.createElement('div', null,
                    React.createElement('label', { className: 'block text-sm font-medium text-gray-300 mb-2' }, 
                      '📐 Square Feet'
                    ),
                    React.createElement('input', {
                      type: 'number',
                      value: propertyFormData.sqft,
                      onChange: (e) => setPropertyFormData(prev => ({ ...prev, sqft: e.target.value })),
                      placeholder: '0',
                      className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white placeholder-gray-400 focus:border-blue-500'
                    })
                  ),
                  React.createElement('div', null,
                    React.createElement('label', { className: 'block text-sm font-medium text-gray-300 mb-2' }, 
                      '📅 Year Built'
                    ),
                    React.createElement('input', {
                      type: 'number',
                      value: propertyFormData.yearBuilt,
                      onChange: (e) => setPropertyFormData(prev => ({ ...prev, yearBuilt: e.target.value })),
                      placeholder: '2020',
                      className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white placeholder-gray-400 focus:border-blue-500'
                    })
                  )
                ),

                // Property Type
                React.createElement('div', null,
                  React.createElement('label', { className: 'block text-sm font-medium text-gray-300 mb-2' }, 
                    '🏢 Property Type'
                  ),
                  React.createElement('select', {
                    value: propertyFormData.propertyType,
                    onChange: (e) => setPropertyFormData(prev => ({ ...prev, propertyType: e.target.value })),
                    className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white focus:border-blue-500'
                  },
                    React.createElement('option', { value: 'house' }, 'House'),
                    React.createElement('option', { value: 'condo' }, 'Condo'),
                    React.createElement('option', { value: 'townhouse' }, 'Townhouse'),
                    React.createElement('option', { value: 'apartment' }, 'Apartment'),
                    React.createElement('option', { value: 'duplex' }, 'Duplex'),
                    React.createElement('option', { value: 'commercial' }, 'Commercial'),
                    React.createElement('option', { value: 'land' }, 'Land')
                  )
                ),

                // Description and Features
                React.createElement('div', null,
                  React.createElement('label', { className: 'block text-sm font-medium text-gray-300 mb-2' }, 
                    '📝 Description'
                  ),
                  React.createElement('textarea', {
                    value: propertyFormData.description,
                    onChange: (e) => setPropertyFormData(prev => ({ ...prev, description: e.target.value })),
                    placeholder: 'Describe the property features, location highlights, etc...',
                    rows: 3,
                    className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white placeholder-gray-400 focus:border-blue-500'
                  })
                ),

                React.createElement('div', null,
                  React.createElement('label', { className: 'block text-sm font-medium text-gray-300 mb-2' }, 
                    '✨ Features (comma-separated)'
                  ),
                  React.createElement('input', {
                    type: 'text',
                    value: propertyFormData.features,
                    onChange: (e) => setPropertyFormData(prev => ({ ...prev, features: e.target.value })),
                    placeholder: 'Pool, Garage, Fireplace, Hardwood Floors, etc...',
                    className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white placeholder-gray-400 focus:border-blue-500'
                  })
                ),

                // Action Buttons
                React.createElement('div', { className: 'flex space-x-4 pt-6 border-t border-gray-700' },
                  React.createElement('button', {
                    type: 'submit',
                    className: 'flex-1 bg-blue-600 text-white py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors font-semibold'
                  }, '✅ Update Property'),
                  React.createElement('button', {
                    type: 'button',
                    onClick: () => setShowEditPropertyModal(false),
                    className: 'flex-1 bg-gray-600 text-white py-3 px-6 rounded-lg hover:bg-gray-500 transition-colors'
                  }, '❌ Cancel')
                )
              )
            )
          )
        );
      }

      // Tasks View Component
      function TasksView({ clients, setClients, generalTasks, setGeneralTasks, setTaskFormData, setShowVoiceTaskModal, startVoiceTaskCreation, isListeningForTask, setVoiceStatus }) {
        const [sortBy, setSortBy] = useState('created');
        const [filterBy, setFilterBy] = useState('all');
        const [showAddTask, setShowAddTask] = useState(false);
        
        // Handle task completion (for both client and general tasks)
        const handleCompleteTask = (taskId, clientId, isGeneralTask) => {
          if (isGeneralTask) {
            setGeneralTasks(prevTasks => 
              prevTasks.map(task => 
                task.id === taskId 
                  ? { ...task, completed: !task.completed, completedAt: new Date().toISOString() }
                  : task
              )
            );
          } else {
            setClients(prevClients => 
              prevClients.map(client => 
                client.id === clientId 
                  ? {
                      ...client,
                      todos: (client.todos || []).map(task => 
                        task.id === taskId 
                          ? { ...task, completed: !task.completed, completedAt: new Date().toISOString() }
                          : task
                      )
                    }
                  : client
              )
            );
          }
          setVoiceStatus(`✅ Task ${taskId ? 'completed' : 'reopened'} successfully!`);
          setTimeout(() => setVoiceStatus(''), 3000);
        };
        
        // Handle task deletion (for both client and general tasks)
        const handleDeleteTask = (taskId, clientId, isGeneralTask) => {
          if (confirm('Are you sure you want to delete this task?')) {
            if (isGeneralTask) {
              setGeneralTasks(prevTasks => prevTasks.filter(task => task.id !== taskId));
            } else {
              setClients(prevClients => 
                prevClients.map(client => 
                  client.id === clientId 
                    ? {
                        ...client,
                        todos: (client.todos || []).filter(task => task.id !== taskId)
                      }
                    : client
                )
              );
            }
            setVoiceStatus('🗑️ Task deleted successfully!');
            setTimeout(() => setVoiceStatus(''), 3000);
          }
        };
        
        // Handle manual task creation
        const handleAddTask = () => {
          setTaskFormData({
            title: '',
            description: '',
            type: 'general',
            priority: 'medium',
            dueDate: '',
            time: '',
            clientId: '',
            clientName: '',
            status: 'pending'
          });
          setShowVoiceTaskModal(true);
        };
        
        // Combine tasks from clients and general tasks (assign general tasks to Rodrigo)
        const clientTasks = clients.flatMap(client => 
          (client.todos || []).map(task => ({
            ...task,
            clientName: `${client.firstName || client.first_name || 'Unknown'} ${client.lastName || client.last_name || 'Client'}`,
            clientId: client.id,
            isGeneralTask: false
          }))
        );
        
        const rodrigoTasks = (generalTasks || []).map(task => ({
          ...task,
          clientName: 'Rodrigo Admin (Owner)',
          clientId: 'rodrigo-admin',
          isGeneralTask: true
        }));
        
        const allTasks = [...clientTasks, ...rodrigoTasks];

        // Filter tasks
        const filteredTasks = allTasks.filter(task => {
          if (filterBy === 'all') return true;
          if (filterBy === 'pending') return !task.completed;
          if (filterBy === 'completed') return task.completed;
          if (filterBy === 'overdue') {
            if (!task.dueDate) return false;
            return new Date(task.dueDate) < new Date() && !task.completed;
          }
          if (filterBy === 'due-today') {
            if (!task.dueDate) return false;
            const today = new Date().toDateString();
            return new Date(task.dueDate).toDateString() === today;
          }
          return true;
        });

        // Sort tasks
        const sortedTasks = [...filteredTasks].sort((a, b) => {
          switch (sortBy) {
            case 'dueDate':
              if (!a.dueDate && !b.dueDate) return 0;
              if (!a.dueDate) return 1;
              if (!b.dueDate) return -1;
              return new Date(a.dueDate) - new Date(b.dueDate);
            case 'priority':
              const priorityOrder = { high: 3, medium: 2, low: 1 };
              return (priorityOrder[b.priority] || 1) - (priorityOrder[a.priority] || 1);
            case 'client':
              return a.clientName.localeCompare(b.clientName);
            case 'created':
              return new Date(b.createdAt || 0) - new Date(a.createdAt || 0);
            default:
              return 0;
          }
        });

        return React.createElement('div', null,
          React.createElement('div', { className: 'flex justify-between items-center mb-6' },
            React.createElement('h2', { className: 'text-3xl font-bold' }, 'Tasks'),
            React.createElement('div', { className: 'flex space-x-4' },
              // Add Manual Task Button
              React.createElement('button', {
                onClick: handleAddTask,
                className: 'bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition-colors flex items-center space-x-2'
              },
                React.createElement('span', null, '➕'),
                React.createElement('span', null, 'Add Task')
              ),
              // Add Voice Task Button  
              React.createElement('button', {
                onClick: startVoiceTaskCreation,
                disabled: isListeningForTask,
                className: `px-4 py-2 rounded transition-colors flex items-center space-x-2 ${
                  isListeningForTask 
                    ? 'bg-red-600 text-white cursor-not-allowed' 
                    : 'bg-purple-600 text-white hover:bg-purple-700'
                }`
              },
                React.createElement('span', null, isListeningForTask ? '🎙️' : '🎤'),
                React.createElement('span', null, isListeningForTask ? 'Listening...' : 'Voice Task')
              ),
              // Filter Dropdown
              React.createElement('select', {
                value: filterBy,
                onChange: (e) => setFilterBy(e.target.value),
                className: 'bg-gray-700 text-white px-3 py-2 rounded border border-gray-600'
              },
                React.createElement('option', { value: 'all' }, 'All Tasks'),
                React.createElement('option', { value: 'pending' }, 'Pending'),
                React.createElement('option', { value: 'completed' }, 'Completed'),
                React.createElement('option', { value: 'overdue' }, 'Overdue'),
                React.createElement('option', { value: 'due-today' }, 'Due Today')
              ),
              // Sort Dropdown
              React.createElement('select', {
                value: sortBy,
                onChange: (e) => setSortBy(e.target.value),
                className: 'bg-gray-700 text-white px-3 py-2 rounded border border-gray-600'
              },
                React.createElement('option', { value: 'dueDate' }, 'Sort by Due Date'),
                React.createElement('option', { value: 'priority' }, 'Sort by Priority'),
                React.createElement('option', { value: 'client' }, 'Sort by Client'),
                React.createElement('option', { value: 'created' }, 'Sort by Created Date')
              )
            )
          ),
          
          // Task Statistics
          React.createElement('div', { className: 'grid grid-cols-2 md:grid-cols-4 gap-4 mb-6' },
            React.createElement('div', { className: 'bg-gray-800 p-4 rounded-lg text-center' },
              React.createElement('div', { className: 'text-2xl font-bold text-blue-400' }, allTasks.length),
              React.createElement('div', { className: 'text-sm text-gray-400' }, 'Total Tasks')
            ),
            React.createElement('div', { className: 'bg-gray-800 p-4 rounded-lg text-center' },
              React.createElement('div', { className: 'text-2xl font-bold text-yellow-400' }, 
                allTasks.filter(t => !t.completed).length
              ),
              React.createElement('div', { className: 'text-sm text-gray-400' }, 'Pending')
            ),
            React.createElement('div', { className: 'bg-gray-800 p-4 rounded-lg text-center' },
              React.createElement('div', { className: 'text-2xl font-bold text-red-400' }, 
                allTasks.filter(t => t.dueDate && new Date(t.dueDate) < new Date() && !t.completed).length
              ),
              React.createElement('div', { className: 'text-sm text-gray-400' }, 'Overdue')
            ),
            React.createElement('div', { className: 'bg-gray-800 p-4 rounded-lg text-center' },
              React.createElement('div', { className: 'text-2xl font-bold text-green-400' }, 
                allTasks.filter(t => t.completed).length
              ),
              React.createElement('div', { className: 'text-sm text-gray-400' }, 'Completed')
            )
          ),
          
          sortedTasks.length === 0 ? 
            React.createElement('div', { className: 'text-center py-12 text-gray-400' },
              React.createElement('p', { className: 'text-xl mb-2' }, 
                filterBy === 'all' ? 'No tasks found' : `No ${filterBy} tasks found`
              ),
              React.createElement('p', null, 'Tasks will appear here when you add them')
            ) :
            // Table Layout
            React.createElement('div', { className: 'bg-gray-800 rounded-lg overflow-hidden' },
              // Table Header
              React.createElement('div', { className: 'bg-gray-700 px-6 py-4 border-b border-gray-600' },
                React.createElement('div', { className: 'grid grid-cols-12 gap-4 font-semibold text-gray-200 text-sm' },
                  React.createElement('div', { className: 'col-span-1 text-center' }, 'Status'),
                  React.createElement('div', { className: 'col-span-4' }, 'Task'),
                  React.createElement('div', { className: 'col-span-2' }, 'Client'),
                  React.createElement('div', { className: 'col-span-2' }, 'Type & Priority'),
                  React.createElement('div', { className: 'col-span-2' }, 'Due Date'),
                  React.createElement('div', { className: 'col-span-1 text-center' }, 'Actions')
                )
              ),
              // Table Body
              React.createElement('div', { className: 'divide-y divide-gray-700' },
                sortedTasks.map((task, index) =>
                  React.createElement('div', { 
                    key: `${task.id || index}`, 
                    className: `px-6 py-4 hover:bg-gray-700 transition-colors ${
                      task.completed ? 'opacity-75 bg-gray-750' : ''
                    }`
                  },
                    React.createElement('div', { className: 'grid grid-cols-12 gap-4 items-center' },
                      // Status Column (Checkbox)
                      React.createElement('div', { className: 'col-span-1 flex justify-center' },
                        React.createElement('div', {
                          onClick: () => handleCompleteTask(task.id, task.clientId, task.isGeneralTask),
                          className: `w-6 h-6 border-2 rounded cursor-pointer flex items-center justify-center transition-colors ${
                            task.completed 
                              ? 'bg-green-600 border-green-600 text-white' 
                              : 'border-gray-400 hover:border-gray-300'
                          }`
                        },
                          task.completed ? React.createElement('span', { 
                            className: 'text-xs font-bold text-white' 
                          }, '✓') : null
                        )
                      ),
                      
                      // Task Column
                      React.createElement('div', { className: 'col-span-4' },
                        React.createElement('h3', { 
                          className: `font-semibold text-sm mb-1 ${task.completed ? 'line-through text-gray-400' : 'text-white'}` 
                        }, task.title || task.text),
                        (task.description || task.notes) && React.createElement('p', { 
                          className: `text-xs text-gray-300 leading-relaxed ${task.completed ? 'opacity-75' : ''}` 
                        }, task.description && task.description.startsWith('Voice-created task: ') 
                            ? '🎤 ' + task.description.replace('Voice-created task: ', '') 
                            : task.description || task.notes),
                        task.createdAt && React.createElement('p', { 
                          className: 'text-xs text-gray-500 mt-1' 
                        }, `Created: ${new Date(task.createdAt).toLocaleDateString()}`)
                      ),
                      
                      // Client Column
                      React.createElement('div', { className: 'col-span-2' },
                        React.createElement('p', { className: 'text-sm font-medium text-gray-200' }, task.clientName),
                        task.isGeneralTask && React.createElement('span', { 
                          className: 'text-xs bg-blue-600 px-2 py-1 rounded mt-1 inline-block' 
                        }, 'General Task')
                      ),
                      
                      // Type & Priority Column
                      React.createElement('div', { className: 'col-span-2 space-y-1' },
                        task.type && React.createElement('span', {
                          className: `px-2 py-1 rounded text-xs inline-block ${
                            task.type === 'showing' ? 'bg-blue-600' :
                            task.type === 'follow_up' ? 'bg-green-600' :
                            task.type === 'listing' ? 'bg-purple-600' :
                            task.type === 'documentation' ? 'bg-yellow-600' :
                            task.type === 'appointment' ? 'bg-indigo-600' :
                            task.type === 'marketing' ? 'bg-pink-600' : 'bg-gray-600'
                          }`
                        }, 
                          task.type === 'showing' ? '🏠 Showing' :
                          task.type === 'follow_up' ? '📞 Follow-up' :
                          task.type === 'listing' ? '📝 Listing' :
                          task.type === 'documentation' ? '📋 Documents' :
                          task.type === 'appointment' ? '📅 Appointment' :
                          task.type === 'marketing' ? '📸 Marketing' : '⚡ General'
                        ),
                        React.createElement('span', { 
                          className: `px-2 py-1 rounded text-xs inline-block ${
                            task.priority === 'high' ? 'bg-red-600' :
                            task.priority === 'medium' ? 'bg-yellow-600' : 'bg-green-600'
                          }`
                        }, (task.priority || 'low').toUpperCase())
                      ),
                      
                      // Due Date Column
                      React.createElement('div', { className: 'col-span-2' },
                        task.dueDate ? React.createElement('span', { 
                          className: `text-sm px-2 py-1 rounded ${
                            new Date(task.dueDate) < new Date() && !task.completed 
                              ? 'bg-red-900 text-red-200' 
                              : 'text-gray-300'
                          }`
                        }, new Date(task.dueDate).toLocaleDateString()) :
                        React.createElement('span', { className: 'text-gray-500 text-sm' }, 'No due date')
                      ),
                      
                      // Actions Column
                      React.createElement('div', { className: 'col-span-1 flex justify-center space-x-1' },
                        React.createElement('button', {
                          onClick: () => {
                            setTaskFormData({
                              id: task.id,
                              title: task.title || task.text,
                              description: task.description || task.notes || '',
                              type: task.type || 'general',
                              priority: task.priority || 'medium',
                              dueDate: task.dueDate || '',
                              time: task.time || '',
                              clientId: task.clientId,
                              clientName: task.clientName,
                              status: task.completed ? 'completed' : 'pending',
                              isEditing: true,
                              isGeneralTask: task.isGeneralTask
                            });
                            setShowVoiceTaskModal(true);
                          },
                          className: 'p-1 rounded text-xs bg-blue-600 hover:bg-blue-700 text-blue-100 transition-colors'
                        }, '✏️'),
                        React.createElement('button', {
                          onClick: () => handleDeleteTask(task.id, task.clientId, task.isGeneralTask),
                          className: 'p-1 rounded text-xs bg-red-600 hover:bg-red-700 text-red-100 transition-colors'
                        }, '🗑️')
                      )
                    )
                  )
                )
              )
            )
        );
      }

      // Analytics View Component
      function AnalyticsView({ clients }) {
        const analytics = {
          totalClients: clients.length,
          averageCommission: clients.length > 0 ? 
            clients.reduce((sum, c) => sum + (c.lifetimeNetCommission || 0), 0) / clients.length : 0,
          clientsByTag: clients.reduce((acc, client) => {
            (client.tags || []).forEach(tag => {
              acc[tag] = (acc[tag] || 0) + 1;
            });
            return acc;
          }, {}),
          clientsByCity: clients.reduce((acc, client) => {
            const city = client.city || 'Unknown';
            acc[city] = (acc[city] || 0) + 1;
            return acc;
          }, {})
        };

        return React.createElement('div', null,
          React.createElement('h2', { className: 'text-3xl font-bold mb-6' }, 'Analytics'),
          
          React.createElement('div', { className: 'grid grid-cols-1 lg:grid-cols-2 gap-8' },
            React.createElement('div', { className: 'bg-gray-800 p-6 rounded-lg' },
              React.createElement('h3', { className: 'text-xl font-semibold mb-4' }, 'Clients by Tag'),
              React.createElement('div', { className: 'space-y-3' },
                Object.entries(analytics.clientsByTag).map(([tag, count]) =>
                  React.createElement('div', { key: tag, className: 'flex justify-between items-center' },
                    React.createElement('span', null, tag),
                    React.createElement('span', { className: 'bg-blue-600 text-white px-2 py-1 rounded text-sm' }, count)
                  )
                )
              )
            ),

            React.createElement('div', { className: 'bg-gray-800 p-6 rounded-lg' },
              React.createElement('h3', { className: 'text-xl font-semibold mb-4' }, 'Clients by City'),
              React.createElement('div', { className: 'space-y-3' },
                Object.entries(analytics.clientsByCity).map(([city, count]) =>
                  React.createElement('div', { key: city, className: 'flex justify-between items-center' },
                    React.createElement('span', null, city),
                    React.createElement('span', { className: 'bg-green-600 text-white px-2 py-1 rounded text-sm' }, count)
                  )
                )
              )
            )
          ),

          React.createElement('div', { className: 'mt-8 bg-gray-800 p-6 rounded-lg' },
            React.createElement('h3', { className: 'text-xl font-semibold mb-4' }, 'Summary Statistics'),
            React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-3 gap-6' },
              React.createElement('div', { className: 'text-center' },
                React.createElement('p', { className: 'text-2xl font-bold text-blue-400' }, analytics.totalClients),
                React.createElement('p', { className: 'text-gray-400' }, 'Total Clients')
              ),
              React.createElement('div', { className: 'text-center' },
                React.createElement('p', { className: 'text-2xl font-bold text-green-400' }, 
                  `$${Math.round(analytics.averageCommission).toLocaleString()}`
                ),
                React.createElement('p', { className: 'text-gray-400' }, 'Average Commission')
              ),
              React.createElement('div', { className: 'text-center' },
                React.createElement('p', { className: 'text-2xl font-bold text-purple-400' }, 
                  Object.keys(analytics.clientsByTag).length
                ),
                React.createElement('p', { className: 'text-gray-400' }, 'Unique Tags')
              )
            )
          )
        );
      }

      // 360° Client Detail Modal Component
      function ClientDetailModal({ 
        client, 
        onClose, 
        handleAddProperty, 
        handleEditProperty, 
        handleSaveProperty, 
        handleDeleteProperty,
        showPropertyDetail,
        setShowPropertyDetail,
        showEditProperty,
        setShowEditProperty,
        propertyFormData,
        setPropertyFormData,
        showAddProperty,
        setShowAddProperty,
        setVoiceStatus,
        // Call logging props
        clients,
        setClients,
        setSelectedClient,
        // Voice task props
        startVoiceTaskCreation,
        isListeningForTask,
        showVoiceTaskModal,
        setShowVoiceTaskModal,
        taskFormData,
        setTaskFormData,
        saveTask
      }) {
        const [activeTab, setActiveTab] = useState('overview');
        const [isEditing, setIsEditing] = useState(false);
        const [editData, setEditData] = useState({});
        const [showAddTask, setShowAddTask] = useState(false);
        const [loading, setLoading] = useState(false);
        
        // Initialize edit data when editing starts
        React.useEffect(() => {
          if (isEditing) {
            setEditData({
              firstName: client.firstName || client.first_name || '',
              lastName: client.lastName || client.last_name || '',
              email: client.email || '',
              phone: client.phone || '',
              address: client.address || '',
              birthday: client.birthday || '',
              anniversary: client.anniversary || '',
              spouse: client.spouse || '',
              children: client.children || '',
              notes: client.notes || '',
              tags: (client.tags || []).join(', ')
            });
          }
        }, [isEditing, client]);

        const tabs = [
          { id: 'overview', label: 'Complete Overview', icon: '👤' },
          { id: 'properties', label: 'Properties', icon: '🏠' },
          { id: 'tasks', label: 'Tasks', icon: '✓' },
          { id: 'activity', label: 'Activity', icon: '📈' }
        ];

        const handleSaveEdit = async () => {
          setLoading(true);
          try {
            // Here you would call your API to update the client
            console.log('Saving client updates:', editData);
            // await API.clients.update(client.id, editData);
            setIsEditing(false);
            // You'd want to refresh the client data here or update the parent component
          } catch (error) {
            console.error('Failed to update client:', error);
          } finally {
            setLoading(false);
          }
        };

        const [activeCall, setActiveCall] = useState(null);
        const [callStartTime, setCallStartTime] = useState(null);
        const [callDuration, setCallDuration] = useState(0);
        const [showAdvancedCallLog, setShowAdvancedCallLog] = useState(null);

        // Real-time call timer
        React.useEffect(() => {
          let interval = null;
          if (activeCall && callStartTime) {
            interval = setInterval(() => {
              const now = new Date().getTime();
              const duration = Math.floor((now - callStartTime) / 1000);
              setCallDuration(duration);
            }, 1000);
          } else {
            clearInterval(interval);
          }
          return () => clearInterval(interval);
        }, [activeCall, callStartTime]);

        const handleCallClient = async (phoneNumber, clientId = null) => {
          try {
            // Start the call
            console.log(`📞 Starting call to ${phoneNumber}...`);
            console.log('📞 Client object:', client);
            console.log('📞 Client ID:', client?.id);
            console.log('📞 Passed clientId:', clientId);
            
            const finalClientId = clientId || client?.id;
            const callData = {
              phoneNumber,
              clientId: finalClientId,
              clientName: client ? `${client.firstName || client.first_name} ${client.lastName || client.last_name}` : 'Unknown Client'
            };
            
            console.log('📞 Final call data:', callData);
            
            setActiveCall(callData);
            setCallStartTime(new Date().getTime());
            setCallDuration(0);
            setShowAdvancedCallLog(callData);
            
            // Show user feedback
            setVoiceStatus(`📞 Call started to ${phoneNumber}... Timer running!`);
            
          } catch (error) {
            console.error('Failed to initiate call:', error);
            setVoiceStatus('❌ Failed to make call. Please try again.');
          }
        };

        const handleEndCall = async (outcome, notes, followUpDays = 7, callCategory = 'general') => {
          try {
            console.log('🎯 handleEndCall called with:', { outcome, notes, followUpDays, callCategory });
            console.log('🎯 activeCall:', activeCall);
            console.log('🎯 callStartTime:', callStartTime);
            console.log('🎯 callDuration:', callDuration);
            
            if (!activeCall) {
              console.log('❌ No active call - exiting handleEndCall');
              return;
            }
            
            const finalDuration = Math.floor(callDuration / 60); // Convert to minutes
            const followUpDate = followUpDays > 0 ? 
              new Date(Date.now() + followUpDays * 24 * 60 * 60 * 1000).toISOString().split('T')[0] : 
              null;

            const callRecord = {
              id: 'call-' + Date.now(),
              client_id: activeCall.clientId,
              phoneNumber: activeCall.phoneNumber,
              call_type: 'outbound',
              duration: finalDuration,
              durationSeconds: callDuration,
              notes: notes || `Called ${activeCall.phoneNumber}`,
              outcome,
              category: callCategory,
              follow_up_date: followUpDate,
              followUpDate: followUpDate,
              createdAt: new Date().toISOString(),
              startTime: new Date(callStartTime).toISOString(),
              endTime: new Date().toISOString()
            };

            // Update clients array with new call record
            if (setClients) {
              console.log('🔄 Updating clients array with new call record...');
              console.log('🔄 Looking for client ID:', activeCall.clientId);
              
              setClients(prevClients => {
                console.log('🔄 Previous clients:', prevClients.length);
                const updatedClients = prevClients.map(clientItem => {
                  console.log('🔄 Checking client:', clientItem.id, 'vs', activeCall.clientId);
                  if (clientItem.id === activeCall.clientId) {
                    const updatedClient = { 
                      ...clientItem, 
                      calls: [...(clientItem.calls || []), callRecord] 
                    };
                    console.log('✅ Found matching client, updating calls from', clientItem.calls?.length || 0, 'to', updatedClient.calls.length);
                    
                    // Also update the selected client to trigger re-render
                    if (setSelectedClient && client.id === activeCall.clientId) {
                      console.log('✅ Also updating selectedClient');
                      setSelectedClient(updatedClient);
                    }
                    
                    return updatedClient;
                  }
                  return clientItem;
                });
                
                console.log('🔄 Updated clients array returned');
                return updatedClients;
              });
            } else {
              console.log('❌ setClients function not available!');
            }

            console.log('✅ Call record created:', callRecord);
            console.log('✅ Updating client ID:', activeCall.clientId);
            console.log('✅ Current client calls:', client.calls?.length || 0);

            // Reset call state
            setActiveCall(null);
            setCallStartTime(null);
            setCallDuration(0);
            setShowAdvancedCallLog(null);
            
            // Show success message with detailed info
            const successMsg = `✅ Call logged! Duration: ${finalDuration}m ${callDuration % 60}s | Outcome: ${outcome}${followUpDate ? ` | Follow-up: ${followUpDate}` : ''}`;
            setVoiceStatus(successMsg);
            
            // Also show browser alert to confirm logging
            setTimeout(() => {
              alert(`📞 Call Successfully Logged!\n\n` +
                    `Client: ${activeCall?.clientName}\n` +
                    `Phone: ${activeCall.phoneNumber}\n` +
                    `Duration: ${finalDuration}m ${callDuration % 60}s\n` +
                    `Outcome: ${outcome}\n` +
                    `Notes: ${notes || 'No additional notes'}\n` +
                    `${followUpDate ? `Follow-up: ${followUpDate}` : 'No follow-up scheduled'}\n\n` +
                    `✅ Call has been added to client history and activity timeline.`);
              setVoiceStatus('');
            }, 1000);

            console.log('✅ Call logged successfully:', callRecord);
            console.log('✅ Updated client should have calls:', client.calls?.length + 1 || 1);
            
          } catch (error) {
            console.error('Failed to log call:', error);
            setVoiceStatus('❌ Failed to log call');
            setTimeout(() => setVoiceStatus(''), 3000);
          }
        };

        const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);

        const handleDeleteClient = async () => {
          try {
            setLoading(true);
            // Here you would call your API to delete the client
            console.log('Deleting client:', client.id);
            // await API.clients.delete(client.id);
            
            // Close modal and show success
            onClose();
            alert(`✅ Client ${client.firstName || client.first_name} ${client.lastName || client.last_name} has been deleted successfully!`);
            
            // In real implementation, you'd also refresh the client list
            // window.location.reload(); // or better: call a refresh function
            
          } catch (error) {
            console.error('Failed to delete client:', error);
            alert('❌ Failed to delete client. Please try again.');
          } finally {
            setLoading(false);
            setShowDeleteConfirm(false);
          }
        };

        const renderOverviewTab = () => {
          // Debug logging for call data
          console.log('🔍 Rendering overview tab for client:', client.id);
          console.log('🔍 Client calls:', client.calls?.length || 0, client.calls);
          
          if (isEditing) {
            return React.createElement('div', { className: 'w-full space-y-4' },
              React.createElement('div', { className: 'grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4' },
                React.createElement('input', {
                  type: 'text',
                  placeholder: 'First Name',
                  value: editData.firstName,
                  onChange: (e) => setEditData(prev => ({ ...prev, firstName: e.target.value })),
                  className: 'p-3 bg-gray-700 rounded border border-gray-600 text-white'
                }),
                React.createElement('input', {
                  type: 'text',
                  placeholder: 'Last Name',
                  value: editData.lastName,
                  onChange: (e) => setEditData(prev => ({ ...prev, lastName: e.target.value })),
                  className: 'p-3 bg-gray-700 rounded border border-gray-600 text-white'
                })
              ),
              React.createElement('input', {
                type: 'email',
                placeholder: 'Email',
                value: editData.email,
                onChange: (e) => setEditData(prev => ({ ...prev, email: e.target.value })),
                className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white'
              }),
              React.createElement('input', {
                type: 'tel',
                placeholder: 'Phone',
                value: editData.phone,
                onChange: (e) => setEditData(prev => ({ ...prev, phone: e.target.value })),
                className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white'
              }),
              React.createElement('input', {
                type: 'text',
                placeholder: 'Address',
                value: editData.address,
                onChange: (e) => setEditData(prev => ({ ...prev, address: e.target.value })),
                className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white'
              }),
              React.createElement('div', { className: 'grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4' },
                React.createElement('input', {
                  type: 'date',
                  placeholder: 'Birthday',
                  value: editData.birthday,
                  onChange: (e) => setEditData(prev => ({ ...prev, birthday: e.target.value })),
                  className: 'p-3 bg-gray-700 rounded border border-gray-600 text-white'
                }),
                React.createElement('input', {
                  type: 'date',
                  placeholder: 'Anniversary',
                  value: editData.anniversary,
                  onChange: (e) => setEditData(prev => ({ ...prev, anniversary: e.target.value })),
                  className: 'p-3 bg-gray-700 rounded border border-gray-600 text-white'
                })
              ),
              React.createElement('div', { className: 'grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4' },
                React.createElement('input', {
                  type: 'text',
                  placeholder: 'Spouse Name',
                  value: editData.spouse,
                  onChange: (e) => setEditData(prev => ({ ...prev, spouse: e.target.value })),
                  className: 'p-3 bg-gray-700 rounded border border-gray-600 text-white'
                }),
                React.createElement('input', {
                  type: 'text',
                  placeholder: 'Children',
                  value: editData.children,
                  onChange: (e) => setEditData(prev => ({ ...prev, children: e.target.value })),
                  className: 'p-3 bg-gray-700 rounded border border-gray-600 text-white'
                })
              ),
              React.createElement('input', {
                type: 'text',
                placeholder: 'Tags (comma-separated)',
                value: editData.tags,
                onChange: (e) => setEditData(prev => ({ ...prev, tags: e.target.value })),
                className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white'
              }),
              React.createElement('textarea', {
                placeholder: 'Notes',
                value: editData.notes,
                onChange: (e) => setEditData(prev => ({ ...prev, notes: e.target.value })),
                rows: 4,
                className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white'
              }),
              React.createElement('div', { className: 'flex space-x-3 pt-4' },
                React.createElement('button', {
                  onClick: handleSaveEdit,
                  disabled: loading,
                  className: 'flex-1 bg-green-600 text-white p-3 rounded hover:bg-green-700 disabled:opacity-50'
                }, loading ? '💾 Saving...' : '💾 Save Changes'),
                React.createElement('button', {
                  onClick: () => setIsEditing(false),
                  className: 'flex-1 bg-gray-600 text-white p-3 rounded hover:bg-gray-700'
                }, '❌ Cancel')
              )
            );
          }

          // Get call history with follow-up dates
          const calls = client.calls || [];
          const sortedCalls = calls.sort((a, b) => new Date(b.createdAt || b.date) - new Date(a.createdAt || a.date));
          const lastCall = sortedCalls[0];
          const nextCallbackDate = lastCall?.followUpDate || lastCall?.follow_up_date;

          // Get properties and tasks for full overview - use client data passed to modal
          const currentClient = client;
          const properties = currentClient.propertiesOfInterest || [];
          const tasks = currentClient.todos || [];
          const pendingTasks = tasks.filter(task => !task.completed);
          // For overview, show recent tasks (both pending and recently completed)
          const recentTasks = tasks
            .sort((a, b) => new Date(b.createdAt || b.created_at || '2024-01-01') - new Date(a.createdAt || a.created_at || '2024-01-01'))
            .slice(0, 5); // Show up to 5 recent tasks

          return React.createElement('div', { className: 'w-full space-y-4' },
            // Client Header with Quick Actions - Mobile Responsive
            React.createElement('div', { className: 'bg-gradient-to-r from-blue-600 to-purple-600 p-4 sm:p-6 rounded-lg text-white' },
              React.createElement('div', { className: 'flex flex-col sm:flex-row justify-between items-start gap-4 sm:gap-0' },
                React.createElement('div', null,
                  React.createElement('h3', { className: 'text-2xl font-bold mb-2' }, 
                    `${client.firstName || client.first_name || 'Unknown'} ${client.lastName || client.last_name || 'Client'}`
                  ),
                  React.createElement('div', { className: 'space-y-1' },
                    React.createElement('p', { className: 'flex items-center' }, 
                      '📧 ', 
                      React.createElement('a', { 
                        href: `mailto:${client.email}`, 
                        className: 'text-blue-200 hover:text-white ml-2' 
                      }, client.email)
                    ),
                    client.phone && React.createElement('p', { className: 'flex items-center' }, 
                      '📞 ',
                      React.createElement('button', {
                        onClick: () => handleCallClient(client.phone),
                        className: 'text-blue-200 hover:text-white ml-2 underline cursor-pointer bg-transparent border-none'
                      }, client.phone),
                      React.createElement('span', { className: 'ml-2 text-xs bg-green-500 px-2 py-1 rounded' }, '👆 Click to call')
                    ),
                    client.address && React.createElement('p', null, '📍 ', client.address),
                    
                    // Next callback reminder
                    nextCallbackDate && React.createElement('p', { className: 'flex items-center mt-2 bg-yellow-600 bg-opacity-30 px-3 py-1 rounded' },
                      '📅 ',
                      React.createElement('span', { className: 'ml-2 text-yellow-200' }, 
                        `Next callback: ${new Date(nextCallbackDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}`
                      )
                    ),

                    // Active Call Indicator
                    activeCall && React.createElement('p', { className: 'flex items-center mt-2 bg-green-600 bg-opacity-50 px-3 py-2 rounded animate-pulse' },
                      '📞 ',
                      React.createElement('span', { className: 'ml-2 text-green-200 font-semibold' }, 
                        `CALL IN PROGRESS • ${Math.floor(callDuration / 60)}:${(callDuration % 60).toString().padStart(2, '0')}`
                      ),
                      React.createElement('span', { className: 'ml-2 text-xs bg-red-500 px-2 py-1 rounded animate-pulse' }, 'LIVE')
                    ),

                    // Debug Test Button (temporary)
                    React.createElement('button', {
                      onClick: () => {
                        const testCall = {
                          id: 'test-call-' + Date.now(),
                          phoneNumber: client.phone,
                          duration: 5,
                          durationSeconds: 300,
                          notes: 'Test call logged from debug button',
                          outcome: 'Connected',
                          category: 'general',
                          createdAt: new Date().toISOString(),
                          client_id: client.id
                        };
                        
                        if (setClients) {
                          console.log('🧪 TEST: Adding test call to client:', client.id);
                          console.log('🧪 TEST: Test call data:', testCall);
                          
                          setClients(prevClients => 
                            prevClients.map(clientItem => {
                              if (clientItem.id === client.id) {
                                const updatedClient = { 
                                  ...clientItem, 
                                  calls: [...(clientItem.calls || []), testCall] 
                                };
                                console.log('🧪 TEST: Updated client calls:', updatedClient.calls);
                                
                                // Force re-render by updating selected client
                                if (setSelectedClient) {
                                  setSelectedClient(updatedClient);
                                }
                                
                                return updatedClient;
                              }
                              return clientItem;
                            })
                          );
                          
                          setVoiceStatus('🧪 Test call added! Check call history.');
                          setTimeout(() => setVoiceStatus(''), 3000);
                        }
                      },
                      className: 'mt-2 text-xs bg-yellow-600 px-2 py-1 rounded hover:bg-yellow-700'
                    }, '🧪 Add Test Call')
                  )
                ),
                React.createElement('div', { className: 'text-right' },
                  React.createElement('div', { className: 'text-3xl font-bold text-green-300' }, 
                    `$${(client.lifetimeNetCommission || client.lifetime_commission || 0).toLocaleString()}`
                  ),
                  React.createElement('div', { className: 'text-sm text-blue-200' }, 'Lifetime Value')
                )
              )
            ),

            // Personal Information (removed heart emoji)
            (client.birthday || client.anniversary || client.spouse || client.children) && 
            React.createElement('div', { className: 'bg-gray-700 p-4 rounded-lg' },
              React.createElement('h4', { className: 'text-lg font-semibold mb-3 text-blue-300' }, 'Personal Information'),
              React.createElement('div', { className: 'grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4' },
                client.birthday && React.createElement('div', null,
                  React.createElement('p', { className: 'text-sm text-gray-400' }, 'Birthday'),
                  React.createElement('p', { className: 'font-semibold' }, 
                    `🎂 ${new Date(client.birthday).toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}`
                  )
                ),
                client.anniversary && React.createElement('div', null,
                  React.createElement('p', { className: 'text-sm text-gray-400' }, 'Anniversary'),
                  React.createElement('p', { className: 'font-semibold' }, 
                    `💍 ${new Date(client.anniversary).toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}`
                  )
                ),
                client.spouse && React.createElement('div', null,
                  React.createElement('p', { className: 'text-sm text-gray-400' }, 'Spouse'),
                  React.createElement('p', { className: 'font-semibold' }, `👫 ${client.spouse}`)
                ),
                client.children && React.createElement('div', null,
                  React.createElement('p', { className: 'text-sm text-gray-400' }, 'Children'),
                  React.createElement('p', { className: 'font-semibold' }, `👶 ${client.children}`)
                )
              )
            ),

            // Call Log Section
            React.createElement('div', { className: 'bg-gray-700 p-4 rounded-lg' },
              React.createElement('h4', { className: 'text-lg font-semibold mb-3 text-blue-300 flex items-center justify-between' }, 
                React.createElement('span', null, `📞 Call History (${calls.length})`),
                calls.length > 3 && React.createElement('span', { className: 'text-xs text-gray-400' }, 'Showing latest 3')
              ),
              calls.length === 0 ? 
                React.createElement('p', { className: 'text-gray-400 text-center py-4' }, 'No calls logged yet') :
                React.createElement('div', { className: 'space-y-3' },
                  sortedCalls.slice(0, 3).map((call, index) =>
                    React.createElement('div', { 
                      key: index, 
                      className: 'bg-gray-600 p-3 rounded border-l-4 border-blue-500'
                    },
                      React.createElement('div', { className: 'flex justify-between items-start' },
                        React.createElement('div', null,
                          React.createElement('p', { className: 'font-semibold text-sm' }, 
                            `${call.outcome || 'Unknown'} - ${call.duration || 0} minutes`
                          ),
                          React.createElement('p', { className: 'text-xs text-gray-300 mt-1' }, 
                            call.notes || 'No notes'
                          ),
                          (call.followUpDate || call.follow_up_date) && React.createElement('p', { className: 'text-xs text-yellow-400 mt-1' },
                            `📅 Follow-up: ${new Date(call.followUpDate || call.follow_up_date).toLocaleDateString()}`
                          )
                        ),
                        React.createElement('span', { className: 'text-xs text-gray-400' }, 
                          call.createdAt ? new Date(call.createdAt).toLocaleDateString('en-US', { 
                            month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' 
                          }) : 'Date unknown'
                        )
                      )
                    )
                  )
                )
            ),

            // Properties Overview
            React.createElement('div', { className: 'bg-gray-700 p-4 rounded-lg' },
              React.createElement('h4', { className: 'text-lg font-semibold mb-3 text-green-300 flex items-center justify-between' }, 
                React.createElement('span', null, `🏠 Properties (${properties.length})`),
                React.createElement('button', {
                  onClick: () => setShowAddProperty(true),
                  className: 'text-xs bg-green-600 px-3 py-1 rounded hover:bg-green-700'
                }, '+ Add')
              ),
              properties.length === 0 ? 
                React.createElement('p', { className: 'text-gray-400 text-center py-4' }, 'No properties of interest') :
                React.createElement('div', { className: 'space-y-2' },
                  properties.slice(0, 2).map((property, index) =>
                    React.createElement('div', { 
                      key: index, 
                      className: 'bg-gray-600 p-3 rounded flex justify-between items-center'
                    },
                      React.createElement('div', null,
                        React.createElement('p', { className: 'font-semibold text-sm' }, property.address),
                        React.createElement('p', { className: 'text-xs text-green-400' }, 
                          `$${property.price.toLocaleString()} • ${property.bedrooms}bed/${property.bathrooms}bath`
                        )
                      ),
                      React.createElement('button', { className: 'text-blue-400 text-xs' }, 'View')
                    )
                  ),
                  properties.length > 2 && React.createElement('p', { className: 'text-xs text-gray-400 text-center pt-2' },
                    `... and ${properties.length - 2} more properties`
                  )
                )
            ),

            // Tasks Overview
            React.createElement('div', { className: 'bg-gray-700 p-4 rounded-lg' },
              React.createElement('h4', { className: 'text-lg font-semibold mb-3 text-yellow-300 flex items-center justify-between' }, 
                React.createElement('span', null, `✓ Tasks (${pendingTasks.length} pending, ${tasks.filter(t => t.completed).length} completed)`),
                React.createElement('button', {
                  onClick: () => {
                    setTaskFormData({
                      title: '',
                      description: '',
                      type: 'general',
                      priority: 'medium',
                      dueDate: '',
                      time: '',
                      clientId: client.id,
                      clientName: `${client.firstName || client.first_name} ${client.lastName || client.last_name}`,
                      status: 'pending'
                    });
                    setShowVoiceTaskModal(true);
                  },
                  className: 'text-xs bg-yellow-600 px-3 py-1 rounded hover:bg-yellow-700'
                }, '+ Add')
              ),
              recentTasks.length === 0 ? 
                React.createElement('p', { className: 'text-gray-400 text-center py-4' }, 'No tasks yet') :
                React.createElement('div', { className: 'space-y-2' },
                  recentTasks.map((task, index) =>
                    React.createElement('div', { 
                      key: task.id || `task-${index}`, 
                      className: `p-3 rounded flex items-center justify-between ${
                        task.completed ? 'bg-gray-700 opacity-75' : 'bg-gray-600'
                      }`
                    },
                      React.createElement('div', { className: 'flex items-center space-x-3' },
                        React.createElement('div', {
                          onClick: () => {
                            console.log('🔍 Overview task click - Task ID:', task.id, 'Task:', task);
                            
                            // Update the task completion status
                            const updatedCompleted = !task.completed;
                            const updatedTask = { ...task, completed: updatedCompleted, completedAt: new Date().toISOString() };
                            
                            console.log('🔄 Updating task in overview:', updatedTask);
                            
                            // Show visual feedback
                            setVoiceStatus(updatedCompleted ? `✅ Task "${task.text || task.title}" completed!` : `🔄 Task "${task.text || task.title}" reopened!`);
                            setTimeout(() => setVoiceStatus(''), 3000);
                            
                            // Update clients array
                            setClients(prevClients => {
                              const newClients = prevClients.map(c => {
                                if (c.id === client.id) {
                                  const updatedTodos = (c.todos || []).map((t, tIndex) => {
                                    console.log('🔍 Overview comparing task IDs:', t.id, 'vs', task.id);
                                    // Use ID if available, otherwise fall back to text and index comparison
                                    const isMatch = t.id && task.id ? 
                                      t.id === task.id : 
                                      (t.text === task.text && t.dueDate === task.dueDate);
                                    console.log('🎯 Overview match result:', isMatch, 'for task:', t.text);
                                    return isMatch ? updatedTask : t;
                                  });
                                  console.log('📝 Overview updated todos for client:', updatedTodos);
                                  return { ...c, todos: updatedTodos };
                                }
                                return c;
                              });
                              console.log('🔄 Overview - Updated clients array:', newClients);
                              return newClients;
                            });
                            
                            // Force re-render by updating selectedClient if it exists
                            if (setSelectedClient && client.id) {
                              setSelectedClient(prev => {
                                if (prev && prev.id === client.id) {
                                  const updatedTodos = (prev.todos || []).map(t => {
                                    const isMatch = t.id && task.id ? 
                                      t.id === task.id : 
                                      (t.text === task.text && t.dueDate === task.dueDate);
                                    return isMatch ? updatedTask : t;
                                  });
                                  return { ...prev, todos: updatedTodos };
                                }
                                return prev;
                              });
                            }
                          },
                          className: `w-5 h-5 border-2 rounded cursor-pointer flex items-center justify-center transition-colors ${
                            task.completed 
                              ? 'bg-green-600 border-green-600 text-white' 
                              : 'border-gray-400 hover:border-gray-300'
                          }`
                        },
                          task.completed ? React.createElement('span', { 
                            className: 'text-xs font-bold text-white' 
                          }, '✓') : null
                        ),
                        React.createElement('div', null,
                          React.createElement('p', { 
                            className: `font-semibold text-sm ${task.completed ? 'line-through text-gray-400' : ''}` 
                          }, task.text || task.title),
                          (task.description || task.notes) && React.createElement('p', { 
                            className: 'text-xs text-gray-300 mt-1' 
                          }, task.description && task.description.startsWith('Voice-created task: ') 
                              ? '🎤 ' + task.description.replace('Voice-created task: ', '') 
                              : task.description || task.notes),
                          React.createElement('p', { className: 'text-xs text-gray-400' }, 
                            task.dueDate ? `Due: ${new Date(task.dueDate).toLocaleDateString()}` : 'No due date'
                          )
                        )
                      ),
                      React.createElement('div', { className: 'flex items-center space-x-2' },
                        React.createElement('span', { 
                          className: `px-2 py-1 rounded text-xs ${
                            task.priority === 'high' ? 'bg-red-600' :
                            task.priority === 'medium' ? 'bg-yellow-600' : 'bg-green-600'
                          }`
                        }, task.priority || 'low'),
                        React.createElement('button', {
                          onClick: () => {
                            setTaskFormData({
                              id: task.id,
                              title: task.text || task.title,
                              description: task.description || task.notes || '',
                              type: task.type || 'general',
                              priority: task.priority || 'medium',
                              dueDate: task.dueDate || '',
                              time: task.time || '',
                              clientId: client.id,
                              clientName: `${client.firstName || client.first_name} ${client.lastName || client.last_name}`,
                              status: task.completed ? 'completed' : 'pending',
                              isEditing: true
                            });
                            setShowVoiceTaskModal(true);
                          },
                          className: 'text-xs bg-blue-600 px-2 py-1 rounded hover:bg-blue-700 text-white'
                        }, '✏️')
                      )
                    )
                  ),
                  pendingTasks.length > 3 && React.createElement('p', { className: 'text-xs text-gray-400 text-center pt-2' },
                    `... and ${pendingTasks.length - 3} more tasks`
                  )
                )
            ),

            // Commission Summary
            React.createElement('div', { className: 'bg-gray-700 p-4 rounded-lg' },
              React.createElement('h4', { className: 'text-lg font-semibold mb-3 text-green-300' }, '💰 Commission Summary'),
              React.createElement('div', { className: 'grid grid-cols-3 gap-4 text-center' },
                React.createElement('div', null,
                  React.createElement('p', { className: 'text-2xl font-bold text-green-400' }, 
                    `$${(client.lifetimeNetCommission || client.lifetime_commission || 0).toLocaleString()}`
                  ),
                  React.createElement('p', { className: 'text-sm text-gray-400' }, 'Total Commission')
                ),
                React.createElement('div', null,
                  React.createElement('p', { className: 'text-2xl font-bold text-blue-400' }, 
                    (client.transactions || []).length
                  ),
                  React.createElement('p', { className: 'text-sm text-gray-400' }, 'Transactions')
                ),
                React.createElement('div', null,
                  React.createElement('p', { className: 'text-2xl font-bold text-purple-400' }, 
                    calls.length
                  ),
                  React.createElement('p', { className: 'text-sm text-gray-400' }, 'Total Calls')
                )
              )
            ),

            // Tags
            client.tags && client.tags.length > 0 && React.createElement('div', null,
              React.createElement('h4', { className: 'text-lg font-semibold mb-3' }, '🏷️ Tags'),
              React.createElement('div', { className: 'flex flex-wrap gap-2' },
                client.tags.map((tag, index) =>
                  React.createElement('span', {
                    key: index,
                    className: 'px-3 py-1 bg-blue-600 text-blue-100 rounded-full text-sm font-medium'
                  }, tag)
                )
              )
            ),

            // Notes
            client.notes && React.createElement('div', null,
              React.createElement('h4', { className: 'text-lg font-semibold mb-3' }, '📝 Notes'),
              React.createElement('div', { className: 'bg-gray-700 p-4 rounded-lg' },
                React.createElement('p', { className: 'text-gray-300 leading-relaxed' }, client.notes)
              )
            ),

            // Delete Confirmation Modal
            showDeleteConfirm && React.createElement('div', { 
              className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50',
              onClick: () => setShowDeleteConfirm(false)
            },
              React.createElement('div', { 
                className: 'bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4',
                onClick: (e) => e.stopPropagation()
              },
                React.createElement('div', { className: 'text-center' },
                  React.createElement('div', { className: 'text-6xl mb-4' }, '⚠️'),
                  React.createElement('h3', { className: 'text-xl font-bold mb-2 text-red-400' }, 'Delete Client'),
                  React.createElement('p', { className: 'text-gray-300 mb-6' }, 
                    `Are you sure you want to delete ${client.firstName || client.first_name} ${client.lastName || client.last_name}? This action cannot be undone.`
                  ),
                  React.createElement('div', { className: 'flex space-x-3' },
                    React.createElement('button', {
                      onClick: handleDeleteClient,
                      disabled: loading,
                      className: 'flex-1 bg-red-600 text-white p-3 rounded hover:bg-red-700 disabled:opacity-50'
                    }, loading ? '🗑️ Deleting...' : '🗑️ Delete Client'),
                    React.createElement('button', {
                      onClick: () => setShowDeleteConfirm(false),
                      className: 'flex-1 bg-gray-600 text-white p-3 rounded hover:bg-gray-700'
                    }, 'Cancel')
                  )
                )
              )
            )
          );
        };

        const renderPropertiesTab = () => {
          const properties = client.propertiesOfInterest || [];
          
          return React.createElement('div', { className: 'w-full space-y-4' },
            React.createElement('div', { className: 'flex justify-between items-center' },
              React.createElement('h4', { className: 'text-lg font-semibold' }, `🏠 Properties (${properties.length})`),
              React.createElement('button', {
                onClick: handleAddProperty,
                className: 'bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 flex items-center space-x-2'
              }, 
                React.createElement('span', null, '+'),
                React.createElement('span', null, 'Add Property')
              )
            ),
            
            properties.length === 0 ? 
              React.createElement('div', { className: 'text-center py-12 text-gray-400' },
                React.createElement('div', { className: 'text-6xl mb-4' }, '🏠'),
                React.createElement('p', { className: 'text-lg mb-2' }, 'No properties yet'),
                React.createElement('p', null, 'Add properties this client is interested in'),
                React.createElement('button', {
                  onClick: handleAddProperty,
                  className: 'mt-4 bg-green-600 text-white px-6 py-3 rounded hover:bg-green-700'
                }, 'Add Your First Property')
              ) :
              React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-4' },
                properties.map((property) =>
                  React.createElement('div', { 
                    key: property.id, 
                    className: 'bg-gray-700 p-4 rounded-lg border border-gray-600 hover:border-blue-500 transition-colors cursor-pointer',
                    onClick: () => setShowPropertyDetail(property)
                  },
                    React.createElement('div', { className: 'mb-3' },
                      React.createElement('div', { className: 'flex justify-between items-start mb-2' },
                        React.createElement('h5', { className: 'font-semibold text-lg text-white' }, property.address),
                        React.createElement('span', { 
                          className: `px-2 py-1 rounded text-xs ${
                            property.status === 'active' ? 'bg-green-600 text-green-100' :
                            property.status === 'pending' ? 'bg-yellow-600 text-yellow-100' :
                            property.status === 'sold' ? 'bg-red-600 text-red-100' : 'bg-gray-600'
                          }`
                        }, (property.status || 'active').toUpperCase())
                      ),
                      React.createElement('p', { className: 'text-green-400 font-bold text-xl' }, 
                        `$${property.price.toLocaleString()}`
                      ),
                      React.createElement('div', { className: 'grid grid-cols-3 gap-4 mt-2 text-sm text-gray-300' },
                        React.createElement('div', null, `🛏️ ${property.bedrooms} bed`),
                        React.createElement('div', null, `🚿 ${property.bathrooms} bath`),
                        React.createElement('div', null, `📐 ${property.sqft} sqft`)
                      )
                    ),
                    property.description && React.createElement('p', { className: 'text-sm text-gray-400 line-clamp-2 mb-3' }, 
                      property.description
                    ),
                    React.createElement('div', { className: 'flex justify-between items-center' },
                      React.createElement('span', { className: 'text-xs text-gray-500' }, 
                        property.propertyType ? property.propertyType.charAt(0).toUpperCase() + property.propertyType.slice(1) : 'House'
                      ),
                      React.createElement('div', { className: 'flex space-x-2' },
                        React.createElement('button', {
                          onClick: (e) => { e.stopPropagation(); handleEditProperty(property); },
                          className: 'text-blue-400 hover:text-blue-300 text-sm px-2 py-1 rounded bg-blue-900 bg-opacity-50'
                        }, '✏️ Edit'),
                        React.createElement('button', {
                          onClick: (e) => { e.stopPropagation(); handleDeleteProperty(property.id); },
                          className: 'text-red-400 hover:text-red-300 text-sm px-2 py-1 rounded bg-red-900 bg-opacity-50'
                        }, '🗑️ Delete')
                      )
                    )
                  )
                )
              ),
              
            // Property Detail Modal
            showPropertyDetail && React.createElement('div', { 
              className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50',
              onClick: () => setShowPropertyDetail(null)
            },
              React.createElement('div', { 
                className: 'bg-gray-800 rounded-lg p-6 max-w-2xl w-full mx-4 max-h-96 overflow-y-auto',
                onClick: (e) => e.stopPropagation()
              },
                React.createElement('div', { className: 'flex justify-between items-center mb-4' },
                  React.createElement('h3', { className: 'text-xl font-bold' }, showPropertyDetail.address),
                  React.createElement('button', {
                    onClick: () => setShowPropertyDetail(null),
                    className: 'text-gray-400 hover:text-white text-2xl'
                  }, '×')
                ),
                React.createElement('div', { className: 'space-y-4' },
                  React.createElement('div', { className: 'grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4' },
                    React.createElement('div', null,
                      React.createElement('p', { className: 'text-sm text-gray-400' }, 'Price'),
                      React.createElement('p', { className: 'text-2xl font-bold text-green-400' }, 
                        `$${showPropertyDetail.price.toLocaleString()}`
                      )
                    ),
                    React.createElement('div', null,
                      React.createElement('p', { className: 'text-sm text-gray-400' }, 'Status'),
                      React.createElement('span', { 
                        className: `px-2 py-1 rounded text-sm ${
                          showPropertyDetail.status === 'active' ? 'bg-green-600 text-green-100' :
                          showPropertyDetail.status === 'pending' ? 'bg-yellow-600 text-yellow-100' :
                          'bg-red-600 text-red-100'
                        }`
                      }, (showPropertyDetail.status || 'active').toUpperCase())
                    )
                  ),
                  React.createElement('div', { className: 'grid grid-cols-4 gap-4' },
                    React.createElement('div', null,
                      React.createElement('p', { className: 'text-sm text-gray-400' }, 'Bedrooms'),
                      React.createElement('p', { className: 'font-semibold' }, `🛏️ ${showPropertyDetail.bedrooms}`)
                    ),
                    React.createElement('div', null,
                      React.createElement('p', { className: 'text-sm text-gray-400' }, 'Bathrooms'),
                      React.createElement('p', { className: 'font-semibold' }, `🚿 ${showPropertyDetail.bathrooms}`)
                    ),
                    React.createElement('div', null,
                      React.createElement('p', { className: 'text-sm text-gray-400' }, 'Square Feet'),
                      React.createElement('p', { className: 'font-semibold' }, `📐 ${showPropertyDetail.sqft}`)
                    ),
                    React.createElement('div', null,
                      React.createElement('p', { className: 'text-sm text-gray-400' }, 'Type'),
                      React.createElement('p', { className: 'font-semibold' }, 
                        showPropertyDetail.propertyType ? showPropertyDetail.propertyType.charAt(0).toUpperCase() + showPropertyDetail.propertyType.slice(1) : 'House'
                      )
                    )
                  ),
                  showPropertyDetail.yearBuilt && React.createElement('div', null,
                    React.createElement('p', { className: 'text-sm text-gray-400' }, 'Year Built'),
                    React.createElement('p', { className: 'font-semibold' }, showPropertyDetail.yearBuilt)
                  ),
                  showPropertyDetail.lotSize && React.createElement('div', null,
                    React.createElement('p', { className: 'text-sm text-gray-400' }, 'Lot Size'),
                    React.createElement('p', { className: 'font-semibold' }, `${showPropertyDetail.lotSize} acres`)
                  ),
                  showPropertyDetail.description && React.createElement('div', null,
                    React.createElement('p', { className: 'text-sm text-gray-400' }, 'Description'),
                    React.createElement('p', { className: 'text-gray-300' }, showPropertyDetail.description)
                  ),
                  showPropertyDetail.features && React.createElement('div', null,
                    React.createElement('p', { className: 'text-sm text-gray-400' }, 'Features'),
                    React.createElement('p', { className: 'text-gray-300' }, showPropertyDetail.features)
                  ),
                  React.createElement('div', { className: 'flex space-x-3 pt-4' },
                    React.createElement('button', {
                      onClick: () => { setShowPropertyDetail(null); handleEditProperty(showPropertyDetail); },
                      className: 'flex-1 bg-blue-600 text-white p-3 rounded hover:bg-blue-700'
                    }, '✏️ Edit Property'),
                    React.createElement('button', {
                      onClick: () => { setShowPropertyDetail(null); handleDeleteProperty(showPropertyDetail.id); },
                      className: 'bg-red-600 text-white px-4 py-3 rounded hover:bg-red-700'
                    }, '🗑️ Delete')
                  )
                )
              )
            )
          );
        };

        const renderTasksTab = () => {
          const tasks = client.todos || [];
          
          return React.createElement('div', { className: 'w-full space-y-4' },
            React.createElement('div', { className: 'flex justify-between items-center' },
              React.createElement('h4', { className: 'text-lg font-semibold' }, `✓ Tasks (${tasks.length})`),
              React.createElement('div', { className: 'flex space-x-2' },
                React.createElement('button', {
                  onClick: () => {
                    setTaskFormData({
                      title: '',
                      description: '',
                      type: 'general',
                      priority: 'medium',
                      dueDate: '',
                      clientId: client.id,
                      clientName: `${client.firstName || client.first_name} ${client.lastName || client.last_name}`,
                      status: 'pending'
                    });
                    setShowVoiceTaskModal(true);
                  },
                  className: 'bg-purple-600 text-white px-3 py-2 rounded hover:bg-purple-700 text-sm'
                }, '🎤 Voice Task'),
                React.createElement('button', {
                  onClick: () => setShowAddTask(true),
                  className: 'bg-green-600 text-white px-3 py-2 rounded hover:bg-green-700 text-sm'
                }, '+ Manual Task')
              )
            ),
            
            tasks.length === 0 ? 
              React.createElement('div', { className: 'text-center py-12 text-gray-400' },
                React.createElement('p', { className: 'text-lg mb-2' }, 'No tasks assigned'),
                React.createElement('p', null, 'Add tasks to track your client work')
              ) :
              React.createElement('div', { className: 'space-y-3' },
                tasks.map((task, index) =>
                  React.createElement('div', { 
                    key: task.id || `task-${index}`, 
                    className: `bg-gray-700 p-4 rounded-lg flex items-center justify-between ${
                      task.completed ? 'opacity-60' : ''
                    }`
                  },
                    React.createElement('div', { className: 'flex items-center space-x-3' },
                      React.createElement('div', {
                        onClick: () => {
                          console.log('🔍 Client modal task click - Task ID:', task.id, 'Task:', task);
                          console.log('📋 All client todos:', client.todos);
                          
                          // Handle task completion toggle
                          const updatedCompleted = !task.completed;
                          const updatedTask = { ...task, completed: updatedCompleted, completedAt: new Date().toISOString() };
                          
                          console.log('🔄 Updating task in client modal:', updatedTask);
                          
                          // Update clients array with precise matching
                          setClients(prevClients => {
                            const newClients = prevClients.map(c => {
                              if (c.id === client.id) {
                                const updatedTodos = (c.todos || []).map(t => {
                                  console.log('🔍 Modal comparing task IDs:', t.id, 'vs', task.id);
                                  const isMatch = t.id && task.id ? 
                                    t.id === task.id : 
                                    (t.text === task.text && t.dueDate === task.dueDate);
                                  console.log('🎯 Modal match result:', isMatch);
                                  return isMatch ? updatedTask : t;
                                });
                                console.log('📝 Modal updated todos:', updatedTodos);
                                return { ...c, todos: updatedTodos };
                              }
                              return c;
                            });
                            return newClients;
                          });
                          
                          // Update selectedClient to reflect changes in modal
                          setSelectedClient(prev => {
                            const updatedTodos = (prev.todos || []).map(t => {
                              console.log('🔍 SelectedClient comparing:', t.id, 'vs', task.id);
                              const isMatch = t.id && task.id ? 
                                t.id === task.id : 
                                (t.text === task.text && t.dueDate === task.dueDate);
                              return isMatch ? updatedTask : t;
                            });
                            return { ...prev, todos: updatedTodos };
                          });
                        },
                        className: `w-5 h-5 border-2 rounded cursor-pointer flex items-center justify-center transition-colors ${
                          task.completed 
                            ? 'bg-green-600 border-green-600 text-white' 
                            : 'border-gray-400 hover:border-gray-300'
                        }`
                      },
                        task.completed ? React.createElement('span', { 
                          className: 'text-xs font-bold text-white' 
                        }, '✓') : null
                      ),
                      React.createElement('div', null,
                        React.createElement('p', { 
                          className: `font-semibold ${task.completed ? 'line-through' : ''}` 
                        }, task.title || task.text),
                        
                        // Show task description if available
                        (task.description || task.notes) && React.createElement('p', { 
                          className: 'text-sm text-gray-300 mt-1 leading-relaxed' 
                        }, task.description && task.description.startsWith('Voice-created task: ') 
                            ? task.description.replace('Voice-created task: ', '🎤 ') 
                            : task.description || task.notes),
                        
                        React.createElement('div', { className: 'flex items-center space-x-2 mt-2' },
                          task.type && React.createElement('span', {
                            className: `px-2 py-1 rounded text-xs ${
                              task.type === 'showing' ? 'bg-blue-600' :
                              task.type === 'follow_up' ? 'bg-green-600' :
                              task.type === 'listing' ? 'bg-purple-600' :
                              task.type === 'documentation' ? 'bg-yellow-600' :
                              task.type === 'appointment' ? 'bg-indigo-600' :
                              task.type === 'marketing' ? 'bg-pink-600' : 'bg-gray-600'
                            }`
                          }, 
                            task.type === 'showing' ? '🏠 Showing' :
                            task.type === 'follow_up' ? '📞 Follow-up' :
                            task.type === 'listing' ? '📝 Listing' :
                            task.type === 'documentation' ? '📋 Documents' :
                            task.type === 'appointment' ? '📅 Appointment' :
                            task.type === 'marketing' ? '📸 Marketing' : '⚡ General'
                          ),
                          React.createElement('p', { className: 'text-xs text-gray-400' }, 
                            task.dueDate ? `Due: ${new Date(task.dueDate).toLocaleDateString()}${task.time ? ` at ${task.time}` : ''}` : 'No due date'
                          )
                        )
                      )
                    ),
                    React.createElement('div', { className: 'flex items-center space-x-2' },
                      React.createElement('span', { 
                        className: `px-2 py-1 rounded text-xs ${
                          task.priority === 'high' ? 'bg-red-600' :
                          task.priority === 'medium' ? 'bg-yellow-600' : 'bg-green-600'
                        }`
                      }, task.priority || 'low'),
                      React.createElement('button', {
                        className: 'text-blue-400 hover:text-blue-300 text-sm'
                      }, '✏️')
                    )
                  )
                )
              ),
              
            // Add Task Modal
            showAddTask && React.createElement('div', { 
              className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50',
              onClick: () => setShowAddTask(false)
            },
              React.createElement('div', { 
                className: 'bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4',
                onClick: (e) => e.stopPropagation()
              },
                React.createElement('h3', { className: 'text-xl font-bold mb-4' }, 'Add New Task'),
                React.createElement('p', { className: 'text-gray-400 mb-4' }, 
                  'Task management coming soon! This will allow you to assign and track tasks for this client.'
                ),
                React.createElement('button', {
                  onClick: () => setShowAddTask(false),
                  className: 'w-full bg-gray-600 text-white p-3 rounded hover:bg-gray-700'
                }, 'Close')
              )
            )
          );
        };

        const renderActivityTab = () => {
          // Debug logging for activity data
          console.log('🔍 Rendering activity tab for client:', client.id);
          console.log('🔍 Client calls for activity:', client.calls?.length || 0, client.calls);
          
          const allActivity = [
            ...(client.calls || []).map(call => ({
              type: 'call',
              date: call.createdAt || call.date,
              title: `📞 Call - ${call.outcome || 'Unknown outcome'}`,
              description: `Duration: ${call.duration} minutes. ${call.notes}`,
              icon: '📞'
            })),
            ...(client.transactions || []).map(txn => ({
              type: 'transaction',
              date: txn.close_date || txn.createdAt,
              title: `💰 ${txn.type || 'Sale'} - ${txn.address || 'Property'}`,
              description: `Sale Price: $${(txn.price || 0).toLocaleString()}, Commission: $${(txn.net_commission || 0).toLocaleString()}`,
              icon: '💰'
            })),
            // Add other activity types as needed
          ].sort((a, b) => new Date(b.date) - new Date(a.date));

          return React.createElement('div', { className: 'w-full space-y-4' },
            React.createElement('h4', { className: 'text-lg font-semibold mb-4' }, `📈 Activity Timeline (${allActivity.length})`),
            
            allActivity.length === 0 ? 
              React.createElement('div', { className: 'text-center py-12 text-gray-400' },
                React.createElement('p', { className: 'text-lg mb-2' }, 'No activity yet'),
                React.createElement('p', null, 'Client interactions will appear here')
              ) :
              React.createElement('div', { className: 'space-y-4 max-h-96 overflow-y-auto' },
                allActivity.map((activity, index) =>
                  React.createElement('div', { 
                    key: index, 
                    className: 'bg-gray-700 p-4 rounded-lg border-l-4 border-blue-500'
                  },
                    React.createElement('div', { className: 'flex justify-between items-start' },
                      React.createElement('div', null,
                        React.createElement('h5', { className: 'font-semibold flex items-center' },
                          React.createElement('span', { className: 'mr-2' }, activity.icon),
                          activity.title
                        ),
                        React.createElement('p', { className: 'text-sm text-gray-300 mt-1' }, activity.description),
                        React.createElement('p', { className: 'text-xs text-gray-400 mt-2' }, 
                          activity.date ? new Date(activity.date).toLocaleDateString('en-US', { 
                            month: 'short', day: 'numeric', year: 'numeric', hour: '2-digit', minute: '2-digit' 
                          }) : 'Date unknown'
                        )
                      )
                    )
                  )
                )
              )
          );
        };

        // Debug logging for modal rendering
        console.log('🎯 ClientDetailModal: Rendering modal for client:', client.id);
        console.log('🎯 ClientDetailModal: Active tab:', activeTab);
        console.log('🎯 ClientDetailModal: Client data:', client);

        return React.createElement('div', { 
          className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50',
          onClick: onClose,
          style: { backgroundColor: 'rgba(0, 0, 0, 0.75)' } // Ensure visible backdrop
        },
          React.createElement('div', { 
            className: 'bg-gray-800 rounded-lg w-full max-w-[95vw] sm:max-w-4xl mx-2 sm:mx-4 max-h-[95vh] sm:max-h-[90vh] flex flex-col border-2 border-gray-600',
            onClick: (e) => e.stopPropagation(),
            style: { 
              backgroundColor: '#1f2937', 
              minHeight: '500px'
            }
          },
            // Header - Mobile Responsive
            React.createElement('div', { className: 'flex flex-col sm:flex-row justify-between items-start sm:items-center p-4 sm:p-6 border-b border-gray-700 gap-3 sm:gap-0' },
              React.createElement('div', { className: 'flex-1 min-w-0' },
                React.createElement('h2', { className: 'text-lg sm:text-2xl font-bold flex items-center' }, 
                  React.createElement('span', { className: 'mr-2 sm:mr-3' }, '🎯'),
                  React.createElement('span', { className: 'truncate' },
                    // Mobile: Show just name, Desktop: Show full title
                    window.innerWidth < 640 
                      ? `${client.firstName || client.first_name || 'Unknown'} ${client.lastName || client.last_name || 'Client'}`
                      : `360° Client View - ${client.firstName || client.first_name || 'Unknown'} ${client.lastName || client.last_name || 'Client'}`
                  )
                )
              ),
              React.createElement('div', { className: 'flex items-center space-x-2 sm:space-x-3 flex-shrink-0' },
                !isEditing && React.createElement('button', {
                  onClick: () => setIsEditing(true),
                  className: 'bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 flex items-center space-x-2'
                }, 
                  React.createElement('span', null, '✏️'),
                  React.createElement('span', null, 'Edit')
                ),
                !isEditing && React.createElement('button', {
                  onClick: () => setShowDeleteConfirm(true),
                  className: 'bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 flex items-center space-x-2'
                }, 
                  React.createElement('span', null, '🗑️'),
                  React.createElement('span', null, 'Delete')
                ),
                React.createElement('button', {
                  onClick: onClose,
                  className: 'text-gray-400 hover:text-white text-2xl'
                }, '×')
              )
            ),

            // Tab Navigation - Mobile Responsive
            React.createElement('div', { className: 'flex border-b border-gray-700 overflow-x-auto' },
              tabs.map(tab =>
                React.createElement('button', {
                  key: tab.id,
                  onClick: () => setActiveTab(tab.id),
                  className: `px-3 sm:px-6 py-3 sm:py-4 font-semibold transition-colors flex items-center space-x-1 sm:space-x-2 flex-shrink-0 text-sm sm:text-base ${
                    activeTab === tab.id 
                      ? 'text-blue-400 border-b-2 border-blue-400 bg-gray-700' 
                      : 'text-gray-400 hover:text-white hover:bg-gray-700'
                  }`
                }, 
                  React.createElement('span', null, tab.icon),
                  React.createElement('span', { className: 'hidden sm:inline' }, tab.label),
                  // Mobile: Show shortened labels
                  React.createElement('span', { className: 'sm:hidden' }, 
                    tab.id === 'overview' ? 'Info' :
                    tab.id === 'properties' ? 'Props' :
                    tab.id === 'tasks' ? 'Tasks' :
                    tab.id === 'activity' ? 'Activity' : tab.label
                  )
                )
              )
            ),

            // Tab Content with Fallback Protection - Mobile Responsive
            React.createElement('div', { className: 'flex-1 overflow-y-auto p-3 sm:p-6 bg-gray-800' },
              // Always render something to prevent black screen
              React.createElement('div', { className: 'min-h-full' },
                (function() {
                  console.log('🔄 Rendering tab content for:', activeTab);
                  try {
                    let content = null;
                    if (activeTab === 'overview') {
                      content = renderOverviewTab();
                      console.log('✅ Overview tab rendered:', !!content);
                    } else if (activeTab === 'properties') {
                      content = renderPropertiesTab();
                      console.log('✅ Properties tab rendered:', !!content);
                    } else if (activeTab === 'tasks') {
                      content = renderTasksTab();
                      console.log('✅ Tasks tab rendered:', !!content);
                    } else if (activeTab === 'activity') {
                      content = renderActivityTab();
                      console.log('✅ Activity tab rendered:', !!content);
                    }
                    
                    // Fallback if no content or content is falsy
                    if (!content) {
                      console.log('⚠️ No content rendered, using fallback for tab:', activeTab);
                      return React.createElement('div', { className: 'text-center py-12' },
                        React.createElement('div', { className: 'text-6xl mb-4' }, '⚙️'),
                        React.createElement('h3', { className: 'text-xl font-semibold mb-2 text-white' }, 'Loading Content...'),
                        React.createElement('p', { className: 'text-gray-400' }, `Tab: ${activeTab}`),
                        React.createElement('p', { className: 'text-gray-400 mt-2' }, 'If this persists, there may be a rendering issue.')
                      );
                    }
                    
                    return content;
                  } catch (error) {
                    console.error('❌ Error rendering tab content:', error);
                    return React.createElement('div', { className: 'text-center py-12 bg-red-900 bg-opacity-20 rounded' },
                      React.createElement('div', { className: 'text-6xl mb-4' }, '⚠️'),
                      React.createElement('h3', { className: 'text-xl font-semibold mb-2 text-red-400' }, 'Rendering Error'),
                      React.createElement('p', { className: 'text-gray-300' }, `Failed to render ${activeTab} tab`),
                      React.createElement('p', { className: 'text-sm text-gray-400 mt-2' }, error.message || 'Unknown error')
                    );
                  }
                })()
              )
            ),

            // Advanced Call Log Modal
            showAdvancedCallLog && React.createElement(AdvancedCallLogModal, {
              callData: showAdvancedCallLog,
              callDuration: callDuration,
              onEndCall: handleEndCall,
              onClose: () => {
                setActiveCall(null);
                setCallStartTime(null);
                setCallDuration(0);
                setShowAdvancedCallLog(null);
              }
            }),

            // Voice Task Modal (within client detail)
            showVoiceTaskModal && React.createElement(VoiceTaskModal, {
              taskData: taskFormData,
              onClose: () => setShowVoiceTaskModal(false),
              onSave: saveTask,
              clients: clients || []
            })
          )
        );
      }

      // Call Log Modal Component
      function CallLogModal({ client, onClose, onLog }) {
        const [duration, setDuration] = useState('');
        const [notes, setNotes] = useState('');
        const [outcome, setOutcome] = useState('');
        const [followUp, setFollowUp] = useState(false);

        const handleSubmit = (e) => {
          e.preventDefault();
          onLog(client.id, { duration, notes, outcome, followUp });
        };

        return React.createElement('div', { 
          className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50',
          onClick: onClose
        },
          React.createElement('div', { 
            className: 'bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4',
            onClick: (e) => e.stopPropagation()
          },
            React.createElement('h2', { className: 'text-xl font-bold mb-4' }, 
              `Log Call - ${client.firstName} ${client.lastName}`
            ),
            
            React.createElement('form', { onSubmit: handleSubmit, className: 'space-y-4' },
              React.createElement('input', {
                type: 'number',
                placeholder: 'Call duration (minutes)',
                value: duration,
                onChange: (e) => setDuration(e.target.value),
                className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white',
                required: true
              }),
              React.createElement('select', {
                value: outcome,
                onChange: (e) => setOutcome(e.target.value),
                className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white',
                required: true
              },
                React.createElement('option', { value: '' }, 'Select outcome'),
                React.createElement('option', { value: 'Connected' }, 'Connected'),
                React.createElement('option', { value: 'Voicemail' }, 'Voicemail'),
                React.createElement('option', { value: 'No Answer' }, 'No Answer'),
                React.createElement('option', { value: 'Busy' }, 'Busy')
              ),
              React.createElement('textarea', {
                placeholder: 'Call notes...',
                value: notes,
                onChange: (e) => setNotes(e.target.value),
                rows: 3,
                className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white'
              }),
              React.createElement('label', { className: 'flex items-center space-x-2' },
                React.createElement('input', {
                  type: 'checkbox',
                  checked: followUp,
                  onChange: (e) => setFollowUp(e.target.checked),
                  className: 'rounded'
                }),
                React.createElement('span', null, 'Schedule follow-up')
              ),
              React.createElement('div', { className: 'flex space-x-3' },
                React.createElement('button', {
                  type: 'submit',
                  className: 'flex-1 bg-blue-600 text-white p-3 rounded hover:bg-blue-700'
                }, 'Log Call'),
                React.createElement('button', {
                  type: 'button',
                  onClick: onClose,
                  className: 'flex-1 bg-gray-600 text-white p-3 rounded hover:bg-gray-700'
                }, 'Cancel')
              )
            )
          )
        );
      }

      // Add Client Modal Component
      function AddClientModal({ onClose, onAdd }) {
        const [formData, setFormData] = useState({
          firstName: '',
          lastName: '',
          email: '',
          phone: '',
          address: '',
          birthday: '',
          anniversary: '',
          spouse: '',
          children: '',
          notes: '',
          tags: '',
          propertyStreetAddress: '',
          propertyCity: '',
          propertyState: '',
          propertyZipCode: ''
        });

        const handleSubmit = (e) => {
          e.preventDefault();
          
          // Create property interest object if any property fields are filled
          const hasPropertyData = formData.propertyStreetAddress || formData.propertyCity || formData.propertyState || formData.propertyZipCode;
          const propertyInterest = hasPropertyData ? [{
            id: `property-${Date.now()}`,
            address: `${formData.propertyStreetAddress || ''} ${formData.propertyCity || ''}, ${formData.propertyState || ''} ${formData.propertyZipCode || ''}`.trim().replace(/,\s*$/, ''),
            streetAddress: formData.propertyStreetAddress || '',
            city: formData.propertyCity || '',
            state: formData.propertyState || '',
            zipCode: formData.propertyZipCode || '',
            createdAt: new Date().toISOString(),
            status: 'Interested'
          }] : [];
          
          onAdd({
            ...formData,
            tags: formData.tags.split(',').map(tag => tag.trim()).filter(tag => tag),
            propertiesOfInterest: propertyInterest
          });
        };

        const handleChange = (field, value) => {
          setFormData(prev => ({ ...prev, [field]: value }));
        };

        return React.createElement('div', { 
          className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50',
          onClick: onClose
        },
          React.createElement('div', { 
            className: 'bg-gray-800 rounded-lg p-6 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto',
            onClick: (e) => e.stopPropagation()
          },
            React.createElement('h2', { className: 'text-xl font-bold mb-4' }, 'Add New Client'),
            
            React.createElement('form', { onSubmit: handleSubmit, className: 'space-y-6' },
              
              // Basic Information Section
              React.createElement('div', { className: 'bg-slate-700/50 rounded-lg p-6 border border-slate-600' },
                React.createElement('div', { className: 'flex items-center mb-6' },
                  React.createElement('span', { className: 'text-2xl mr-3' }, '📋'),
                  React.createElement('h3', { className: 'text-xl font-semibold text-green-400' }, 'Basic Information')
                ),
                React.createElement('div', { className: 'space-y-4' },
                  React.createElement('div', { className: 'grid grid-cols-2 gap-4' },
                    React.createElement('input', {
                      type: 'text',
                      placeholder: 'First Name *',
                      value: formData.firstName,
                      onChange: (e) => handleChange('firstName', e.target.value),
                      className: 'p-4 bg-slate-600 rounded-lg border border-slate-500 text-white placeholder-slate-300 focus:border-green-400 focus:outline-none transition-colors',
                      required: true
                    }),
                    React.createElement('input', {
                      type: 'text',
                      placeholder: 'Last Name *',
                      value: formData.lastName,
                      onChange: (e) => handleChange('lastName', e.target.value),
                      className: 'p-4 bg-slate-600 rounded-lg border border-slate-500 text-white placeholder-slate-300 focus:border-green-400 focus:outline-none transition-colors',
                      required: true
                    })
                  ),
                  React.createElement('div', { className: 'grid grid-cols-2 gap-4' },
                    React.createElement('input', {
                      type: 'email',
                      placeholder: 'Email Address *',
                      value: formData.email,
                      onChange: (e) => handleChange('email', e.target.value),
                      className: 'p-4 bg-slate-600 rounded-lg border border-slate-500 text-white placeholder-slate-300 focus:border-green-400 focus:outline-none transition-colors',
                      required: true
                    }),
                    React.createElement('input', {
                      type: 'tel',
                      placeholder: 'Phone Number',
                      value: formData.phone,
                      onChange: (e) => handleChange('phone', e.target.value),
                      className: 'p-4 bg-slate-600 rounded-lg border border-slate-500 text-white placeholder-slate-300 focus:border-green-400 focus:outline-none transition-colors'
                    })
                  )
                )
              ),
              
              // Current Address Section
              React.createElement('div', { className: 'bg-slate-700/50 rounded-lg p-6 border border-slate-600' },
                React.createElement('div', { className: 'flex items-center mb-6' },
                  React.createElement('span', { className: 'text-2xl mr-3' }, '🏠'),
                  React.createElement('h3', { className: 'text-xl font-semibold text-blue-400' }, 'Current Address')
                ),
                React.createElement('div', { className: 'space-y-4' },
                  React.createElement('div', { className: 'grid grid-cols-3 gap-4' },
                    React.createElement('select', {
                      value: formData.country || 'United States',
                      onChange: (e) => handleChange('country', e.target.value),
                      className: 'p-4 bg-slate-600 rounded-lg border border-slate-500 text-white focus:border-blue-400 focus:outline-none transition-colors'
                    },
                      React.createElement('option', { value: 'United States' }, 'United States'),
                      React.createElement('option', { value: 'Canada' }, 'Canada'),
                      React.createElement('option', { value: 'Other' }, 'Other')
                    ),
                    React.createElement('input', {
                      type: 'text',
                      placeholder: 'Street Address',
                      value: formData.address,
                      onChange: (e) => handleChange('address', e.target.value),
                      className: 'col-span-2 p-4 bg-slate-600 rounded-lg border border-slate-500 text-white placeholder-slate-300 focus:border-blue-400 focus:outline-none transition-colors'
                    })
                  ),
                  React.createElement('div', { className: 'grid grid-cols-3 gap-4' },
                    React.createElement('input', {
                      type: 'text',
                      placeholder: 'City',
                      value: formData.city,
                      onChange: (e) => handleChange('city', e.target.value),
                      className: 'p-4 bg-slate-600 rounded-lg border border-slate-500 text-white placeholder-slate-300 focus:border-blue-400 focus:outline-none transition-colors'
                    }),
                    React.createElement('input', {
                      type: 'text',
                      placeholder: 'State/Province',
                      value: formData.state,
                      onChange: (e) => handleChange('state', e.target.value),
                      className: 'p-4 bg-slate-600 rounded-lg border border-slate-500 text-white placeholder-slate-300 focus:border-blue-400 focus:outline-none transition-colors'
                    }),
                    React.createElement('input', {
                      type: 'text',
                      placeholder: 'Zip/Postal Code',
                      value: formData.zipCode,
                      onChange: (e) => handleChange('zipCode', e.target.value),
                      className: 'p-4 bg-slate-600 rounded-lg border border-slate-500 text-white placeholder-slate-300 focus:border-blue-400 focus:outline-none transition-colors'
                    })
                  )
                )
              ),
              
              // Personal Information Section
              React.createElement('div', { className: 'bg-slate-700/50 rounded-lg p-6 border border-slate-600' },
                React.createElement('div', { className: 'flex items-center mb-6' },
                  React.createElement('span', { className: 'text-2xl mr-3' }, '👨‍👩‍👧‍👦'),
                  React.createElement('h3', { className: 'text-xl font-semibold text-yellow-400' }, 'Personal Information')
                ),
                React.createElement('div', { className: 'space-y-4' },
                  React.createElement('div', { className: 'grid grid-cols-3 gap-4' },
                    React.createElement('div', { className: 'space-y-2' },
                      React.createElement('label', { className: 'block text-sm font-medium text-slate-300' }, 'Birth Date'),
                      React.createElement('input', {
                        type: 'date',
                        value: formData.birthday,
                        onChange: (e) => handleChange('birthday', e.target.value),
                        className: 'w-full p-4 bg-slate-600 rounded-lg border border-slate-500 text-white focus:border-yellow-400 focus:outline-none transition-colors'
                      })
                    ),
                    React.createElement('input', {
                      type: 'text',
                      placeholder: 'Spouse/Partner Name',
                      value: formData.spouse,
                      onChange: (e) => handleChange('spouse', e.target.value),
                      className: 'p-4 bg-slate-600 rounded-lg border border-slate-500 text-white placeholder-slate-300 focus:border-yellow-400 focus:outline-none transition-colors'
                    }),
                    React.createElement('input', {
                      type: 'text',
                      placeholder: 'Children (e.g., Emma 12, Jake 8)',
                      value: formData.children,
                      onChange: (e) => handleChange('children', e.target.value),
                      className: 'p-4 bg-slate-600 rounded-lg border border-slate-500 text-white placeholder-slate-300 focus:border-yellow-400 focus:outline-none transition-colors'
                    })
                  )
                )
              ),
              
              // CRM Information Section
              React.createElement('div', { className: 'bg-slate-700/50 rounded-lg p-6 border border-slate-600' },
                React.createElement('div', { className: 'flex items-center mb-6' },
                  React.createElement('span', { className: 'text-2xl mr-3' }, '📊'),
                  React.createElement('h3', { className: 'text-xl font-semibold text-orange-400' }, 'CRM Information')
                ),
                React.createElement('div', { className: 'space-y-4' },
                  React.createElement('input', {
                    type: 'text',
                    placeholder: 'Tags (comma-separated, e.g., VIP, Luxury, First-time buyer)',
                    value: formData.tags,
                    onChange: (e) => handleChange('tags', e.target.value),
                    className: 'w-full p-4 bg-slate-600 rounded-lg border border-slate-500 text-white placeholder-slate-300 focus:border-orange-400 focus:outline-none transition-colors'
                  }),
                  React.createElement('textarea', {
                    placeholder: 'Additional Comments/Notes',
                    value: formData.notes || '',
                    onChange: (e) => handleChange('notes', e.target.value),
                    rows: 4,
                    className: 'w-full p-4 bg-slate-600 rounded-lg border border-slate-500 text-white placeholder-slate-300 focus:border-orange-400 focus:outline-none transition-colors resize-none'
                  })
                )
              ),
              
              // Property Interest Section
              React.createElement('div', { className: 'bg-slate-700 rounded-lg p-4' },
                React.createElement('div', { className: 'flex items-center justify-between mb-4' },
                  React.createElement('div', { className: 'flex items-center' },
                    React.createElement('span', { className: 'text-2xl mr-2' }, '🎯'),
                    React.createElement('h3', { className: 'text-lg font-semibold text-purple-400' }, 'Property Interest')
                  ),
                  React.createElement('button', {
                    type: 'button',
                    onClick: async () => {
                      try {
                        // Enhanced validation for complete address search
                        const hasAddress = formData.propertyStreetAddress?.trim();
                        const hasCity = formData.propertyCity?.trim();
                        const hasState = formData.propertyState?.trim();
                        const hasZip = formData.propertyZipCode?.trim();
                        
                        if (!hasAddress && !hasCity && !hasState && !hasZip) {
                          alert('⚠️ Please enter at least one address component:\n• Street Address (recommended)\n• City\n• State\n• Zip Code\n\nFor best results, enter complete address with street, city, state, and zip.');
                          return;
                        }
                        
                        // Build comprehensive search criteria
                        const searchCriteria = {};
                        
                        if (hasAddress) {
                          searchCriteria.address = formData.propertyStreetAddress.trim();
                        }
                        if (hasCity) {
                          searchCriteria.city = formData.propertyCity.trim();
                        }
                        if (hasState) {
                          searchCriteria.state = formData.propertyState.trim();
                        }
                        if (hasZip) {
                          searchCriteria.zipCode = formData.propertyZipCode.trim();
                        }
                        
                        console.log('🔍 Enhanced MLS Search with complete address criteria:', searchCriteria);
                        
                        // Show loading state
                        const button = event.target;
                        const originalText = button.textContent;
                        button.textContent = '🔄 Searching...';
                        button.disabled = true;
                        
                        try {
                          const properties = await API.bridge.searchProperties(searchCriteria);
                          console.log('🏠 Found properties with enhanced search:', properties);
                          
                          if (properties.length > 0) {
                            // Enhanced property selection with detailed information
                            let propertyOptions = properties.slice(0, 8).map((prop, index) => {
                              const sqftInfo = prop.sqft ? ` | ${prop.sqft.toLocaleString()} sqft` : '';
                              const yearInfo = prop.yearBuilt ? ` | Built ${prop.yearBuilt}` : '';
                              const matchInfo = prop.matchScore ? ` [Match: ${prop.matchScore}%]` : '';
                              
                              return `${index + 1}. ${prop.address}
   💰 $${prop.price?.toLocaleString() || 'Price N/A'}
   🏠 ${prop.bedrooms || 0}br/${prop.bathrooms || 0}ba${sqftInfo}${yearInfo}${matchInfo}
   📝 ${prop.status || 'Status Unknown'}`;
                            }).join('\\n\\n');
                            
                            alert(`🎯 Found ${properties.length} MLS properties matching your criteria!\\n\\nTop matches based on address accuracy:\\n\\n${propertyOptions}\\n\\nThese properties match your search for:\\n• Street: ${hasAddress ? formData.propertyStreetAddress : 'Not specified'}\\n• City: ${hasCity ? formData.propertyCity : 'Not specified'}\\n• State: ${hasState ? formData.propertyState : 'Not specified'}\\n• Zip: ${hasZip ? formData.propertyZipCode : 'Not specified'}`);
                            
                            const selection = prompt(`Select a property to auto-fill details:\\n\\nEnter number (1-${Math.min(8, properties.length)}) or 0 to cancel:`);
                            
                            if (selection && selection !== '0') {
                              const selectedIndex = parseInt(selection) - 1;
                              if (selectedIndex >= 0 && selectedIndex < properties.length) {
                                const selectedProperty = properties[selectedIndex];
                                
                                // Use the enhanced property data from our improved API
                                handleChange('propertyStreetAddress', selectedProperty.streetAddress || selectedProperty.address.split(',')[0]?.trim() || '');
                                handleChange('propertyCity', selectedProperty.city || '');
                                handleChange('propertyState', selectedProperty.state || '');
                                handleChange('propertyZipCode', selectedProperty.zipCode || '');
                                
                                // Auto-fill additional property details if available
                                if (selectedProperty.price) {
                                  handleChange('propertyPrice', selectedProperty.price.toString());
                                }
                                if (selectedProperty.bedrooms) {
                                  handleChange('propertyBedrooms', selectedProperty.bedrooms.toString());
                                }
                                if (selectedProperty.bathrooms) {
                                  handleChange('propertyBathrooms', selectedProperty.bathrooms.toString());
                                }
                                if (selectedProperty.sqft) {
                                  handleChange('propertySqft', selectedProperty.sqft.toString());
                                }
                                if (selectedProperty.propertyType) {
                                  handleChange('propertyType', selectedProperty.propertyType.toLowerCase());
                                }
                                if (selectedProperty.yearBuilt) {
                                  handleChange('propertyYearBuilt', selectedProperty.yearBuilt.toString());
                                }
                                
                                const matchDetails = selectedProperty.matchScore > 15 ? 
                                  '🎯 Exact Match!' : 
                                  selectedProperty.matchScore > 10 ? 
                                    '✅ Strong Match' : 
                                    '📍 Location Match';
                                
                                alert(`${matchDetails}\\n\\n✅ Auto-filled property details:\\n\\n📍 Address: ${selectedProperty.address}\\n💰 Price: $${selectedProperty.price?.toLocaleString() || 'N/A'}\\n🏠 ${selectedProperty.bedrooms || 0} bed / ${selectedProperty.bathrooms || 0} bath\\n📐 ${selectedProperty.sqft?.toLocaleString() || 'N/A'} sqft\\n📅 Built: ${selectedProperty.yearBuilt || 'Unknown'}\\n🏷️ Type: ${selectedProperty.propertyType || 'Unknown'}\\n📊 Status: ${selectedProperty.status || 'Unknown'}\\n\\nMLS ID: ${selectedProperty.mlsId || 'N/A'}${selectedProperty.agent?.name ? '\\n👤 Agent: ' + selectedProperty.agent.name : ''}`);
                              }
                            }
                          } else {
                            const searchSummary = Object.entries(searchCriteria)
                              .map(([key, value]) => `${key}: "${value}"`)
                              .join(', ');
                            
                            alert(`🔍 No exact matches found for:\\n\\n${searchSummary}\\n\\nShowing Orlando area properties instead! 🏠\\n\\nTips for exact matches:\\n• Try different street addresses\\n• Check spelling of street address\\n• Use common abbreviations (St, Ave, Dr)\\n\\n🚀 Using LIVE RapidAPI with REAL Orlando MLS data! 10,000 free searches/month.`);
                          }
                        } finally {
                          // Restore button state
                          button.textContent = originalText;
                          button.disabled = false;
                        }
                      } catch (error) {
                        console.error('Enhanced MLS Search Error:', error);
                        alert(`❌ MLS Search Error:\\n\\n${error.message || 'Unknown error occurred'}\\n\\nPlease check:\\n• Internet connection\\n• Address format\\n• Try again in a moment\\n\\nCheck browser console for technical details.`);
                      }
                    },
                    className: 'px-4 py-2 bg-purple-600 text-white text-sm rounded hover:bg-purple-700 transition-colors font-semibold flex items-center gap-2'
                  }, 
                    React.createElement('span', null, '🔍'),
                    React.createElement('span', null, 'Enhanced MLS Search')
                  )
                ),
                React.createElement('div', { className: 'mb-4' },
                  React.createElement('p', { className: 'text-gray-300 text-sm mb-3' }, 'Enter complete property address details for exact MLS matching:'),
                  React.createElement('div', { className: 'bg-blue-900/30 border border-blue-600/50 rounded-lg p-3 mb-3' },
                    React.createElement('p', { className: 'text-blue-300 text-xs font-semibold mb-2' }, '🎯 Enhanced MLS Integration Features:'),
                    React.createElement('ul', { className: 'text-blue-200 text-xs space-y-1' },
                      React.createElement('li', null, '✅ Complete address matching (Street + City + State + Zip)'),
                      React.createElement('li', null, '✅ Smart property ranking by relevance'),
                      React.createElement('li', null, '✅ Auto-fill property details from MLS data'),
                      React.createElement('li', null, '✅ Real-time Bridge API integration')
                    )
                  ),
                  React.createElement('p', { className: 'text-yellow-400 text-xs mb-2' }, '💡 For best results, enter street address + city + state + zip code.'),
                  React.createElement('p', { className: 'text-gray-400 text-xs' }, '🚀 LIVE RapidAPI integration with REAL Orlando property data! 10,000 free searches/month included.')
                ),
                React.createElement('input', {
                  type: 'text',
                  placeholder: 'Street Address',
                  value: formData.propertyStreetAddress,
                  onChange: (e) => handleChange('propertyStreetAddress', e.target.value),
                  className: 'w-full p-3 bg-slate-600 rounded border border-slate-500 text-white placeholder-gray-400 mb-4'
                }),
                React.createElement('div', { className: 'grid grid-cols-3 gap-4' },
                  React.createElement('input', {
                    type: 'text',
                    placeholder: 'City',
                    value: formData.propertyCity,
                    onChange: (e) => handleChange('propertyCity', e.target.value),
                    className: 'p-3 bg-slate-600 rounded border border-slate-500 text-white placeholder-gray-400'
                  }),
                  React.createElement('input', {
                    type: 'text',
                    placeholder: 'State/Province',
                    value: formData.propertyState,
                    onChange: (e) => handleChange('propertyState', e.target.value),
                    className: 'p-3 bg-slate-600 rounded border border-slate-500 text-white placeholder-gray-400'
                  }),
                  React.createElement('input', {
                    type: 'text',
                    placeholder: 'Zip/Postal Code',
                    value: formData.propertyZipCode,
                    onChange: (e) => handleChange('propertyZipCode', e.target.value),
                    className: 'p-3 bg-slate-600 rounded border border-slate-500 text-white placeholder-gray-400'
                  })
                )
              ),
              
              React.createElement('textarea', {
                placeholder: 'Notes',
                value: formData.notes,
                onChange: (e) => handleChange('notes', e.target.value),
                rows: 3,
                className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white'
              }),
              React.createElement('div', { className: 'flex space-x-3' },
                React.createElement('button', {
                  type: 'submit',
                  className: 'flex-1 bg-green-600 text-white p-3 rounded hover:bg-green-700'
                }, 'Add Client'),
                React.createElement('button', {
                  type: 'button',
                  onClick: onClose,
                  className: 'flex-1 bg-gray-600 text-white p-3 rounded hover:bg-gray-700'
                }, 'Cancel')
              )
            )
          )
        );
      }

      // Property Modal Component
      function PropertyModal({ client, onClose }) {
        return React.createElement('div', { 
          className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50',
          onClick: onClose
        },
          React.createElement('div', { 
            className: 'bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4',
            onClick: (e) => e.stopPropagation()
          },
            React.createElement('h2', { className: 'text-xl font-bold mb-4' }, 
              `Properties - ${client.firstName} ${client.lastName}`
            ),
            React.createElement('p', { className: 'text-gray-400 mb-4' }, 
              'Property management feature coming soon!'
            ),
            React.createElement('button', {
              onClick: onClose,
              className: 'w-full bg-gray-600 text-white p-3 rounded hover:bg-gray-700'
            }, 'Close')
          )
        );
      }

      // Advanced Call Log Modal Component
      function AdvancedCallLogModal({ callData, callDuration, onEndCall, onClose }) {
        const [outcome, setOutcome] = useState('Connected');
        const [notes, setNotes] = useState('');
        const [followUpDays, setFollowUpDays] = useState(7);
        const [callCategory, setCallCategory] = useState('general');
        const [quickNoteTemplate, setQuickNoteTemplate] = useState('');

        const formatTime = (seconds) => {
          const mins = Math.floor(seconds / 60);
          const secs = seconds % 60;
          return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        };

        const callOutcomes = [
          { value: 'Connected', label: '✅ Connected', color: 'bg-green-600' },
          { value: 'Voicemail', label: '📧 Voicemail Left', color: 'bg-blue-600' },
          { value: 'No Answer', label: '📵 No Answer', color: 'bg-yellow-600' },
          { value: 'Busy', label: '📞 Busy Line', color: 'bg-orange-600' },
          { value: 'Wrong Number', label: '❌ Wrong Number', color: 'bg-red-600' },
          { value: 'Call Back Later', label: '⏰ Call Back Later', color: 'bg-purple-600' },
          { value: 'Not Interested', label: '🚫 Not Interested', color: 'bg-gray-600' },
          { value: 'Appointment Set', label: '📅 Appointment Set', color: 'bg-indigo-600' }
        ];

        const quickNotes = [
          'Discussed property options and budget',
          'Scheduled property viewing',
          'Provided market update and pricing',
          'Followed up on previous inquiry',
          'Discussed financing options',
          'Answered questions about the area',
          'Set appointment for next week',
          'Will call back with more information'
        ];

        const handleSubmit = () => {
          const finalNotes = notes || quickNoteTemplate || `Called ${callData?.phoneNumber}`;
          console.log('📞 AdvancedCallLogModal handleSubmit called');
          console.log('📞 Call data:', callData);
          console.log('📞 Outcome:', outcome);
          console.log('📞 Notes:', finalNotes);
          console.log('📞 Follow-up days:', followUpDays);
          console.log('📞 Category:', callCategory);
          
          onEndCall(outcome, finalNotes, followUpDays, callCategory);
          onClose();
        };

        if (!callData) return null;

        return React.createElement('div', { 
          className: 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4',
          onClick: onClose
        },
          React.createElement('div', { 
            className: 'bg-gray-800 rounded-lg max-w-2xl w-full max-h-96 overflow-y-auto',
            onClick: (e) => e.stopPropagation()
          },
            // Header with Live Timer
            React.createElement('div', { className: 'bg-gradient-to-r from-green-600 to-blue-600 p-6 rounded-t-lg text-white' },
              React.createElement('div', { className: 'flex justify-between items-center' },
                React.createElement('div', null,
                  React.createElement('h3', { className: 'text-xl font-bold' }, '📞 Active Call'),
                  React.createElement('p', { className: 'text-sm opacity-90' }, 
                    `${callData.clientName} • ${callData.phoneNumber}`
                  )
                ),
                React.createElement('div', { className: 'text-right' },
                  React.createElement('div', { className: 'text-3xl font-mono font-bold animate-pulse' }, 
                    formatTime(callDuration)
                  ),
                  React.createElement('div', { className: 'text-xs opacity-75' }, 'Duration')
                )
              )
            ),

            React.createElement('div', { className: 'p-6 space-y-6' },
              // Call Outcome Selection
              React.createElement('div', null,
                React.createElement('label', { className: 'block text-sm font-medium text-gray-300 mb-3' }, 'Call Outcome *'),
                React.createElement('div', { className: 'grid grid-cols-2 gap-3' },
                  callOutcomes.map(outcomeOption =>
                    React.createElement('button', {
                      key: outcomeOption.value,
                      type: 'button',
                      onClick: () => setOutcome(outcomeOption.value),
                      className: `p-3 rounded-lg border-2 transition-all text-left ${
                        outcome === outcomeOption.value
                          ? `${outcomeOption.color} border-white text-white`
                          : 'bg-gray-700 border-gray-600 text-gray-300 hover:bg-gray-600'
                      }`
                    },
                      React.createElement('div', { className: 'font-semibold text-sm' }, outcomeOption.label)
                    )
                  )
                )
              ),

              // Quick Notes Templates
              React.createElement('div', null,
                React.createElement('label', { className: 'block text-sm font-medium text-gray-300 mb-2' }, 'Quick Notes (Optional)'),
                React.createElement('div', { className: 'grid grid-cols-1 gap-2 mb-3' },
                  quickNotes.slice(0, 4).map((note, index) =>
                    React.createElement('button', {
                      key: index,
                      type: 'button',
                      onClick: () => setQuickNoteTemplate(note),
                      className: `p-2 text-left text-sm rounded bg-gray-700 hover:bg-gray-600 border ${
                        quickNoteTemplate === note ? 'border-blue-500 bg-blue-900' : 'border-gray-600'
                      }`
                    }, note)
                  )
                )
              ),

              // Custom Notes
              React.createElement('div', null,
                React.createElement('label', { className: 'block text-sm font-medium text-gray-300 mb-2' }, 'Custom Notes'),
                React.createElement('textarea', {
                  value: notes,
                  onChange: (e) => setNotes(e.target.value),
                  placeholder: 'Add detailed notes about this call...',
                  rows: 3,
                  className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white placeholder-gray-400'
                })
              ),

              // Follow-up and Category
              React.createElement('div', { className: 'grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4' },
                React.createElement('div', null,
                  React.createElement('label', { className: 'block text-sm font-medium text-gray-300 mb-2' }, 'Follow-up'),
                  React.createElement('select', {
                    value: followUpDays,
                    onChange: (e) => setFollowUpDays(parseInt(e.target.value)),
                    className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white'
                  },
                    React.createElement('option', { value: 0 }, 'No follow-up'),
                    React.createElement('option', { value: 1 }, 'Tomorrow'),
                    React.createElement('option', { value: 3 }, 'In 3 days'),
                    React.createElement('option', { value: 7 }, 'In 1 week'),
                    React.createElement('option', { value: 14 }, 'In 2 weeks'),
                    React.createElement('option', { value: 30 }, 'In 1 month')
                  )
                ),
                React.createElement('div', null,
                  React.createElement('label', { className: 'block text-sm font-medium text-gray-300 mb-2' }, 'Category'),
                  React.createElement('select', {
                    value: callCategory,
                    onChange: (e) => setCallCategory(e.target.value),
                    className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white'
                  },
                    React.createElement('option', { value: 'general' }, 'General'),
                    React.createElement('option', { value: 'prospecting' }, 'Prospecting'),
                    React.createElement('option', { value: 'follow_up' }, 'Follow-up'),
                    React.createElement('option', { value: 'appointment' }, 'Appointment'),
                    React.createElement('option', { value: 'closing' }, 'Closing'),
                    React.createElement('option', { value: 'service' }, 'Service')
                  )
                )
              )
            ),

            // Action Buttons
            React.createElement('div', { className: 'bg-gray-700 px-6 py-4 rounded-b-lg flex space-x-3' },
              React.createElement('button', {
                onClick: handleSubmit,
                className: 'flex-1 bg-green-600 text-white py-3 px-4 rounded-lg hover:bg-green-700 transition-colors font-semibold'
              }, '✅ End Call & Log'),
              React.createElement('button', {
                onClick: onClose,
                className: 'flex-1 bg-gray-600 text-white py-3 px-4 rounded-lg hover:bg-gray-500 transition-colors'
              }, '❌ Cancel')
            )
          )
        );
      }

      // General Tasks View Component
      function GeneralTasksView({ generalTasks, clients, assignTaskToClient, setGeneralTasks, startVoiceTaskCreation, isListeningForTask, setVoiceStatus }) {
        const [selectedTaskForAssignment, setSelectedTaskForAssignment] = useState(null);
        
        const handleCompleteTask = (taskId) => {
          setGeneralTasks(prevTasks => 
            prevTasks.map(task => 
              task.id === taskId 
                ? { ...task, completed: !task.completed, completedAt: new Date().toISOString() }
                : task
            )
          );
        };
        
        const handleDeleteTask = (taskId) => {
          if (confirm('Are you sure you want to delete this task?')) {
            setGeneralTasks(prevTasks => prevTasks.filter(task => task.id !== taskId));
          }
        };
        
        const tasksByStatus = {
          pending: generalTasks.filter(task => !task.completed),
          completed: generalTasks.filter(task => task.completed)
        };
        
        return React.createElement('div', null,
          React.createElement('div', { className: 'flex justify-between items-center mb-6' },
            React.createElement('div', null,
              React.createElement('h2', { className: 'text-3xl font-bold mb-1' }, 'General Tasks'),
              React.createElement('p', { className: 'text-gray-400' }, 
                `${tasksByStatus.pending.length} pending tasks • ${tasksByStatus.completed.length} completed • Ready for client assignment`
              )
            ),
            React.createElement('div', { className: 'flex space-x-3' },
              React.createElement('button', {
                onClick: startVoiceTaskCreation,
                disabled: isListeningForTask,
                className: `px-4 py-2 rounded transition-colors ${
                  isListeningForTask 
                    ? 'bg-orange-600 text-white cursor-not-allowed animate-pulse' 
                    : 'bg-purple-600 text-white hover:bg-purple-700'
                }`
              }, isListeningForTask ? '🎤 Listening...' : '📝 Voice Task')
            )
          ),
          
          // Pending Tasks Section
          React.createElement('div', { className: 'mb-8' },
            React.createElement('h3', { className: 'text-xl font-semibold mb-4 text-yellow-400' }, 
              `⏳ Pending Tasks (${tasksByStatus.pending.length})`
            ),
            tasksByStatus.pending.length === 0 ? 
              React.createElement('div', { className: 'bg-gray-800 p-8 rounded-lg text-center text-gray-400' },
                React.createElement('div', { className: 'text-4xl mb-4' }, '📝'),
                React.createElement('h4', { className: 'text-lg font-semibold mb-2' }, 'No pending tasks'),
                React.createElement('p', null, 'Use Voice Task to create new tasks or assign existing ones to clients')
              ) :
              React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4' },
                tasksByStatus.pending.map(task =>
                  React.createElement('div', { 
                    key: task.id, 
                    className: 'bg-gray-800 p-4 rounded-lg border-l-4 border-yellow-500'
                  },
                    React.createElement('div', { className: 'flex justify-between items-start mb-3' },
                      React.createElement('div', { className: 'flex-1' },
                        React.createElement('h4', { className: 'font-semibold text-white mb-1' }, task.title),
                        
                        // Show task description/notes if available
                        (task.description || task.notes) && React.createElement('p', { 
                          className: 'text-sm text-gray-300 mb-2 leading-relaxed' 
                        }, task.description && task.description.startsWith('Voice-created task: ') 
                            ? task.description.replace('Voice-created task: ', '🎤 ') 
                            : task.description || task.notes),
                        
                        React.createElement('div', { className: 'flex items-center space-x-2 mb-2' },
                          React.createElement('span', {
                            className: `px-2 py-1 rounded text-xs ${
                              task.type === 'showing' ? 'bg-blue-600' :
                              task.type === 'follow_up' ? 'bg-green-600' :
                              task.type === 'listing' ? 'bg-purple-600' :
                              task.type === 'documentation' ? 'bg-yellow-600' :
                              task.type === 'appointment' ? 'bg-indigo-600' :
                              task.type === 'marketing' ? 'bg-pink-600' : 'bg-gray-600'
                            }`
                          }, 
                            task.type === 'showing' ? '🏠 Showing' :
                            task.type === 'follow_up' ? '📞 Follow-up' :
                            task.type === 'listing' ? '📝 Listing' :
                            task.type === 'documentation' ? '📋 Documents' :
                            task.type === 'appointment' ? '📅 Appointment' :
                            task.type === 'marketing' ? '📸 Marketing' : '⚡ General'
                          ),
                          React.createElement('span', { 
                            className: `px-2 py-1 rounded text-xs ${
                              task.priority === 'high' ? 'bg-red-600' :
                              task.priority === 'medium' ? 'bg-yellow-600' : 'bg-green-600'
                            }`
                          }, 
                            task.priority === 'high' ? '🔴 High' :
                            task.priority === 'medium' ? '🟡 Medium' : '🟢 Low'
                          )
                        ),
                        task.dueDate && React.createElement('p', { className: 'text-xs text-gray-400 mb-2' },
                          `📅 Due: ${new Date(task.dueDate).toLocaleDateString()}${task.time ? ` at ${task.time}` : ''}`
                        ),
                        task.mentionedName && React.createElement('p', { className: 'text-xs text-yellow-400 mb-2 bg-yellow-900 bg-opacity-30 p-2 rounded' }, 
                          `🔍 Mentioned: "${task.mentionedName}" (not found in clients)`
                        )
                      )
                    ),
                    
                    React.createElement('div', { className: 'flex flex-col space-y-2' },
                      // Assign to Client Dropdown
                      React.createElement('select', {
                        value: selectedTaskForAssignment === task.id ? 'assigning' : '',
                        onChange: (e) => {
                          if (e.target.value && e.target.value !== 'assigning') {
                            assignTaskToClient(task.id, e.target.value);
                          }
                        },
                        className: 'w-full p-2 bg-gray-700 rounded border border-gray-600 text-white text-sm'
                      },
                        React.createElement('option', { value: '' }, '👤 Assign to Client...'),
                        clients.map(client =>
                          React.createElement('option', { key: client.id, value: client.id }, 
                            `${client.firstName || client.first_name} ${client.lastName || client.last_name}`
                          )
                        )
                      ),
                      
                      // Action Buttons
                      React.createElement('div', { className: 'flex space-x-2' },
                        React.createElement('button', {
                          onClick: () => handleCompleteTask(task.id),
                          className: 'flex-1 bg-green-600 text-white py-1 px-2 rounded hover:bg-green-700 text-xs'
                        }, '✓ Complete'),
                        React.createElement('button', {
                          onClick: () => handleDeleteTask(task.id),
                          className: 'flex-1 bg-red-600 text-white py-1 px-2 rounded hover:bg-red-700 text-xs'
                        }, '🗑️ Delete')
                      )
                    )
                  )
                )
              )
          ),
          
          // Completed Tasks Section
          tasksByStatus.completed.length > 0 && React.createElement('div', null,
            React.createElement('h3', { className: 'text-xl font-semibold mb-4 text-green-400' }, 
              `✅ Completed Tasks (${tasksByStatus.completed.length})`
            ),
            React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4' },
              tasksByStatus.completed.map(task =>
                React.createElement('div', { 
                  key: task.id, 
                  className: 'bg-gray-800 p-4 rounded-lg border-l-4 border-green-500 opacity-75'
                },
                  React.createElement('div', { className: 'flex justify-between items-start' },
                    React.createElement('div', { className: 'flex-1' },
                      React.createElement('h4', { className: 'font-semibold text-white line-through mb-1' }, task.title),
                      React.createElement('p', { className: 'text-xs text-gray-400' }, 
                        `✅ Completed: ${task.completedAt ? new Date(task.completedAt).toLocaleDateString() : 'Recently'}`
                      )
                    ),
                    React.createElement('button', {
                      onClick: () => handleCompleteTask(task.id),
                      className: 'text-gray-400 hover:text-white text-sm'
                    }, '↩️ Undo')
                  )
                )
              )
            )
          )
        );
      }

      // Voice Task Modal Component
      function VoiceTaskModal({ taskData, onClose, onSave, clients }) {
        const [formData, setFormData] = useState(taskData || {});
        
        React.useEffect(() => {
          setFormData(taskData || {});
        }, [taskData]);
        
        const handleChange = (field, value) => {
          setFormData(prev => ({ ...prev, [field]: value }));
        };
        
        const handleSubmit = (e) => {
          e.preventDefault();
          onSave(formData);
        };
        
        const taskTypes = [
          { value: 'showing', label: '🏠 Property Showing', color: 'bg-blue-600' },
          { value: 'follow_up', label: '📞 Follow-up Call', color: 'bg-green-600' },
          { value: 'listing', label: '📝 Listing Task', color: 'bg-purple-600' },
          { value: 'documentation', label: '📋 Documentation', color: 'bg-yellow-600' },
          { value: 'appointment', label: '📅 Appointment', color: 'bg-indigo-600' },
          { value: 'marketing', label: '📸 Marketing', color: 'bg-pink-600' },
          { value: 'general', label: '⚡ General Task', color: 'bg-gray-600' }
        ];
        
        const priorityLevels = [
          { value: 'low', label: '🟢 Low Priority', color: 'text-green-400' },
          { value: 'medium', label: '🟡 Medium Priority', color: 'text-yellow-400' },
          { value: 'high', label: '🔴 High Priority', color: 'text-red-400' }
        ];
        
        return React.createElement('div', { 
          className: 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4',
          onClick: onClose
        },
          React.createElement('div', { 
            className: 'bg-gray-800 rounded-lg max-w-2xl w-full max-h-96 overflow-y-auto',
            onClick: (e) => e.stopPropagation()
          },
            // Header
            React.createElement('div', { className: 'bg-gradient-to-r from-purple-600 to-blue-600 p-6 rounded-t-lg text-white' },
              React.createElement('div', { className: 'flex justify-between items-center' },
                React.createElement('div', null,
                  React.createElement('h3', { className: 'text-xl font-bold' }, 
                    formData.isEditing ? '✏️ Edit Task' : '📝 Voice Task Creator'
                  ),
                  React.createElement('p', { className: 'text-sm opacity-90' }, 
                    formData.isEditing 
                      ? 'Modify task details and settings'
                      : 'Review and customize your voice-created task'
                  )
                ),
                React.createElement('button', {
                  onClick: onClose,
                  className: 'text-white hover:text-gray-300 text-2xl'
                }, '×')
              )
            ),
            
            React.createElement('form', { onSubmit: handleSubmit, className: 'p-6 space-y-6' },
              // Original Voice Command Display
              taskData.description && taskData.description.startsWith('Voice-created task:') &&
              React.createElement('div', { className: 'bg-blue-900 bg-opacity-50 p-4 rounded-lg border-l-4 border-blue-500' },
                React.createElement('h4', { className: 'text-sm font-semibold text-blue-300 mb-2' }, '🎤 Voice Command'),
                React.createElement('p', { className: 'text-sm text-blue-100' }, 
                  taskData.description.replace('Voice-created task: ', '')
                )
              ),
              
              // Task Title
              React.createElement('div', null,
                React.createElement('label', { className: 'block text-sm font-medium text-gray-300 mb-2' }, 'Task Title *'),
                React.createElement('input', {
                  type: 'text',
                  value: formData.title || '',
                  onChange: (e) => handleChange('title', e.target.value),
                  placeholder: 'Enter task title...',
                  className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white placeholder-gray-400',
                  required: true
                })
              ),
              
              // Task Type and Priority
              React.createElement('div', { className: 'grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4' },
                React.createElement('div', null,
                  React.createElement('label', { className: 'block text-sm font-medium text-gray-300 mb-2' }, 'Task Type'),
                  React.createElement('select', {
                    value: formData.type || 'general',
                    onChange: (e) => handleChange('type', e.target.value),
                    className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white'
                  },
                    taskTypes.map(type =>
                      React.createElement('option', { key: type.value, value: type.value }, type.label)
                    )
                  )
                ),
                React.createElement('div', null,
                  React.createElement('label', { className: 'block text-sm font-medium text-gray-300 mb-2' }, 'Priority'),
                  React.createElement('select', {
                    value: formData.priority || 'medium',
                    onChange: (e) => handleChange('priority', e.target.value),
                    className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white'
                  },
                    priorityLevels.map(priority =>
                      React.createElement('option', { key: priority.value, value: priority.value }, priority.label)
                    )
                  )
                )
              ),
              
              // Client Assignment
              React.createElement('div', null,
                React.createElement('label', { className: 'block text-sm font-medium text-gray-300 mb-2' }, 'Assign to Client'),
                React.createElement('select', {
                  value: formData.clientId || '',
                  onChange: (e) => {
                    const selectedClient = clients.find(c => c.id === e.target.value);
                    handleChange('clientId', e.target.value);
                    handleChange('clientName', selectedClient ? `${selectedClient.firstName} ${selectedClient.lastName}` : '');
                  },
                  className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white'
                },
                  React.createElement('option', { value: '' }, 'Select a client (optional)'),
                  clients.map(client =>
                    React.createElement('option', { key: client.id, value: client.id }, 
                      `${client.firstName || client.first_name} ${client.lastName || client.last_name}`
                    )
                  )
                )
              ),
              
              // Due Date and Time
              React.createElement('div', { className: 'grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4' },
                React.createElement('div', null,
                  React.createElement('label', { className: 'block text-sm font-medium text-gray-300 mb-2' }, 'Due Date'),
                  React.createElement('input', {
                    type: 'date',
                    value: formData.dueDate || '',
                    onChange: (e) => handleChange('dueDate', e.target.value),
                    className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white'
                  })
                ),
                React.createElement('div', null,
                  React.createElement('label', { className: 'block text-sm font-medium text-gray-300 mb-2' }, 'Time (Optional)'),
                  React.createElement('input', {
                    type: 'time',
                    value: formData.time || '',
                    onChange: (e) => handleChange('time', e.target.value),
                    className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white'
                  })
                )
              ),
              
              // Description
              React.createElement('div', null,
                React.createElement('label', { className: 'block text-sm font-medium text-gray-300 mb-2' }, 'Additional Notes'),
                React.createElement('textarea', {
                  value: formData.notes || '',
                  onChange: (e) => handleChange('notes', e.target.value),
                  placeholder: 'Add any additional details or notes...',
                  rows: 3,
                  className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white placeholder-gray-400'
                })
              ),
              
              // Action Buttons
              React.createElement('div', { className: 'flex space-x-3 pt-4 border-t border-gray-700' },
                React.createElement('button', {
                  type: 'submit',
                  className: 'flex-1 bg-green-600 text-white py-3 px-4 rounded-lg hover:bg-green-700 transition-colors font-semibold'
                }, formData.isEditing ? '✅ Update Task' : '✅ Create Task'),
                React.createElement('button', {
                  type: 'button',
                  onClick: onClose,
                  className: 'flex-1 bg-gray-600 text-white py-3 px-4 rounded-lg hover:bg-gray-500 transition-colors'
                }, '❌ Cancel')
              )
            )
          )
        );
      }

      // Render the app - Using React 17 API for compatibility
      ReactDOM.render(React.createElement(NetflixCRM), document.getElementById('root'));
    </script>
  </body>
</html>