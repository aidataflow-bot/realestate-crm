<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CLIENT FLOW 360 - Netflix Style Real Estate CRM with Database v2.1</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body { 
        margin: 0; 
        padding: 0; 
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif; 
        background: #111827; 
        color: white; 
      }
      #root { min-height: 100vh; }
      
      /* Netflix-style animations and effects */
      .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }
      
      /* Smooth transitions for tile effects */
      .group:hover .group-hover\:scale-110 {
        transform: scale(1.1);
      }
      
      /* Enhanced hover effects */
      .tile-hover {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }
      
      .tile-hover:hover {
        transform: scale(1.05);
        z-index: 10;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="module">
      // Complete Netflix-style CRM with CLIENT FLOW 360 branding + Database Integration
      const { useState, useEffect, useCallback } = React;
      
      console.log('🎬 CLIENT FLOW 360 - Starting Netflix-style CRM with Database v2.1...');
      
      // API Service
      const API = {
        baseURL: '/api',
        
        // Health check
        health: async () => {
          try {
            const response = await axios.get(`${API.baseURL}/health`);
            return response.data;
          } catch (error) {
            console.error('Health check failed:', error);
            throw error;
          }
        },
        
        // Clients
        clients: {
          getAll: async () => {
            console.log('📡 Making API call to fetch clients...');
            const response = await axios.get(`${API.baseURL}/clients`);
            console.log('✅ API response received:', response.data);
            return response.data;
          },
          
          getById: async (id) => {
            const response = await axios.get(`${API.baseURL}/clients/${id}`);
            return response.data;
          },
          
          create: async (clientData) => {
            console.log('📡 Creating new client via API...', clientData);
            const response = await axios.post(`${API.baseURL}/clients`, clientData);
            console.log('✅ Client created successfully:', response.data);
            return response.data;
          },
          
          update: async (id, clientData) => {
            const response = await axios.put(`${API.baseURL}/clients/${id}`, clientData);
            return response.data;
          },
          
          delete: async (id) => {
            const response = await axios.delete(`${API.baseURL}/clients/${id}`);
            return response.data;
          }
        },
        
        // Properties
        properties: {
          getByClient: async (clientId) => {
            const response = await axios.get(`${API.baseURL}/clients/${clientId}/properties`);
            return response.data;
          },
          
          create: async (clientId, propertyData) => {
            const response = await axios.post(`${API.baseURL}/clients/${clientId}/properties`, propertyData);
            return response.data;
          }
        },
        
        // Tasks
        tasks: {
          getAll: async () => {
            const response = await axios.get(`${API.baseURL}/tasks`);
            return response.data;
          },
          
          create: async (clientId, taskData) => {
            const response = await axios.post(`${API.baseURL}/clients/${clientId}/tasks`, taskData);
            return response.data;
          }
        },
        
        // Calls
        calls: {
          create: async (clientId, callData) => {
            const response = await axios.post(`${API.baseURL}/clients/${clientId}/calls`, callData);
            return response.data;
          }
        }
      };
      
      function NetflixCRM() {
        const [user, setUser] = useState(null);
        const [clients, setClients] = useState([]);
        const [selectedClient, setSelectedClient] = useState(null);
        const [error, setError] = useState('');
        const [loading, setLoading] = useState(false);
        const [currentView, setCurrentView] = useState('clients');
        const [searchTerm, setSearchTerm] = useState('');
        const [selectedTag, setSelectedTag] = useState('');
        const [isListening, setIsListening] = useState(false);
        const [voiceStatus, setVoiceStatus] = useState('');
        const [showCallModal, setShowCallModal] = useState(null);
        const [showAddClientModal, setShowAddClientModal] = useState(false);
        const [showPropertyModal, setShowPropertyModal] = useState(null);
        const [apiHealth, setApiHealth] = useState(null);
        
        // Load clients from database
        const loadClients = useCallback(async () => {
          try {
            setLoading(true);
            setError('');
            console.log('🔄 Loading clients from database...');
            const clientsData = await API.clients.getAll();
            console.log('📊 Received clients data:', clientsData);
            
            // Add mock data structure for UI compatibility
            const enrichedClients = clientsData.map(client => ({
              ...client,
              role: 'BUYER', // Default for now
              stage: 'ACTIVE', // Default for now  
              city: client.address ? client.address.split(',')[1]?.trim() : 'Los Angeles',
              state: client.address ? client.address.split(',')[2]?.trim() || 'CA' : 'CA',
              tags: Array.isArray(client.tags) ? client.tags : (client.tags ? client.tags.split(',') : []),
              lifetimeNetCommission: 15000, // Default for now
              calls: [], // Will load separately if needed
              transactions: [], // Default for now
              todos: [], // Will load separately if needed
              propertiesOfInterest: [] // Will load separately if needed
            }));
            
            console.log('✅ Enriched clients for UI:', enrichedClients);
            setClients(enrichedClients);
          } catch (error) {
            console.error('❌ Failed to load clients:', error);
            setError('Failed to load clients from database');
          } finally {
            setLoading(false);
          }
        }, []);
        
        // Initialize app
        useEffect(() => {
          const checkAPIHealth = async () => {
            try {
              console.log('🔍 Checking API health...');
              const health = await API.health();
              setApiHealth(health);
              console.log('✅ API connection successful:', health);
            } catch (error) {
              console.error('❌ API connection failed:', error);
              setError('Database connection failed. Using demo mode.');
              setApiHealth({ status: 'error', storage: 'Offline' });
            }
          };
          
          checkAPIHealth();
        }, []);
        
        // Auto-login for demo and load clients
        useEffect(() => {
          console.log('🚀 Auto-login and loading clients...');
          setUser({ firstName: 'Rodrigo', lastName: 'Admin', email: 'rodrigo@realtor.com' });
          loadClients();
        }, [loadClients]);
        
        const login = async (email, password) => {
          if (email === 'rodrigo@realtor.com' && password === 'admin123') {
            setUser({ firstName: 'Rodrigo', lastName: 'Admin', email });
            await loadClients();
            setError('');
          } else {
            setError('Invalid credentials. Use rodrigo@realtor.com / admin123');
          }
        };
        
        const startVoiceRecognition = () => {
          if (!('webkitSpeechRecognition' in window)) {
            setVoiceStatus('❌ Voice recognition not supported in this browser');
            setTimeout(() => setVoiceStatus(''), 3000);
            return;
          }
          
          const recognition = new webkitSpeechRecognition();
          recognition.continuous = false;
          recognition.interimResults = false;
          recognition.lang = 'en-US';
          
          recognition.onstart = () => {
            setIsListening(true);
            setVoiceStatus('🎤 Listening... Say "Add task for [Client Name] to [task description]"');
          };
          
          recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript;
            setVoiceStatus('✅ Voice command received: "' + transcript + '"');
            setIsListening(false);
            
            // Simple demo processing
            setTimeout(() => {
              setVoiceStatus('✅ Task added successfully via voice command!');
              setTimeout(() => setVoiceStatus(''), 3000);
            }, 1000);
          };
          
          recognition.onerror = () => {
            setIsListening(false);
            setVoiceStatus('❌ Voice recognition error');
            setTimeout(() => setVoiceStatus(''), 3000);
          };
          
          recognition.onend = () => {
            setIsListening(false);
            if (!voiceStatus.includes('✅')) {
              setVoiceStatus('⏹️ No speech detected. Try again.');
              setTimeout(() => setVoiceStatus(''), 3000);
            }
          };
          
          recognition.start();
        };
        
        const addClient = async (clientData) => {
          try {
            setLoading(true);
            console.log('➕ Adding new client:', clientData);
            const newClient = await API.clients.create(clientData);
            
            // Enrich with UI compatibility data
            const enrichedClient = {
              ...newClient,
              role: 'BUYER',
              stage: 'ACTIVE',
              city: clientData.address ? clientData.address.split(',')[1]?.trim() : 'Los Angeles', 
              state: clientData.address ? clientData.address.split(',')[2]?.trim() || 'CA' : 'CA',
              tags: Array.isArray(newClient.tags) ? newClient.tags : (newClient.tags ? newClient.tags.split(',') : []),
              lifetimeNetCommission: 0,
              calls: [],
              transactions: [],
              todos: [],
              propertiesOfInterest: []
            };
            
            setClients(prevClients => [enrichedClient, ...prevClients]);
            setShowAddClientModal(false);
            setError('');
            
            // Show success message
            setVoiceStatus('✅ Client added successfully to database!');
            setTimeout(() => setVoiceStatus(''), 3000);
            
            console.log('✅ Client added successfully to UI');
            
          } catch (error) {
            console.error('❌ Failed to add client:', error);
            setError(error.response?.data?.error || 'Failed to add client');
          } finally {
            setLoading(false);
          }
        };
        
        const logCall = async (clientId, callData) => {
          try {
            setLoading(true);
            
            const callRecord = await API.calls.create(clientId, {
              callType: 'outbound',
              duration: parseInt(callData.duration) || 0,
              notes: callData.notes,
              followUpDate: callData.followUp ? new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0] : null
            });
            
            // Update the client's call history in local state
            setClients(prevClients => 
              prevClients.map(client => 
                client.id === clientId 
                  ? {
                      ...client,
                      calls: [...(client.calls || []), {
                        id: callRecord.id,
                        phoneNumber: client.phone,
                        duration: callRecord.duration,
                        notes: callRecord.notes,
                        outcome: callData.outcome,
                        followUp: !!callRecord.followUpDate,
                        createdAt: callRecord.createdAt
                      }]
                    }
                  : client
              )
            );
            
            setShowCallModal(null);
            setVoiceStatus('✅ Call logged successfully!');
            setTimeout(() => setVoiceStatus(''), 3000);
            
          } catch (error) {
            console.error('Failed to log call:', error);
            setError('Failed to log call');
          } finally {
            setLoading(false);
          }
        };

        // Filter clients based on search and tag
        const filteredClients = clients.filter(client => {
          const matchesSearch = !searchTerm || 
            `${client.firstName || client.first_name || ''} ${client.lastName || client.last_name || ''}`.toLowerCase().includes(searchTerm.toLowerCase()) ||
            client.email.toLowerCase().includes(searchTerm.toLowerCase()) ||
            client.phone.includes(searchTerm);
          
          const matchesTag = !selectedTag || 
            (client.tags && client.tags.some(tag => tag.toLowerCase().includes(selectedTag.toLowerCase())));
          
          return matchesSearch && matchesTag;
        });

        const allTags = [...new Set(clients.flatMap(client => client.tags || []))];

        if (!user) {
          return React.createElement(LoginForm, { onLogin: login, error });
        }

        return React.createElement('div', { className: 'min-h-screen bg-gray-900 text-white' },
          // Header
          React.createElement('header', { className: 'bg-black p-4 flex justify-between items-center' },
            React.createElement('div', { className: 'flex items-center space-x-4' },
              React.createElement('h1', { 
                className: 'text-2xl font-bold text-red-500',
                style: { fontFamily: 'Arial, sans-serif', letterSpacing: '-0.5px' }
              }, 'CLIENT FLOW 360'),
              apiHealth && React.createElement('div', { 
                className: `text-xs px-2 py-1 rounded ${
                  apiHealth.status === 'ok' ? 'bg-green-600 text-green-100' : 'bg-red-600 text-red-100'
                }`
              }, `DB: ${apiHealth.storage}`)
            ),
            React.createElement('div', { className: 'flex items-center space-x-4' },
              React.createElement('span', { className: 'text-sm' }, `Welcome, ${user.firstName}!`),
              React.createElement('button', {
                onClick: () => setUser(null),
                className: 'bg-red-600 px-3 py-1 rounded text-sm hover:bg-red-700'
              }, 'Logout')
            )
          ),

          // Navigation
          React.createElement('nav', { className: 'bg-gray-800 p-4' },
            React.createElement('div', { className: 'flex space-x-6' },
              ['clients', 'dashboard', 'properties', 'tasks', 'analytics'].map(view =>
                React.createElement('button', {
                  key: view,
                  onClick: () => setCurrentView(view),
                  className: `capitalize px-4 py-2 rounded transition-colors ${
                    currentView === view 
                      ? 'bg-red-600 text-white' 
                      : 'text-gray-300 hover:bg-gray-700'
                  }`
                }, view)
              )
            )
          ),

          // Voice Status
          voiceStatus && React.createElement('div', { 
            className: 'bg-blue-600 text-white p-2 text-center text-sm'
          }, voiceStatus),

          // Error Display
          error && React.createElement('div', { 
            className: 'bg-red-600 text-white p-4 text-center'
          }, error),

          // Loading indicator
          loading && React.createElement('div', { 
            className: 'bg-yellow-600 text-white p-2 text-center text-sm'
          }, '⏳ Loading...'),

          // Main Content
          React.createElement('main', { className: 'p-6' },
            currentView === 'clients' && React.createElement(ClientsView, {
              clients: filteredClients,
              allTags,
              searchTerm,
              setSearchTerm,
              selectedTag,
              setSelectedTag,
              setSelectedClient,
              setShowCallModal,
              setShowAddClientModal,
              setShowPropertyModal,
              startVoiceRecognition,
              isListening
            }),
            
            currentView === 'dashboard' && React.createElement(DashboardView, { clients }),
            currentView === 'properties' && React.createElement(PropertiesView, { clients }),
            currentView === 'tasks' && React.createElement(TasksView, { clients }),
            currentView === 'analytics' && React.createElement(AnalyticsView, { clients })
          ),

          // Modals
          selectedClient && React.createElement(ClientDetailModal, {
            client: selectedClient,
            onClose: () => setSelectedClient(null)
          }),

          showCallModal && React.createElement(CallLogModal, {
            client: showCallModal,
            onClose: () => setShowCallModal(null),
            onLog: logCall
          }),

          showAddClientModal && React.createElement(AddClientModal, {
            onClose: () => setShowAddClientModal(false),
            onAdd: addClient
          }),

          showPropertyModal && React.createElement(PropertyModal, {
            client: showPropertyModal,
            onClose: () => setShowPropertyModal(null)
          })
        );
      }

      // Login Form Component
      function LoginForm({ onLogin, error }) {
        const [email, setEmail] = useState('rodrigo@realtor.com');
        const [password, setPassword] = useState('admin123');

        const handleSubmit = (e) => {
          e.preventDefault();
          onLogin(email, password);
        };

        return React.createElement('div', { 
          className: 'min-h-screen bg-gray-900 flex items-center justify-center'
        },
          React.createElement('div', { className: 'bg-gray-800 p-8 rounded-lg shadow-xl w-96' },
            React.createElement('h1', { 
              className: 'text-3xl font-bold text-red-500 mb-6 text-center',
              style: { fontFamily: 'Arial, sans-serif', letterSpacing: '-0.5px' }
            }, 'CLIENT FLOW 360'),
            
            error && React.createElement('div', { 
              className: 'bg-red-600 text-white p-3 rounded mb-4 text-sm'
            }, error),
            
            React.createElement('form', { onSubmit: handleSubmit, className: 'space-y-4' },
              React.createElement('input', {
                type: 'email',
                placeholder: 'Email',
                value: email,
                onChange: (e) => setEmail(e.target.value),
                className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white placeholder-gray-400 focus:border-red-500 focus:outline-none',
                required: true
              }),
              React.createElement('input', {
                type: 'password',
                placeholder: 'Password',
                value: password,
                onChange: (e) => setPassword(e.target.value),
                className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white placeholder-gray-400 focus:border-red-500 focus:outline-none',
                required: true
              }),
              React.createElement('button', {
                type: 'submit',
                className: 'w-full bg-red-600 text-white p-3 rounded hover:bg-red-700 transition-colors font-semibold'
              }, 'Login')
            ),
            
            React.createElement('div', { className: 'mt-4 text-center text-gray-400 text-sm' },
              'Demo: rodrigo@realtor.com / admin123'
            )
          )
        );
      }

      // Clients View Component
      function ClientsView({ 
        clients, allTags, searchTerm, setSearchTerm, selectedTag, setSelectedTag, 
        setSelectedClient, setShowCallModal, setShowAddClientModal, setShowPropertyModal,
        startVoiceRecognition, isListening 
      }) {
        return React.createElement('div', null,
          React.createElement('div', { className: 'flex justify-between items-center mb-6' },
            React.createElement('div', null,
              React.createElement('h2', { className: 'text-3xl font-bold mb-1' }, 'My Clients'),
              React.createElement('p', { className: 'text-gray-400' }, `${clients.length} active clients in your portfolio`)
            ),
            React.createElement('div', { className: 'flex space-x-3' },
              React.createElement('button', {
                onClick: () => setShowAddClientModal(true),
                className: 'bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition-colors'
              }, '+ Add Client'),
              React.createElement('button', {
                onClick: startVoiceRecognition,
                disabled: isListening,
                className: `px-4 py-2 rounded transition-colors ${
                  isListening 
                    ? 'bg-red-600 text-white cursor-not-allowed' 
                    : 'bg-blue-600 text-white hover:bg-blue-700'
                }`
              }, isListening ? '🎤 Listening...' : '🎤 Voice Command')
            )
          ),

          // Search and Filters
          React.createElement('div', { className: 'mb-6 flex space-x-4' },
            React.createElement('input', {
              type: 'text',
              placeholder: 'Search clients...',
              value: searchTerm,
              onChange: (e) => setSearchTerm(e.target.value),
              className: 'flex-1 p-3 bg-gray-800 rounded border border-gray-700 text-white placeholder-gray-400 focus:border-red-500 focus:outline-none'
            }),
            React.createElement('select', {
              value: selectedTag,
              onChange: (e) => setSelectedTag(e.target.value),
              className: 'p-3 bg-gray-800 rounded border border-gray-700 text-white focus:border-red-500 focus:outline-none'
            },
              React.createElement('option', { value: '' }, 'All Tags'),
              allTags.map(tag => 
                React.createElement('option', { key: tag, value: tag }, tag)
              )
            )
          ),

          // Stats
          React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-4 gap-4 mb-6' },
            React.createElement('div', { className: 'bg-gray-800 p-4 rounded' },
              React.createElement('div', { className: 'text-2xl font-bold text-green-400' }, clients.length),
              React.createElement('div', { className: 'text-gray-400' }, 'Total Clients')
            ),
            React.createElement('div', { className: 'bg-gray-800 p-4 rounded' },
              React.createElement('div', { className: 'text-2xl font-bold text-blue-400' }, 
                clients.filter(c => c.stage === 'ACTIVE').length
              ),
              React.createElement('div', { className: 'text-gray-400' }, 'Active Deals')
            ),
            React.createElement('div', { className: 'bg-gray-800 p-4 rounded' },
              React.createElement('div', { className: 'text-2xl font-bold text-yellow-400' }, 
                `$${clients.reduce((sum, c) => sum + (c.lifetimeNetCommission || 0), 0).toLocaleString()}`
              ),
              React.createElement('div', { className: 'text-gray-400' }, 'Total Commission')
            ),
            React.createElement('div', { className: 'bg-gray-800 p-4 rounded' },
              React.createElement('div', { className: 'text-2xl font-bold text-purple-400' }, 
                clients.reduce((sum, c) => sum + (c.calls ? c.calls.length : 0), 0)
              ),
              React.createElement('div', { className: 'text-gray-400' }, 'Total Calls')
            )
          ),

          // Netflix-style Clients Grid with horizontal scroll on mobile
          React.createElement('div', { 
            className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 pb-20',
            style: { minHeight: '400px' } // Ensure space for hover overlays
          },
            clients.map(client => React.createElement(ClientCard, {
              key: client.id,
              client,
              onViewDetails: () => setSelectedClient(client),
              onLogCall: () => setShowCallModal(client),
              onManageProperties: () => setShowPropertyModal(client)
            }))
          ),

          clients.length === 0 && React.createElement('div', { 
            className: 'text-center py-12 text-gray-400'
          }, 
            React.createElement('p', { className: 'text-xl mb-2' }, 'No clients found'),
            React.createElement('p', null, 'Try adjusting your search or filters')
          )
        );
      }

      // Client Card Component - Netflix Movie Tile Style
      function ClientCard({ client, onViewDetails, onLogCall, onManageProperties }) {
        const clientName = `${client.firstName || client.first_name || 'Unknown'} ${client.lastName || client.last_name || 'Client'}`;
        const initials = `${(client.firstName || client.first_name || 'A')[0]}${(client.lastName || client.last_name || 'A')[0]}`;
        
        // Generate a unique gradient based on client name for visual variety
        const gradients = [
          'from-red-600 to-red-800',
          'from-blue-600 to-blue-800', 
          'from-green-600 to-green-800',
          'from-purple-600 to-purple-800',
          'from-yellow-600 to-yellow-800',
          'from-pink-600 to-pink-800',
          'from-indigo-600 to-indigo-800',
          'from-teal-600 to-teal-800'
        ];
        const gradientIndex = (clientName.charCodeAt(0) + clientName.charCodeAt(1)) % gradients.length;
        const gradient = gradients[gradientIndex];

        return React.createElement('div', { 
          className: 'relative group cursor-pointer transform transition-all duration-300 hover:scale-105',
          onClick: onViewDetails,
          style: { aspectRatio: '16/9' }
        },
          // Main Netflix-style tile
          React.createElement('div', { 
            className: `relative w-full h-full bg-gradient-to-br ${gradient} rounded-lg overflow-hidden shadow-xl`
          },
            // Background pattern for visual interest
            React.createElement('div', {
              className: 'absolute inset-0 opacity-20',
              style: {
                backgroundImage: 'radial-gradient(circle at 50% 50%, rgba(255,255,255,0.1) 1px, transparent 1px)',
                backgroundSize: '20px 20px'
              }
            }),
            
            // Status badge (top-right corner)
            React.createElement('div', { 
              className: `absolute top-3 right-3 px-2 py-1 rounded-full text-xs font-bold ${
                client.stage === 'ACTIVE' ? 'bg-green-500 text-white' :
                client.stage === 'PENDING' ? 'bg-yellow-500 text-black' :
                'bg-gray-500 text-white'
              }`
            }, client.stage || 'ACTIVE'),

            // Client avatar (large, centered)
            React.createElement('div', { className: 'absolute inset-0 flex items-center justify-center' },
              React.createElement('div', { 
                className: 'w-20 h-20 bg-black bg-opacity-30 rounded-full flex items-center justify-center text-white font-bold text-3xl border-4 border-white border-opacity-50'
              }, initials)
            ),

            // Client info overlay (bottom)
            React.createElement('div', { 
              className: 'absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black via-black to-transparent p-4'
            },
              React.createElement('h3', { className: 'text-white font-bold text-lg mb-1' }, clientName),
              React.createElement('p', { className: 'text-gray-300 text-sm mb-2' }, client.email),
              React.createElement('div', { className: 'flex items-center justify-between' },
                React.createElement('span', { className: 'text-green-400 font-semibold text-sm' }, 
                  `$${(client.lifetimeNetCommission || 0).toLocaleString()}`
                ),
                React.createElement('span', { className: 'text-gray-400 text-xs' }, 
                  `${client.calls ? client.calls.length : 0} calls`
                )
              )
            ),

            // Tags overlay (top-left)
            client.tags && client.tags.length > 0 && React.createElement('div', { 
              className: 'absolute top-3 left-3 flex flex-wrap gap-1'
            },
              client.tags.slice(0, 2).map((tag, index) =>
                React.createElement('span', {
                  key: index,
                  className: 'px-2 py-1 bg-black bg-opacity-60 text-white rounded text-xs font-medium'
                }, tag)
              )
            )
          ),

          // Netflix-style hover overlay with actions
          React.createElement('div', { 
            className: 'absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-60 transition-all duration-300 flex items-center justify-center opacity-0 group-hover:opacity-100'
          },
            React.createElement('div', { className: 'flex space-x-3' },
              React.createElement('button', {
                onClick: (e) => { e.stopPropagation(); onViewDetails(); },
                className: 'bg-white text-black px-4 py-2 rounded-full font-semibold hover:bg-gray-200 transition-colors flex items-center space-x-2'
              }, 
                React.createElement('span', null, '▶'),
                React.createElement('span', null, 'Details')
              ),
              React.createElement('button', {
                onClick: (e) => { e.stopPropagation(); onLogCall(); },
                className: 'bg-gray-700 text-white px-4 py-2 rounded-full font-semibold hover:bg-gray-600 transition-colors flex items-center space-x-2'
              }, 
                React.createElement('span', null, '📞'),
                React.createElement('span', null, 'Call')
              ),
              React.createElement('button', {
                onClick: (e) => { e.stopPropagation(); onManageProperties(); },
                className: 'bg-gray-700 text-white px-4 py-2 rounded-full font-semibold hover:bg-gray-600 transition-colors flex items-center space-x-2'
              }, 
                React.createElement('span', null, '🏠'),
                React.createElement('span', null, 'Properties')
              )
            )
          ),

          // Netflix-style bottom info bar (appears on hover)
          React.createElement('div', { 
            className: 'absolute -bottom-20 left-0 right-0 bg-gray-800 p-4 rounded-b-lg shadow-xl opacity-0 group-hover:opacity-100 transform group-hover:translate-y-0 translate-y-2 transition-all duration-300'
          },
            React.createElement('div', { className: 'flex justify-between items-start mb-2' },
              React.createElement('div', null,
                React.createElement('p', { className: 'text-white font-semibold' }, clientName),
                React.createElement('p', { className: 'text-gray-400 text-sm' }, 
                  `📍 ${client.city || 'Los Angeles'}, ${client.state || 'CA'}`
                )
              ),
              React.createElement('div', { className: 'text-right' },
                React.createElement('p', { className: 'text-green-400 font-bold' }, 
                  `$${(client.lifetimeNetCommission || 0).toLocaleString()}`
                ),
                React.createElement('p', { className: 'text-gray-400 text-xs' }, 'LTV')
              )
            ),
            client.tags && client.tags.length > 0 && React.createElement('div', { className: 'flex flex-wrap gap-1 mb-2' },
              client.tags.map((tag, index) =>
                React.createElement('span', {
                  key: index,
                  className: 'px-2 py-1 bg-blue-600 text-blue-100 rounded text-xs'
                }, tag)
              )
            ),
            client.notes && React.createElement('p', { className: 'text-gray-300 text-sm line-clamp-2' }, 
              client.notes
            )
          )
        );
      }

      // Dashboard View Component
      function DashboardView({ clients }) {
        const today = new Date();
        const thisMonth = today.getMonth();
        const thisYear = today.getFullYear();
        
        const monthlyStats = {
          newClients: clients.filter(c => {
            const created = new Date(c.createdAt);
            return created.getMonth() === thisMonth && created.getFullYear() === thisYear;
          }).length,
          totalCommission: clients.reduce((sum, c) => sum + (c.lifetimeNetCommission || 0), 0),
          activDeals: clients.filter(c => c.stage === 'ACTIVE').length,
          callsMade: clients.reduce((sum, c) => sum + (c.calls ? c.calls.length : 0), 0)
        };

        return React.createElement('div', null,
          React.createElement('h2', { className: 'text-3xl font-bold mb-6' }, 'Dashboard'),
          
          React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8' },
            React.createElement('div', { className: 'bg-gradient-to-r from-blue-600 to-blue-800 p-6 rounded-lg text-white' },
              React.createElement('h3', { className: 'text-lg font-semibold mb-2' }, 'New Clients This Month'),
              React.createElement('p', { className: 'text-3xl font-bold' }, monthlyStats.newClients),
              React.createElement('p', { className: 'text-blue-200 text-sm' }, 'Total clients added')
            ),
            React.createElement('div', { className: 'bg-gradient-to-r from-green-600 to-green-800 p-6 rounded-lg text-white' },
              React.createElement('h3', { className: 'text-lg font-semibold mb-2' }, 'Total Commission'),
              React.createElement('p', { className: 'text-3xl font-bold' }, `$${monthlyStats.totalCommission.toLocaleString()}`),
              React.createElement('p', { className: 'text-green-200 text-sm' }, 'Lifetime value')
            ),
            React.createElement('div', { className: 'bg-gradient-to-r from-yellow-600 to-yellow-800 p-6 rounded-lg text-white' },
              React.createElement('h3', { className: 'text-lg font-semibold mb-2' }, 'Active Deals'),
              React.createElement('p', { className: 'text-3xl font-bold' }, monthlyStats.activDeals),
              React.createElement('p', { className: 'text-yellow-200 text-sm' }, 'In progress')
            ),
            React.createElement('div', { className: 'bg-gradient-to-r from-purple-600 to-purple-800 p-6 rounded-lg text-white' },
              React.createElement('h3', { className: 'text-lg font-semibold mb-2' }, 'Calls Made'),
              React.createElement('p', { className: 'text-3xl font-bold' }, monthlyStats.callsMade),
              React.createElement('p', { className: 'text-purple-200 text-sm' }, 'Total calls logged')
            )
          ),

          React.createElement('div', { className: 'grid grid-cols-1 lg:grid-cols-2 gap-8' },
            React.createElement('div', { className: 'bg-gray-800 p-6 rounded-lg' },
              React.createElement('h3', { className: 'text-xl font-semibold mb-4' }, 'Recent Clients'),
              React.createElement('div', { className: 'space-y-4' },
                clients.slice(0, 5).map(client =>
                  React.createElement('div', { 
                    key: client.id, 
                    className: 'flex items-center justify-between p-3 bg-gray-700 rounded'
                  },
                    React.createElement('div', null,
                      React.createElement('p', { className: 'font-semibold' }, 
                        `${client.firstName || client.first_name || 'Unknown'} ${client.lastName || client.last_name || 'Client'}`
                      ),
                      React.createElement('p', { className: 'text-sm text-gray-400' }, client.email)
                    ),
                    React.createElement('span', { 
                      className: `px-2 py-1 rounded text-xs ${
                        client.stage === 'ACTIVE' ? 'bg-green-600 text-green-100' : 'bg-gray-600 text-gray-100'
                      }`
                    }, client.stage || 'ACTIVE')
                  )
                )
              )
            ),

            React.createElement('div', { className: 'bg-gray-800 p-6 rounded-lg' },
              React.createElement('h3', { className: 'text-xl font-semibold mb-4' }, 'Top Performers'),
              React.createElement('div', { className: 'space-y-4' },
                clients
                  .sort((a, b) => (b.lifetimeNetCommission || 0) - (a.lifetimeNetCommission || 0))
                  .slice(0, 5)
                  .map(client =>
                    React.createElement('div', { 
                      key: client.id, 
                      className: 'flex items-center justify-between p-3 bg-gray-700 rounded'
                    },
                      React.createElement('div', null,
                        React.createElement('p', { className: 'font-semibold' }, 
                          `${client.firstName || client.first_name || 'Unknown'} ${client.lastName || client.last_name || 'Client'}`
                        ),
                        React.createElement('p', { className: 'text-sm text-gray-400' }, 
                          `${client.calls ? client.calls.length : 0} calls`
                        )
                      ),
                      React.createElement('span', { className: 'text-green-400 font-semibold' }, 
                        `$${(client.lifetimeNetCommission || 0).toLocaleString()}`
                      )
                    )
                  )
              )
            )
          )
        );
      }

      // Properties View Component
      function PropertiesView({ clients }) {
        const allProperties = clients.flatMap(client => 
          (client.propertiesOfInterest || []).map(property => ({
            ...property,
            clientName: `${client.firstName || client.first_name || 'Unknown'} ${client.lastName || client.last_name || 'Client'}`,
            clientId: client.id
          }))
        );

        return React.createElement('div', null,
          React.createElement('h2', { className: 'text-3xl font-bold mb-6' }, 'Properties'),
          
          allProperties.length === 0 ? 
            React.createElement('div', { className: 'text-center py-12 text-gray-400' },
              React.createElement('p', { className: 'text-xl mb-2' }, 'No properties found'),
              React.createElement('p', null, 'Properties will appear here when clients express interest')
            ) :
            React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6' },
              allProperties.map((property, index) =>
                React.createElement('div', { 
                  key: index, 
                  className: 'bg-gray-800 rounded-lg p-6'
                },
                  React.createElement('h3', { className: 'text-xl font-semibold mb-2' }, property.address),
                  React.createElement('p', { className: 'text-gray-400 mb-2' }, `Client: ${property.clientName}`),
                  React.createElement('p', { className: 'text-green-400 font-semibold text-lg' }, 
                    `$${property.price.toLocaleString()}`
                  ),
                  React.createElement('p', { className: 'text-sm text-gray-300 mt-2' }, 
                    `${property.bedrooms} bed, ${property.bathrooms} bath`
                  )
                )
              )
            )
        );
      }

      // Tasks View Component
      function TasksView({ clients }) {
        const allTasks = clients.flatMap(client => 
          (client.todos || []).map(task => ({
            ...task,
            clientName: `${client.firstName || client.first_name || 'Unknown'} ${client.lastName || client.last_name || 'Client'}`,
            clientId: client.id
          }))
        );

        return React.createElement('div', null,
          React.createElement('h2', { className: 'text-3xl font-bold mb-6' }, 'Tasks'),
          
          allTasks.length === 0 ? 
            React.createElement('div', { className: 'text-center py-12 text-gray-400' },
              React.createElement('p', { className: 'text-xl mb-2' }, 'No tasks found'),
              React.createElement('p', null, 'Tasks will appear here when you add them to clients')
            ) :
            React.createElement('div', { className: 'space-y-4' },
              allTasks.map((task, index) =>
                React.createElement('div', { 
                  key: index, 
                  className: 'bg-gray-800 rounded-lg p-4 flex items-center justify-between'
                },
                  React.createElement('div', null,
                    React.createElement('h3', { className: 'font-semibold' }, task.text),
                    React.createElement('p', { className: 'text-sm text-gray-400' }, 
                      `Client: ${task.clientName}`
                    )
                  ),
                  React.createElement('span', { 
                    className: `px-3 py-1 rounded text-sm ${
                      task.completed ? 'bg-green-600 text-green-100' : 'bg-yellow-600 text-yellow-100'
                    }`
                  }, task.completed ? 'Completed' : 'Pending')
                )
              )
            )
        );
      }

      // Analytics View Component
      function AnalyticsView({ clients }) {
        const analytics = {
          totalClients: clients.length,
          averageCommission: clients.length > 0 ? 
            clients.reduce((sum, c) => sum + (c.lifetimeNetCommission || 0), 0) / clients.length : 0,
          clientsByTag: clients.reduce((acc, client) => {
            (client.tags || []).forEach(tag => {
              acc[tag] = (acc[tag] || 0) + 1;
            });
            return acc;
          }, {}),
          clientsByCity: clients.reduce((acc, client) => {
            const city = client.city || 'Unknown';
            acc[city] = (acc[city] || 0) + 1;
            return acc;
          }, {})
        };

        return React.createElement('div', null,
          React.createElement('h2', { className: 'text-3xl font-bold mb-6' }, 'Analytics'),
          
          React.createElement('div', { className: 'grid grid-cols-1 lg:grid-cols-2 gap-8' },
            React.createElement('div', { className: 'bg-gray-800 p-6 rounded-lg' },
              React.createElement('h3', { className: 'text-xl font-semibold mb-4' }, 'Clients by Tag'),
              React.createElement('div', { className: 'space-y-3' },
                Object.entries(analytics.clientsByTag).map(([tag, count]) =>
                  React.createElement('div', { key: tag, className: 'flex justify-between items-center' },
                    React.createElement('span', null, tag),
                    React.createElement('span', { className: 'bg-blue-600 text-white px-2 py-1 rounded text-sm' }, count)
                  )
                )
              )
            ),

            React.createElement('div', { className: 'bg-gray-800 p-6 rounded-lg' },
              React.createElement('h3', { className: 'text-xl font-semibold mb-4' }, 'Clients by City'),
              React.createElement('div', { className: 'space-y-3' },
                Object.entries(analytics.clientsByCity).map(([city, count]) =>
                  React.createElement('div', { key: city, className: 'flex justify-between items-center' },
                    React.createElement('span', null, city),
                    React.createElement('span', { className: 'bg-green-600 text-white px-2 py-1 rounded text-sm' }, count)
                  )
                )
              )
            )
          ),

          React.createElement('div', { className: 'mt-8 bg-gray-800 p-6 rounded-lg' },
            React.createElement('h3', { className: 'text-xl font-semibold mb-4' }, 'Summary Statistics'),
            React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-3 gap-6' },
              React.createElement('div', { className: 'text-center' },
                React.createElement('p', { className: 'text-2xl font-bold text-blue-400' }, analytics.totalClients),
                React.createElement('p', { className: 'text-gray-400' }, 'Total Clients')
              ),
              React.createElement('div', { className: 'text-center' },
                React.createElement('p', { className: 'text-2xl font-bold text-green-400' }, 
                  `$${Math.round(analytics.averageCommission).toLocaleString()}`
                ),
                React.createElement('p', { className: 'text-gray-400' }, 'Average Commission')
              ),
              React.createElement('div', { className: 'text-center' },
                React.createElement('p', { className: 'text-2xl font-bold text-purple-400' }, 
                  Object.keys(analytics.clientsByTag).length
                ),
                React.createElement('p', { className: 'text-gray-400' }, 'Unique Tags')
              )
            )
          )
        );
      }

      // Client Detail Modal Component
      function ClientDetailModal({ client, onClose }) {
        return React.createElement('div', { 
          className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50',
          onClick: onClose
        },
          React.createElement('div', { 
            className: 'bg-gray-800 rounded-lg p-6 max-w-2xl w-full mx-4 max-h-96 overflow-y-auto',
            onClick: (e) => e.stopPropagation()
          },
            React.createElement('div', { className: 'flex justify-between items-center mb-4' },
              React.createElement('h2', { className: 'text-2xl font-bold' }, 
                `${client.firstName || client.first_name || 'Unknown'} ${client.lastName || client.last_name || 'Client'}`
              ),
              React.createElement('button', {
                onClick: onClose,
                className: 'text-gray-400 hover:text-white text-2xl'
              }, '×')
            ),

            React.createElement('div', { className: 'space-y-4' },
              React.createElement('div', null,
                React.createElement('h3', { className: 'font-semibold mb-2' }, 'Contact Information'),
                React.createElement('p', null, `Email: ${client.email}`),
                React.createElement('p', null, `Phone: ${client.phone || 'Not provided'}`),
                React.createElement('p', null, `Address: ${client.address || 'Not provided'}`)
              ),

              client.notes && React.createElement('div', null,
                React.createElement('h3', { className: 'font-semibold mb-2' }, 'Notes'),
                React.createElement('p', { className: 'text-gray-300' }, client.notes)
              ),

              client.tags && client.tags.length > 0 && React.createElement('div', null,
                React.createElement('h3', { className: 'font-semibold mb-2' }, 'Tags'),
                React.createElement('div', { className: 'flex flex-wrap gap-2' },
                  client.tags.map((tag, index) =>
                    React.createElement('span', {
                      key: index,
                      className: 'px-2 py-1 bg-blue-600 text-blue-100 rounded text-sm'
                    }, tag)
                  )
                )
              ),

              client.calls && client.calls.length > 0 && React.createElement('div', null,
                React.createElement('h3', { className: 'font-semibold mb-2' }, 'Recent Calls'),
                React.createElement('div', { className: 'space-y-2' },
                  client.calls.slice(0, 3).map((call, index) =>
                    React.createElement('div', { 
                      key: index, 
                      className: 'bg-gray-700 p-3 rounded'
                    },
                      React.createElement('p', { className: 'text-sm' }, 
                        `Duration: ${call.duration} minutes`
                      ),
                      React.createElement('p', { className: 'text-sm text-gray-400' }, call.notes)
                    )
                  )
                )
              )
            )
          )
        );
      }

      // Call Log Modal Component
      function CallLogModal({ client, onClose, onLog }) {
        const [duration, setDuration] = useState('');
        const [notes, setNotes] = useState('');
        const [outcome, setOutcome] = useState('');
        const [followUp, setFollowUp] = useState(false);

        const handleSubmit = (e) => {
          e.preventDefault();
          onLog(client.id, { duration, notes, outcome, followUp });
        };

        return React.createElement('div', { 
          className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50',
          onClick: onClose
        },
          React.createElement('div', { 
            className: 'bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4',
            onClick: (e) => e.stopPropagation()
          },
            React.createElement('h2', { className: 'text-xl font-bold mb-4' }, 
              `Log Call - ${client.firstName} ${client.lastName}`
            ),
            
            React.createElement('form', { onSubmit: handleSubmit, className: 'space-y-4' },
              React.createElement('input', {
                type: 'number',
                placeholder: 'Call duration (minutes)',
                value: duration,
                onChange: (e) => setDuration(e.target.value),
                className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white',
                required: true
              }),
              React.createElement('select', {
                value: outcome,
                onChange: (e) => setOutcome(e.target.value),
                className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white',
                required: true
              },
                React.createElement('option', { value: '' }, 'Select outcome'),
                React.createElement('option', { value: 'Connected' }, 'Connected'),
                React.createElement('option', { value: 'Voicemail' }, 'Voicemail'),
                React.createElement('option', { value: 'No Answer' }, 'No Answer'),
                React.createElement('option', { value: 'Busy' }, 'Busy')
              ),
              React.createElement('textarea', {
                placeholder: 'Call notes...',
                value: notes,
                onChange: (e) => setNotes(e.target.value),
                rows: 3,
                className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white'
              }),
              React.createElement('label', { className: 'flex items-center space-x-2' },
                React.createElement('input', {
                  type: 'checkbox',
                  checked: followUp,
                  onChange: (e) => setFollowUp(e.target.checked),
                  className: 'rounded'
                }),
                React.createElement('span', null, 'Schedule follow-up')
              ),
              React.createElement('div', { className: 'flex space-x-3' },
                React.createElement('button', {
                  type: 'submit',
                  className: 'flex-1 bg-blue-600 text-white p-3 rounded hover:bg-blue-700'
                }, 'Log Call'),
                React.createElement('button', {
                  type: 'button',
                  onClick: onClose,
                  className: 'flex-1 bg-gray-600 text-white p-3 rounded hover:bg-gray-700'
                }, 'Cancel')
              )
            )
          )
        );
      }

      // Add Client Modal Component
      function AddClientModal({ onClose, onAdd }) {
        const [formData, setFormData] = useState({
          firstName: '',
          lastName: '',
          email: '',
          phone: '',
          address: '',
          notes: '',
          tags: ''
        });

        const handleSubmit = (e) => {
          e.preventDefault();
          onAdd({
            ...formData,
            tags: formData.tags.split(',').map(tag => tag.trim()).filter(tag => tag)
          });
        };

        const handleChange = (field, value) => {
          setFormData(prev => ({ ...prev, [field]: value }));
        };

        return React.createElement('div', { 
          className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50',
          onClick: onClose
        },
          React.createElement('div', { 
            className: 'bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 max-h-96 overflow-y-auto',
            onClick: (e) => e.stopPropagation()
          },
            React.createElement('h2', { className: 'text-xl font-bold mb-4' }, 'Add New Client'),
            
            React.createElement('form', { onSubmit: handleSubmit, className: 'space-y-4' },
              React.createElement('div', { className: 'grid grid-cols-2 gap-3' },
                React.createElement('input', {
                  type: 'text',
                  placeholder: 'First Name',
                  value: formData.firstName,
                  onChange: (e) => handleChange('firstName', e.target.value),
                  className: 'p-3 bg-gray-700 rounded border border-gray-600 text-white',
                  required: true
                }),
                React.createElement('input', {
                  type: 'text',
                  placeholder: 'Last Name',
                  value: formData.lastName,
                  onChange: (e) => handleChange('lastName', e.target.value),
                  className: 'p-3 bg-gray-700 rounded border border-gray-600 text-white',
                  required: true
                })
              ),
              React.createElement('input', {
                type: 'email',
                placeholder: 'Email',
                value: formData.email,
                onChange: (e) => handleChange('email', e.target.value),
                className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white',
                required: true
              }),
              React.createElement('input', {
                type: 'tel',
                placeholder: 'Phone',
                value: formData.phone,
                onChange: (e) => handleChange('phone', e.target.value),
                className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white'
              }),
              React.createElement('input', {
                type: 'text',
                placeholder: 'Address',
                value: formData.address,
                onChange: (e) => handleChange('address', e.target.value),
                className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white'
              }),
              React.createElement('input', {
                type: 'text',
                placeholder: 'Tags (comma-separated)',
                value: formData.tags,
                onChange: (e) => handleChange('tags', e.target.value),
                className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white'
              }),
              React.createElement('textarea', {
                placeholder: 'Notes',
                value: formData.notes,
                onChange: (e) => handleChange('notes', e.target.value),
                rows: 3,
                className: 'w-full p-3 bg-gray-700 rounded border border-gray-600 text-white'
              }),
              React.createElement('div', { className: 'flex space-x-3' },
                React.createElement('button', {
                  type: 'submit',
                  className: 'flex-1 bg-green-600 text-white p-3 rounded hover:bg-green-700'
                }, 'Add Client'),
                React.createElement('button', {
                  type: 'button',
                  onClick: onClose,
                  className: 'flex-1 bg-gray-600 text-white p-3 rounded hover:bg-gray-700'
                }, 'Cancel')
              )
            )
          )
        );
      }

      // Property Modal Component
      function PropertyModal({ client, onClose }) {
        return React.createElement('div', { 
          className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50',
          onClick: onClose
        },
          React.createElement('div', { 
            className: 'bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4',
            onClick: (e) => e.stopPropagation()
          },
            React.createElement('h2', { className: 'text-xl font-bold mb-4' }, 
              `Properties - ${client.firstName} ${client.lastName}`
            ),
            React.createElement('p', { className: 'text-gray-400 mb-4' }, 
              'Property management feature coming soon!'
            ),
            React.createElement('button', {
              onClick: onClose,
              className: 'w-full bg-gray-600 text-white p-3 rounded hover:bg-gray-700'
            }, 'Close')
          )
        );
      }

      // Render the app
      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(React.createElement(NetflixCRM));
    </script>
  </body>
</html>